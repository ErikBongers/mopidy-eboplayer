{"version":3,"file":"bundle.js","names":["isSuccess","isFailure","defaultOptions: ResolvedOptions","EmptySearchResults: SearchResults","expandedRef: ExpandedRef","expandedRef","name: string","refs: SearchResult[]","trackModels: FileTrackModel[]","artistMap: Map<string, Artist>","NoStreamTitles: StreamTitles","AlbumNone: AlbumDataNone","streamTitles: StreamTitles","album: AlbumModel | null","option: PlaybackUserOptions","task: () => void","text","fetches: Promise<string>[]","tr","position: string","button: string","imageUrl: string","settingsComp","states: ListButtonStates","resultsDisplayMode: DisplayMode","activeDisplayMode: DisplayMode","tr: HTMLTableRowElement | null","tr","btn: EboButton","states: ListButtonStates","model: FileTrackModel","albums: AlbumModel[]","albumUrisToFetch: AlbumUri[]","option","eboButton","activeAncestors: HTMLDetailsElement[]","ancestor: HTMLElement | null","EboBigTrackComp","connectOptions: Options"],"sources":["../typescript/eventEmitter.ts","../typescript/jsonrpc.ts","../typescript/jsonRpcController.ts","../js/mopidy.ts","../typescript/global.ts","../typescript/refs.ts","../typescript/util/idStack.ts","../typescript/breadCrumb.ts","../typescript/modelTypes.ts","../typescript/events.ts","../typescript/model.ts","../typescript/views/view.ts","../typescript/views/headerView.ts","../typescript/commands.ts","../typescript/functionsvars.ts","../typescript/proxies/localStorageProxy.ts","../typescript/proxies/webProxy.ts","../typescript/controllers/controller.ts","../typescript/views/playerBarView.ts","../typescript/Batching.ts","../typescript/components/EboComponent.ts","../typescript/components/eboProgressBar.ts","../typescript/views/timelineView.ts","../typescript/components/eboBigTrackComp.ts","../typescript/views/componentViewAdapter.ts","../typescript/views/bigTrackViewCurrentOrSelectedAdapter.ts","../typescript/components/eboAlbumTracksComp.ts","../typescript/components/eboListButtonBar.ts","../typescript/views/mainView.ts","../typescript/components/eboBrowseComp.ts","../typescript/MouseTimer.ts","../typescript/components/eboButton.ts","../typescript/components/eboBigAlbumComp.ts","../typescript/components/eboPlayerBar.ts","../typescript/components/eboMenuButton.ts","../typescript/controllers/playController.ts","../typescript/proxies/mopidyProxy.ts","../typescript/components/eboDialog.ts","../typescript/components/eboAlbumDetails.ts","../typescript/components/eboRadioDetailsComp.ts","../typescript/components/eboBrowseFilterComp.ts","../typescript/components/eboSettingsComp.ts","../typescript/components/eboListItemComp.ts","../typescript/views/browseView.ts","../typescript/views/albumView.ts","../typescript/playerState.ts","../typescript/components/eboRememberedComp.ts","../typescript/views/rememberedView.ts","../typescript/controllers/cacheHandler.ts","../typescript/components/eboOption.ts","../typescript/components/eboIconDropdown.ts","../typescript/components/eboGenresComp.ts","../typescript/views/genresView.ts","../typescript/gui.ts"],"sourcesContent":["export type EventListenerCallback = any;\r\n\r\n//todo: use this one instead?\r\n// https://javascript.plainenglish.io/building-a-simple-event-emitter-in-javascript-f82f68c214ad\r\nexport class EventEmitter {\r\n    listeners: EventListenerCallback[] = [];\r\n    supervisors: EventListenerCallback[] = [];\r\n\r\n    emit(eventName: string, ...data: any) { //todo: make data a generic type T?\r\n        this.listeners.filter(({name}) => name === eventName)\r\n            .forEach(({callback}) => {\r\n                setTimeout(() => callback.call(this, ...data), 0);\r\n            });\r\n        this.supervisors.forEach(callback => {\r\n            setTimeout(() => callback.call(this, ...data), 0);\r\n        });\r\n    }\r\n\r\n    on(name: string | Function, callback?: any) { //todo: make callback type more specific?\r\n        if (typeof name === 'string' && typeof callback === 'function') {\r\n            this.listeners.push({name, callback});\r\n            return;\r\n        }\r\n        if (typeof name === 'function') {\r\n            this.supervisors.push(name);\r\n        }\r\n    }\r\n\r\n    off(eventName: string, callback: any) {\r\n        this.removeListener(eventName, callback);\r\n    }\r\n\r\n    destroy() {\r\n        this.listeners.length = 0;\r\n    }\r\n\r\n    removeAllListeners(eventName?: string) {\r\n        if (!eventName) {\r\n            this.listeners.length = 0;\r\n            return;\r\n        }\r\n        this.listeners = this.listeners.filter(listener => !(listener.name === eventName));\r\n    }\r\n\r\n    removeListener(eventName: string, callback: any) {\r\n        this.listeners = this.listeners.filter(listener =>\r\n            !(listener.name === eventName &&\r\n                listener.callback === callback)\r\n        );\r\n    }\r\n}","// from : https://gist.github.com/RickCarlino/41b8ddd36e41e381c132bbfcd1c31f3a\r\n\r\nexport namespace JsonRpc {\r\n\r\n    /** A String specifying the version of the JSON-RPC protocol. MUST be exactly \"2.0\". */\r\n    export type Version = \"2.0\";\r\n\r\n    /** Method names that begin with the word rpc followed by a period character\r\n     * (U+002E or ASCII 46) are reserved for rpc-internal methods and extensions\r\n     *  and MUST NOT be used for anything else. */\r\n    export type ReservedMethod = string;\r\n\r\n    /** An identifier established by the Client that MUST contain a String, Number,\r\n     *  or NULL value if included. If it is not included it is assumed to be a\r\n     *  notification. The value SHOULD normally not be Null and Numbers SHOULD\r\n     *  NOT contain fractional parts [2] */\r\n    export type OptionalId = number | string | void;\r\n    export type Id = number | string;\r\n\r\n    export interface Request<T> {\r\n        jsonrpc: Version;\r\n        id: OptionalId;\r\n        params?: T;\r\n    }\r\n\r\n    export interface Notification<T> extends Response<T> {\r\n        jsonrpc: Version;\r\n        params?: T;\r\n    }\r\n\r\n    export interface Response<T> {\r\n        jsonrpc: Version;\r\n        id: OptionalId;\r\n    }\r\n\r\n    export interface ResponseWithId<T> {\r\n        jsonrpc: Version;\r\n        id: Id;\r\n    }\r\n\r\n    export interface Success<T> extends ResponseWithId<T> {\r\n        result: T;\r\n    }\r\n\r\n    export function isSuccess<T>(response: ResponseWithId<T>): response is Success<T> {\r\n        return Object.hasOwnProperty.call(response, \"result\");\r\n    }\r\n\r\n    export interface Failure<T> extends ResponseWithId<T> {\r\n        error: Error<T>;\r\n    }\r\n\r\n    export function isFailure<T>(response: ResponseWithId<T>): response is Failure<T> {\r\n        return Object.hasOwnProperty.call(response, \"error\");\r\n    }\r\n\r\n    export interface Error<T> {\r\n        /** Must be an integer */\r\n        code: number;\r\n        message: string;\r\n        data?: T;\r\n    }\r\n\r\n//\r\n// PRE-DEFINED ERROR CODES\r\n//\r\n//\r\n    /** An error occurred on the server while parsing the JSON text. */\r\n    const PARSE_ERROR = -32700;\r\n    /** The JSON sent is not a valid Request object. */\r\n    const INVALID_REQUEST = -32600;\r\n    /** The method does not exist / is not available. */\r\n    const METHOD_NOT_FOUND = -32601;\r\n    /** Invalid method parameter(s). */\r\n    const INVALID_PARAMS = -32602;\r\n    /** Internal JSON-RPC error. */\r\n    const INTERNAL_ERROR = -32603;\r\n\r\n//\r\n// TYPE GUARDS (for convinience)\r\n//\r\n//\r\n    /** Determine if data is a properly formatted JSONRPC 2.0 ID. */\r\n    export function isJsonRpcId(input: OptionalId | any): input is OptionalId {\r\n        switch (typeof input) {\r\n            case \"string\":\r\n                return true;\r\n            case \"number\":\r\n                return input % 1 != 0;\r\n            case \"object\":\r\n                let isNull = input === null;\r\n                if (isNull) {\r\n                    console.warn(\"Use of null ID in JSONRPC 2.0 is discouraged.\");\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n}","import {EventEmitter} from \"./eventEmitter\";\r\nimport {JsonRpc} from \"./jsonrpc\";\r\nimport isSuccess = JsonRpc.isSuccess;\r\nimport isFailure = JsonRpc.isFailure;\r\n\r\nfunction snakeToCamel(name: string) {\r\n    return name.replace(/(_[a-z])/g, (match) =>\r\n        match.toUpperCase().replace(\"_\", \"\")\r\n    );\r\n}\r\n\r\ntype PendingRequest = {resolve: (value: unknown) => void, reject: (reason?:any) => void};\r\n\r\ntype SendType = \"rpc\" | \"fireAndForget\";\r\n\r\ntype PendingRequests = { [k: string]: PendingRequest};\r\n\r\nexport class JsonRpcController extends EventEmitter {\r\n    private readonly _pendingRequests: PendingRequests;\r\n    private _webSocket: WebSocket | null;\r\n    private currentDelay: number;\r\n    private readonly webSocketUrl: string;\r\n    private readonly backoffDelayMin: number;\r\n    private readonly backoffDelayMax: number;\r\n\r\n    constructor(webSocketUrl: string, backoffDelayMin: number, backoffDelayMax: number) {\r\n        super();\r\n        this.webSocketUrl = webSocketUrl;\r\n        this._pendingRequests = {};\r\n        this._webSocket = null;\r\n        this.currentDelay = backoffDelayMin;\r\n        this.backoffDelayMin = backoffDelayMin;\r\n        this.backoffDelayMax = backoffDelayMax;\r\n        this.hookUpEvents();\r\n    }\r\n\r\n    private hookUpEvents() {\r\n        this.on(\"websocket:close\", this.onWebSocketClose);\r\n        this.on(\"websocket:error\", this.handleWebSocketError);\r\n        this.on(\"websocket:incomingMessage\", this.handleMessage);\r\n    }\r\n\r\n    connect() {\r\n        if (this._webSocket) {\r\n            if (this._webSocket.readyState === WebSocket.OPEN) {\r\n                return;\r\n            }\r\n            this._webSocket.close();\r\n        }\r\n\r\n        this._webSocket = new WebSocket(this.webSocketUrl);\r\n\r\n        this._webSocket.onclose = (close) => {\r\n            this.emit(\"websocket:close\", close);\r\n        };\r\n        this._webSocket.onerror = (error) => {\r\n            this.emit(\"websocket:error\", error);\r\n        };\r\n        this._webSocket.onopen = () => {\r\n            this.emit(\"websocket:open\");\r\n            this.currentDelay = this.backoffDelayMin;\r\n\r\n        };\r\n        this._webSocket.onmessage = (message) => {\r\n            this.emit(\"websocket:incomingMessage\", message);\r\n        };\r\n    }\r\n\r\n    private onWebSocketClose(closeEvent: any) {\r\n        Object.keys(this._pendingRequests).forEach((requestId) => {\r\n            const {reject} = this._pendingRequests[requestId];\r\n            delete this._pendingRequests[requestId];\r\n            const error = new ConnectionError(\"WebSocket closed\");\r\n            error.closeEvent = closeEvent;\r\n            reject(error);\r\n        });\r\n        this._reconnect();\r\n    }\r\n\r\n    close() {\r\n        this.eventOff(\"state:offline\", this._reconnect);\r\n        if (this._webSocket) {\r\n            this._webSocket.close();\r\n        }\r\n    }\r\n\r\n    eventOff(eventName?: string, callback?: any) {\r\n        if (!eventName) {\r\n            this.removeAllListeners();\r\n            return;\r\n        }\r\n        if (!callback) {\r\n            this.removeAllListeners(eventName);\r\n            return;\r\n        }\r\n        this.removeListener(eventName, callback);\r\n    }\r\n\r\n    private handleWebSocketError(error: any) {\r\n        console.warn(\"WebSocket error:\", error.stack || error);\r\n    }\r\n\r\n    send(message: Object, type: SendType = \"rpc\" ){\r\n        switch (this._webSocket?.readyState) {\r\n            case WebSocket.CONNECTING:\r\n                return Promise.reject(\r\n                    new ConnectionError(\"WebSocket is still connecting\")\r\n                );\r\n            case WebSocket.CLOSING:\r\n                return Promise.reject(\r\n                    new ConnectionError(\"WebSocket is closing\")\r\n                );\r\n            case WebSocket.CLOSED:\r\n                return Promise.reject(\r\n                    new ConnectionError(\"WebSocket is closed\")\r\n                );\r\n            default:\r\n                if (type === \"fireAndForget\") {\r\n                    this._webSocket?.send(JSON.stringify(message));\r\n                    return Promise.resolve();\r\n                }\r\n                return new Promise((resolve, reject) => {\r\n                    const jsonRpcMessage = {\r\n                        ...message,\r\n                        jsonrpc: \"2.0\",\r\n                        id: this._nextRequestId(),\r\n                    };\r\n                    this._pendingRequests[jsonRpcMessage.id] = {resolve, reject};\r\n                    this._webSocket?.send(JSON.stringify(jsonRpcMessage));\r\n                    this.emit(\"websocket:outgoingMessage\", jsonRpcMessage);\r\n                });\r\n        }\r\n    }\r\n\r\n    private handleMessage(message: {data: string}) {\r\n        try {\r\n            const data = JSON.parse(message.data);\r\n            if (Object.hasOwnProperty.call(data, \"id\")) {\r\n                this.handleRpcResponse(data);\r\n            } else if (Object.hasOwnProperty.call(data, \"event\")) {\r\n                this.handleEvent(data);\r\n            } else {\r\n                console.warn(\r\n                    `Unknown message type received. Message was: ${message.data}`\r\n                );\r\n            }\r\n        } catch (error) {\r\n            if (error instanceof SyntaxError) {\r\n                console.warn(\r\n                    `WebSocket message parsing failed. Message was: ${message.data}`\r\n                );\r\n            } else {\r\n                throw error;\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleRpcResponse(responseMessage: JsonRpc.ResponseWithId<any>) {\r\n        if (!Object.hasOwnProperty.call(this._pendingRequests, responseMessage.id)) {\r\n            console.warn(\r\n                \"Unexpected response received. Message was:\",\r\n                responseMessage\r\n            );\r\n            return;\r\n        }\r\n        const {resolve, reject} = this._pendingRequests[responseMessage.id];\r\n        delete this._pendingRequests[responseMessage.id];\r\n        if (isSuccess(responseMessage)) {\r\n            resolve(responseMessage.result);\r\n        } else if (isFailure(responseMessage)) {\r\n            const error = new ServerError(responseMessage.error.message);\r\n            error.code = responseMessage.error.code;\r\n            error.data = responseMessage.error.data;\r\n            reject(error);\r\n            console.warn(\"Server returned error:\", responseMessage.error);\r\n        } else {\r\n            const error = new OtherError(\"Response without 'result' or 'error' received\");\r\n            error.data = {response: responseMessage};\r\n            reject(error);\r\n            console.warn(\r\n                \"Response without 'result' or 'error' received. Message was:\",\r\n                responseMessage\r\n            );\r\n        }\r\n    }\r\n\r\n    private handleEvent(eventMessage: { event: string; }) {\r\n        const data = {...eventMessage};\r\n        // @ts-ignore\r\n        delete data.event;\r\n        const eventName = `event:${snakeToCamel(eventMessage.event)}`;\r\n        this.emit(\"event\", [eventName, data]);\r\n        this.emit(eventName, data);\r\n    }\r\n\r\n    static idCounter = -1;\r\n\r\n    _nextRequestId() {\r\n        return ++JsonRpcController.idCounter;\r\n    }\r\n\r\n    _reconnect() {\r\n        // We asynchronously process the reconnect because we don't want to start\r\n        // emitting \"reconnectionPending\" events before we've finished handling the\r\n        // \"state:offline\" event, which would lead to emitting the events to\r\n        // listeners in the wrong order.\r\n        setTimeout(() => {\r\n            this.emit(\"state\", [\r\n                \"reconnectionPending\",\r\n                { timeToAttempt: this.currentDelay}\r\n            ]);\r\n            this.emit(\"reconnectionPending\", {\r\n                timeToAttempt: this.currentDelay,\r\n            });\r\n            setTimeout(() => {\r\n                this.emit(\"state\", \"reconnecting\");\r\n                this.emit(\"reconnecting\");\r\n                this.connect();\r\n            }, this.currentDelay);\r\n            this.currentDelay *= 2;\r\n            if (this.currentDelay > this.backoffDelayMax) {\r\n                this.currentDelay = this.backoffDelayMax;\r\n            }\r\n        }, 0);\r\n    }\r\n}\r\n\r\nclass ConnectionError extends Error {\r\n    closeEvent?: any;\r\n\r\n    constructor(message: string) {\r\n        super(message);\r\n        this.name = \"ConnectionError\";\r\n    }\r\n}\r\n\r\nclass ServerError extends Error {\r\n    code: any;\r\n    data: any;\r\n\r\n    constructor(message: string) {\r\n        super(message);\r\n        this.name = \"ServerError\";\r\n    }\r\n}\r\n\r\nclass OtherError extends Error {\r\n    data: any;\r\n\r\n    constructor(message: string) {\r\n        super(message);\r\n        this.name = \"OtherError\";\r\n    }\r\n}","// Type definitions for js v1.2.0, Mopidy v3.0.2 WebSocket API\r\n\r\nimport {JsonRpcController} from \"../typescript/jsonRpcController\";\r\nimport {AlbumUri, AllUris, StreamUri, TrackUri} from \"../typescript/modelTypes\";\r\nimport MopidyEventName = core.MopidyEventName;\r\n\r\nexport type Branded<T, Brand> = T & { __brand: Brand };\r\n\r\nexport interface Options {\r\n    /**\r\n     * URL used when creating new WebSocket objects.\r\n     *\r\n     * In a browser environment, it defaults to\r\n     * ws://${document.location.host}/mopidy/ws. If the current page is served\r\n     * over HTTPS, it defaults to using wss:// instead of ws://.\r\n     *\r\n     * In a non-browser environment, where document.location isn't available, it\r\n     * defaults to ws://localhost/mopidy/ws.\r\n     */\r\n    webSocketUrl?: string | null;\r\n    /**\r\n     * Whether or not to connect to the WebSocket on instance creation. Defaults\r\n     * to true.\r\n     */\r\n    autoConnect?: boolean;\r\n    /**\r\n     * The minimum number of milliseconds to wait after a connection error before\r\n     * we try to reconnect. For every failed attempt, the backoff delay is doubled\r\n     * until it reaches backoffDelayMax. Defaults to 1000.\r\n     */\r\n    backoffDelayMin?: number;\r\n    /**\r\n     * The maximum number of milliseconds to wait after a connection error before\r\n     * we try to reconnect. Defaults to 64000.\r\n     */\r\n    backoffDelayMax?: number;\r\n    /**\r\n     * If set, this object will be used to log errors from Mopidy.js. This is\r\n     * mostly useful for testing Mopidy.js. Defaults to console.\r\n     */\r\n}\r\n\r\n\r\nexport interface ResolvedOptions {\r\n    webSocketUrl: string;\r\n    autoConnect: boolean;\r\n    backoffDelayMin: number;\r\n    backoffDelayMax: number;\r\n}\r\n\r\ntype URI = string;\r\nexport type TlId = Branded<number, \"TlId\">;\r\nnamespace models {\r\n    export type ModelType = \"album\" | \"artist\" | \"directory\" | \"playlist\" | \"track\";\r\n\r\n    export class TlTrack {\r\n        readonly tlid: TlId;\r\n        readonly track: Track;\r\n    }\r\n    export class Track {\r\n        readonly uri: TrackUri | StreamUri;\r\n        readonly name?: string;\r\n        readonly artists: Artist[];\r\n        readonly album?: Album;\r\n        readonly composers: Artist[];\r\n        readonly performers: Artist[];\r\n        readonly genre?: string;\r\n        readonly track_no?: number;\r\n        readonly disc_no?: number;\r\n        readonly date?: string;\r\n        readonly length?: number;\r\n        readonly bitrate?: string;\r\n        readonly comment?: string;\r\n        readonly musicbrainz_id?: string;\r\n        readonly last_modified?: number;\r\n    }\r\n    export class SearchResult {\r\n        readonly uri: URI;\r\n        readonly tracks: Track[];\r\n        readonly artists: Artist[];\r\n        readonly albums: Album[];\r\n    }\r\n\r\n    export class Artist {\r\n        readonly uri: URI;\r\n        readonly name: string;\r\n        readonly sortname: string;\r\n        readonly musicbrainz_id: string;\r\n    }\r\n\r\n    export class Album {\r\n        readonly uri: AlbumUri;\r\n        readonly name: string;\r\n        readonly artists: Artist[];\r\n        readonly num_tracks: number;\r\n        readonly num_discs: number;\r\n        readonly date: string;\r\n        readonly musicbrainz_id: string;\r\n    }\r\n\r\n    export class Image {\r\n        readonly uri: URI;\r\n        readonly width: number;\r\n        readonly height: number;\r\n    }\r\n\r\n    export class Playlist {\r\n        readonly uri: URI;\r\n        readonly name: string;\r\n        readonly tracks: Track[];\r\n        readonly last_modified: number;\r\n        readonly length: number;\r\n    }\r\n\r\n    export class Ref<T extends AllUris> {\r\n        readonly uri: T;\r\n        name?: string;\r\n        readonly type: ModelType;\r\n    }\r\n\r\n    export type Dict<T> =\r\n        { length: number }\r\n        & { [k: string]: T };\r\n}\r\nexport default models\r\n\r\nexport namespace core {\r\n    export type PlaybackState = \"playing\" | \"paused\" | \"stopped\";\r\n    export type QueryField =\r\n        | \"uri\"\r\n        | \"track_name\"\r\n        | \"album\"\r\n        | \"artist\"\r\n        | \"albumartist\"\r\n        | \"composer\"\r\n        | \"performer\"\r\n        | \"track_no\"\r\n        | \"genre\"\r\n        | \"date\"\r\n        | \"comment\"\r\n        | \"any\";\r\n    export type Query = { [key in QueryField]?: string[] };\r\n\r\n    export type MopidyEventName =\r\n        | \"event:trackPlaybackStarted\"\r\n        | \"event:trackPlaybackEnded\"\r\n        | \"event:trackPlaybackResumed\"\r\n        | \"state:online\"\r\n        | \"state:offline\"\r\n        | \"event:optionsChanged\"\r\n        | \"event:playlistChanged\"\r\n        | \"event:playlistDeleted\"\r\n        | \"event:volumeChanged\"\r\n        | \"event:muteChanged\"\r\n        | \"event:streamTitleChanged\"\r\n        | \"event:playbackStateChanged\"\r\n        | \"event:optionsValidationError\"\r\n        | \"event:tracklistChanged\"\r\n        | \"event:seeked\"\r\n        | \"event:playlistsLoaded\"\r\n        ;\r\n\r\n    export type FilterField = 'tlid' | \"uri\";\r\n    export type FilterCriteria = {\r\n        [key in FilterField]?: string[];\r\n    }\r\n\r\n}\r\n\r\nexport class Mopidy {\r\n    _options: ResolvedOptions;\r\n    private rpcController: JsonRpcController;\r\n    constructor(options: Options) {\r\n        this._options = this._configure(options);\r\n        this.rpcController = new JsonRpcController(this._options.webSocketUrl, this._options.backoffDelayMin, this._options.backoffDelayMax);\r\n        this._delegateEvents();\r\n        if (this._options.autoConnect) {\r\n            this.connect();\r\n        }\r\n    }\r\n\r\n    connect() {\r\n        this.rpcController.connect();\r\n    }\r\n\r\n    on(name: MopidyEventName | Function, callback?: any) {\r\n        this.rpcController?.on(name, callback);\r\n    }\r\n\r\n    private _configure(options: Options): ResolvedOptions {\r\n        let defaultOptions: ResolvedOptions = {\r\n            backoffDelayMin: 1000,\r\n            backoffDelayMax: 64000,\r\n            autoConnect: true,\r\n            webSocketUrl: this.resolveWebSocketUrl(options)\r\n        };\r\n\r\n        return {\r\n            webSocketUrl: options.webSocketUrl ?? defaultOptions.webSocketUrl,\r\n            autoConnect: options.autoConnect ?? defaultOptions.autoConnect,\r\n            backoffDelayMin: options.backoffDelayMin ?? defaultOptions.backoffDelayMin,\r\n            backoffDelayMax: options.backoffDelayMax ?? defaultOptions.backoffDelayMax\r\n        };\r\n        }\r\n\r\n    private resolveWebSocketUrl(options: Options): string {\r\n        if(options.webSocketUrl)\r\n            return options.webSocketUrl;\r\n\r\n        let protocol =\r\n            typeof document !== \"undefined\" && document.location.protocol === \"https:\"\r\n                ? \"wss://\"\r\n                : \"ws://\";\r\n        let currentHost =\r\n            (typeof document !== \"undefined\" && document.location.host) ||\r\n            \"localhost\";\r\n        return `${protocol}${currentHost}/mopidy/ws`;\r\n    }\r\n\r\n    _delegateEvents() {\r\n        this.rpcController.on(\"websocket:close\", (closeEvent: any) => this.onWebSocketClose(closeEvent));\r\n        this.rpcController.on(\"websocket:open\", () => this._onWebsocketOpen());\r\n    }\r\n\r\n    onWebSocketClose(closeEvent: any) {\r\n        this.rpcController.emit(\"state\", \"state:offline\");\r\n        this.rpcController.emit(\"state:offline\");\r\n    }\r\n\r\n    close() {\r\n        if (this.rpcController) {\r\n            this.rpcController.close();\r\n        }\r\n    }\r\n\r\n    send(method: string, params?: Object) {\r\n        if(params)\r\n            return this.rpcController?.send({method, params});\r\n        else\r\n            return this.rpcController?.send({method});\r\n    }\r\n\r\n    _onWebsocketOpen() {\r\n    this.rpcController.emit(\"state\", \"state:online\");\r\n    this.rpcController.emit(\"state:online\");\r\n  }\r\n}","import models from \"../js/mopidy\";\r\nimport {RefType} from \"./refs\";\r\n\r\n// Stretch a value, e.g., between (0, 100), to a new range e.g., (-5, 100)\r\nfunction stretchLeft(x: number, min: number, max: number) {\r\n    return x*(max+min)/max - min;\r\n}\r\n\r\nexport function quadratic100(x: number) {\r\n    x = stretchLeft(x, -5, 100);\r\n    return (x * x) / 100;\r\n}\r\n\r\nexport function inverseQuadratic100(y: number) {\r\n    let x = Math.floor(Math.sqrt(y * 100));\r\n    return stretchLeft(x, 5, 100);\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nexport function cubic100(x: number) {\r\n    return (x * x * x) / 10000;\r\n}\r\n\r\nexport function getHostAndPort() {\r\n    let hostDefs = getHostAndPortDefs();\r\n    return hostDefs.altHost ?? hostDefs.host;\r\n}\r\n\r\nexport function getBaseUrl() {\r\n    return `http://${getHostAndPort()}`;\r\n}\r\n\r\nexport function getHostAndPortDefs() {\r\n    let altHostName = document.body.dataset.hostname ?? null;\r\n    if (altHostName?.startsWith(\"{{\"))\r\n        altHostName = null;\r\n\r\n    if(!altHostName) {\r\n        altHostName = localStorage.getItem(\"eboplayer.hostName\");\r\n    }\r\n    return {host: document.location.host, altHost: altHostName};\r\n}\r\n\r\nexport function isStream(track: models.Track) {\r\n    return !track.last_modified;\r\n}\r\n\r\nexport function console_yellow(msg: string) {\r\n    console.log(`%c${msg}`, 'background-color: yellow');\r\n}\r\n\r\nexport function unreachable(x: never): never {\r\n    throw new Error(\"This error will never be thrown. It is used for type safety.\");\r\n}\r\n\r\n// Source - https://stackoverflow.com/a/51389944\r\n// Posted by YairTawil, modified by community. See post 'Timeline' for change history\r\n// Retrieved 2026-01-26, License - CC BY-SA 4.0\r\n\r\nexport function arrayToggle<T>(arr: Array<T>, item: T) {\r\n    if (arr.includes(item))\r\n        return arr.filter(i => i !== item);\r\n    else\r\n        return [...arr, item];\r\n}\r\n\r\nexport function getDefaultImageUrl(refType: RefType, defaultImageUrl?: string): string {\r\n    if (defaultImageUrl)\r\n        return defaultImageUrl;\r\n\r\n    switch (refType) {\r\n        case \"album\": return \"images/icons/Album.svg\";\r\n        case \"artist\": return \"images/icons/Artist.svg\";\r\n        case \"playlist\": return \"images/icons/Playlist.svg\";\r\n        case \"track\": return \"images/icons/Album.svg\";\r\n        case \"radio\": return \"images/icons/Radio.svg\";\r\n        case \"genre\": return \"images/icons/Genre.svg\";\r\n        default:\r\n            unreachable(refType);\r\n    }\r\n}\r\n\r\nfunction escapeGoogleSearchString(albumName: string) {\r\n    let escaped = albumName\r\n        .replaceAll(\"+\", \"%2B\")\r\n        .replaceAll(\"\\n\", \"+\")\r\n        .replaceAll(\" \", \"+\")\r\n        .replaceAll(\"'\", \"%27\")\r\n        .replaceAll(\"&\", \"%26\")\r\n        .replaceAll(\"(\", \"%28\")\r\n        .replaceAll(\")\", \"%29\")\r\n        .replaceAll(\":\", \"%3A\")\r\n        .replaceAll(\"!\", \"%21\")\r\n        .replaceAll(\"?\", \"%3F\")\r\n        .replaceAll(\"|\", \"%7C\")\r\n        .replaceAll(\"=\", \"%3D\");\r\n    return escaped;\r\n}\r\n\r\nexport function searchOnGoogle(albumName: string) {\r\n    let escaped = escapeGoogleSearchString(albumName);\r\n    window.open(\"https://www.google.com/search?q=\" + escaped, '_blank')?.focus();\r\n}\r\n\r\nexport function searchImageOnGoogle(albumName: string) {\r\n    let escaped = escapeGoogleSearchString(albumName);\r\n    window.open(\"https://www.google.com/search?tbm=isch&q=\" + escaped, '_blank')?.focus();\r\n}","import models from \"../js/mopidy\";\r\nimport {AllUris, BrowseFilter} from \"./modelTypes\";\r\nimport {Controller} from \"./controllers/controller\";\r\nimport {getBaseUrl, getDefaultImageUrl} from \"./global\";\r\nimport Ref = models.Ref;\r\nimport {CacheHandler} from \"./controllers/cacheHandler\";\r\n\r\nexport type RefType = \"album\" | \"artist\" | \"playlist\" | \"track\" | \"genre\" | \"radio\";\r\nexport interface ExpandedRef {\r\n    refType: RefType,\r\n    name: string,\r\n    uri: string,\r\n    lastModified: number | null,\r\n    idMaxImage: number | null,\r\n    idMinImage: number | null\r\n}\r\n\r\nabstract class SearchResultParent {\r\n    protected type: \"ref\" | \"genreReplacement\";\r\n    item: ExpandedRef;\r\n    weight: number;\r\n    protected defaultImageUrl?: string;\r\n    protected constructor(type: \"ref\" | \"genreReplacement\", item: ExpandedRef, weight: number, defaultImageUrl?: string) {\r\n        this.type = type;\r\n        this.item = item;\r\n        this.weight = weight;\r\n        this.defaultImageUrl = defaultImageUrl;\r\n    }\r\n\r\n    getImageUrl(): string {\r\n        if (this.item.idMaxImage) {\r\n            return getBaseUrl()+\"/eboback/image/\" + this.item.idMaxImage;\r\n        }\r\n        return this.defaultImageUrl ?? \"--no default image url--\";\r\n    }\r\n}\r\n\r\nexport class RefSearchResult extends SearchResultParent {\r\n    cache: CacheHandler;\r\n    constructor(item: ExpandedRef, weight: number, cache: CacheHandler, defaultImageUrl?: string) {\r\n        super(\"ref\", item, weight, getDefaultImageUrl(item.refType, defaultImageUrl));\r\n        this.cache = cache;\r\n    }\r\n\r\n}\r\n\r\nexport class GenreSearchResult  extends SearchResultParent {\r\n    cache: CacheHandler;\r\n    constructor(item: ExpandedRef, weight: number, cache: CacheHandler, imageUrl?: string) {\r\n        super(\"genreReplacement\", item, weight, \"images/icons/Genre.svg\");\r\n        this.cache = cache;\r\n    }\r\n    getExpandedModel() {\r\n        return this.cache.getGenreReplacementCached(this.item.name ?? \"???\");\r\n    }\r\n}\r\n\r\nexport type SearchResult = RefSearchResult | GenreSearchResult;\r\n\r\nexport interface SearchResults {\r\n    refs: SearchResult[];\r\n    availableRefTypes: Set<RefType>;\r\n}\r\n\r\nexport const EmptySearchResults: SearchResults = {refs: [], availableRefTypes: new Set()};\r\n\r\nexport abstract class Refs {\r\n    protected searchResults: SearchResults;\r\n\r\n    get browseFilter(): BrowseFilter {\r\n        return this._browseFilter;\r\n    }\r\n\r\n    protected constructor() {\r\n        this.searchResults = { refs:[], availableRefTypes:new Set()};\r\n    }\r\n\r\n    set browseFilter(value: BrowseFilter) {\r\n        this._browseFilter = value;\r\n    }\r\n    private _browseFilter: BrowseFilter;\r\n\r\n    abstract filter(): Promise<void>;\r\n\r\n    protected async calculateWeight(result: SearchResult, browseFilter: BrowseFilter, thresholdDate: number) {\r\n        if(!browseFilter.isNoTypeSelected()) {\r\n            if (result instanceof RefSearchResult) {\r\n                if (result.item.refType == \"album\" && !browseFilter.album\r\n                    || result.item.refType == \"track\" && !browseFilter.track\r\n                    || result.item.refType == \"artist\" && !browseFilter.artist\r\n                    || result.item.refType == \"playlist\" && !browseFilter.playlist\r\n                    || result.item.refType == \"radio\" && !browseFilter.radio)\r\n                    return;\r\n            }\r\n            if (result instanceof GenreSearchResult && !browseFilter.genre)\r\n                return;\r\n        }\r\n        if (result.item.name?.toLowerCase().startsWith(browseFilter.searchText.toLowerCase()))\r\n            result.weight += 100;\r\n        if (result.item.name?.toLowerCase().includes(browseFilter.searchText.toLowerCase()))\r\n            result.weight += 100;\r\n        if (!browseFilter.searchText)\r\n            result.weight += 1; //No search text? Give every result a weight of 1, so that they are always shown.\r\n        if(result.weight == 0)\r\n            return;\r\n        if(browseFilter.addedSince == 0)\r\n            return;\r\n        if(!(result instanceof RefSearchResult)) {\r\n            result.weight = 0;\r\n            return;\r\n        }\r\n        if(browseFilter.addedSince == 0)\r\n            return;\r\n        if((browseFilter.album || browseFilter.isNoTypeSelected()) && result.item.refType == \"album\") {\r\n            this.calculateDateFilter(result.item.lastModified, result, browseFilter, thresholdDate);\r\n        }\r\n        if((browseFilter.track || browseFilter.isNoTypeSelected()) && result.item.refType == \"track\") {\r\n            this.calculateDateFilter(result.item.lastModified, result, browseFilter, thresholdDate);\r\n        }\r\n        if(browseFilter.addedSince > 0 && result.item.refType != \"album\" && result.item.refType != \"track\")\r\n            result.weight = 0;\r\n    }\r\n\r\n    protected calculateDateFilter(modifiedDate: number|null, result: SearchResult, browseFilter: BrowseFilter, thresholdDate: number) {\r\n        if(!modifiedDate)\r\n            return;\r\n        modifiedDate /= 1000;\r\n        if(thresholdDate > modifiedDate)\r\n            result.weight = 0;\r\n    }\r\n\r\n    setFilter(browseFilter: BrowseFilter) {\r\n        this._browseFilter = browseFilter;\r\n    }\r\n\r\n    protected async applyFilter(searchResults: SearchResult[]) {\r\n        searchResults.forEach(result => {\r\n            result.weight = 0;\r\n        });\r\n\r\n        let currentPosixDate = Math.floor(Date.now() / 1000);\r\n        let addedSinceInSeconds = this.browseFilter.addedSince * 60 * 60 * 24;\r\n        let thresholdDate = currentPosixDate - addedSinceInSeconds;\r\n\r\n        for (const result of searchResults) {\r\n            await this.calculateWeight(result, this.browseFilter, thresholdDate);\r\n        }\r\n        return searchResults\r\n            .filter(result => result.weight > 0)\r\n            .sort((a, b) => {\r\n                if (b.weight === a.weight) {\r\n                    return a.item.name?.localeCompare(b.item.name?? \"\")?? 0;\r\n                }\r\n                return b.weight - a.weight\r\n            });\r\n    }\r\n\r\n    getSearchResults(): SearchResults {\r\n        return this.searchResults;\r\n    }\r\n\r\n    protected getAvailableRefTypes(refs: SearchResult[]) {\r\n        return refs\r\n            .map(r => r instanceof RefSearchResult ? r.item.refType : \"genre\")\r\n            .reduce((typeSet, val) => typeSet.add(val), new Set<RefType>());\r\n    }\r\n\r\n    static toRefType(ref: models.Ref<AllUris>): RefType {\r\n        if (![\"directory\", \"track\"].includes(ref.type)) {\r\n            return ref.type as RefType;\r\n        }\r\n        if (ref.uri.startsWith(\"eboback:stream:\"))\r\n            return \"radio\";\r\n        if (ref.uri.startsWith(\"eboback:directory?genre\"))\r\n            return \"genre\";\r\n        return ref.type as RefType; //WARNING: this really is an unknown type!\r\n    }\r\n\r\n    static transformRefsToSearchResults(cache: CacheHandler, refs: Ref<AllUris>[]): SearchResult[] {\r\n        let results = refs.map(ref => {\r\n            let refType = SomeRefs.toRefType(ref);\r\n            if(refType == \"genre\") {\r\n                let expandedRef: ExpandedRef = {refType: refType, name: ref.name?? '???', uri: ref.uri, lastModified: null, idMaxImage: null, idMinImage: null};\r\n                return new GenreSearchResult(expandedRef,-1, cache);\r\n            }\r\n            let expandedRef: ExpandedRef = {refType: refType, name: ref.name?? \"???\", uri: ref.uri, lastModified: null, idMaxImage: null, idMinImage: null};\r\n            return new RefSearchResult(expandedRef,-1, cache);\r\n        });\r\n        // make genreDefs distinct and keep removed defs separate.\r\n        return results;\r\n    }\r\n\r\n    static async reduceResults(results: (GenreSearchResult | RefSearchResult)[]) {\r\n        let resultsWithoutGenreDefs = results.filter(result => ! (result instanceof GenreSearchResult));\r\n        let onlyGenreDefResults = results.filter(result => result instanceof GenreSearchResult);\r\n\r\n        let onlyWithoutReplacementResults = (await Promise.all(onlyGenreDefResults\r\n            .map(async r => {\r\n                return {result: r, genreReplacement: await r.getExpandedModel()};\r\n            })))\r\n            .filter(r => r.genreReplacement != null && r.genreReplacement.replacement == null)\r\n            .map(r => r.result);\r\n        let onlyWithoutReplacementResultsMap = new Map<string, GenreSearchResult>();\r\n        onlyWithoutReplacementResults.forEach(result => {\r\n            onlyWithoutReplacementResultsMap.set(result.item.name?? \"???\", result);\r\n        });\r\n\r\n        for (const result of onlyGenreDefResults) {\r\n            let name: string;\r\n            let def = await result.getExpandedModel();\r\n            if (def?.replacement != null) {\r\n                name = def.replacement;\r\n            } else {\r\n                name = result.item.name ?? \"???\";\r\n            }\r\n            if(!onlyWithoutReplacementResultsMap.has(name))\r\n                onlyWithoutReplacementResultsMap.set(name, result);\r\n        }\r\n        return [...resultsWithoutGenreDefs, ...Array.from(onlyWithoutReplacementResultsMap.values())];\r\n    }\r\n}\r\n\r\nexport async function createAllRefs(cache: CacheHandler, allRefs: ExpandedRef[]) {\r\n    return new AllRefs(cache, allRefs);\r\n}\r\n\r\nfunction filterRefsToResult(refs: ExpandedRef[], refType: RefType, cache: CacheHandler) {\r\n    return refs\r\n        .filter(ref => ref.refType == refType)\r\n        .map(expandedRef => {\r\n            return new RefSearchResult(expandedRef, 0, cache);\r\n        });\r\n}\r\n\r\nexport class AllRefs extends Refs {\r\n    allRefs: ExpandedRef[];\r\n    tracks: SearchResult[];\r\n    albums: SearchResult[];\r\n    artists: SearchResult[];\r\n    genres: SearchResult[];\r\n    radios: SearchResult[];\r\n    playlists: SearchResult[];\r\n    availableRefTypes: Set<RefType>;\r\n\r\n    constructor(cache: CacheHandler, allRefs: ExpandedRef[]) {\r\n        super();\r\n        this.allRefs = allRefs;\r\n        this.tracks = filterRefsToResult(allRefs, \"track\", cache);\r\n        this.albums = filterRefsToResult(allRefs, \"album\", cache);\r\n        this.artists = filterRefsToResult(allRefs, \"artist\", cache);\r\n        this.radios = filterRefsToResult(allRefs, \"radio\", cache);\r\n        this.genres = allRefs\r\n            .filter(ref => ref.refType == \"genre\")\r\n            .map(expandedRef => {\r\n                return new GenreSearchResult(expandedRef, 0, cache);\r\n            });\r\n        this.playlists = filterRefsToResult(allRefs, \"playlist\", cache);\r\n\r\n        this.availableRefTypes = new Set();\r\n        this.getAvailableRefTypes(this.tracks).forEach(type => this.availableRefTypes.add(type));\r\n        this.getAvailableRefTypes(this.albums).forEach(type => this.availableRefTypes.add(type));\r\n        this.getAvailableRefTypes(this.artists).forEach(type => this.availableRefTypes.add(type));\r\n        this.getAvailableRefTypes(this.radios).forEach(type => this.availableRefTypes.add(type));\r\n        this.getAvailableRefTypes(this.genres).forEach(type => this.availableRefTypes.add(type));\r\n        this.getAvailableRefTypes(this.playlists).forEach(type => this.availableRefTypes.add(type));\r\n    }\r\n\r\n    async filter() {\r\n        this.searchResults = {\r\n            refs: await this.applyFilter(this.prefillWithTypes(this.browseFilter)),\r\n            availableRefTypes: this.availableRefTypes\r\n        };\r\n    }\r\n\r\n    private prefillWithTypes(browseFilter: BrowseFilter): SearchResult[] {\r\n        let refs: SearchResult[] =  [];\r\n        if(browseFilter.album || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.albums);\r\n        if(browseFilter.artist || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.artists);\r\n        if(browseFilter.track || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.tracks);\r\n        if(browseFilter.genre || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.genres);\r\n        if(browseFilter.radio || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.radios);\r\n        if(browseFilter.playlist || browseFilter.isNoTypeSelected())\r\n            refs.push(...this.playlists);\r\n        return refs;\r\n    }\r\n}\r\n\r\nexport class SomeRefs extends Refs {\r\n    allresults: SearchResult[];\r\n    availableRefTypes: Set<RefType>;\r\n\r\n    constructor(cache: CacheHandler,  refs: Ref<AllUris>[]) {\r\n        super();\r\n        this.allresults = Refs.transformRefsToSearchResults(cache, refs);\r\n        this.availableRefTypes = this.getAvailableRefTypes(this.allresults);\r\n    }\r\n\r\n    async filter() {\r\n        this.searchResults = {\r\n            refs: await this.applyFilter(this.allresults),\r\n            availableRefTypes: this.availableRefTypes\r\n        };\r\n    }\r\n}\r\n\r\n","export interface WithId<T> {\r\n    id: T;\r\n}\r\n\r\nexport class IdStack<T extends WithId<Tid>, Tid> extends Array<T> {\r\n    resetTo(id: number) {\r\n        let index = this.findIndex((breadCrumb, index, obj) => {\r\n            return breadCrumb.id == id;\r\n        });\r\n        this.splice(index + 1);\r\n    }\r\n\r\n    getLast(): WithId<Tid> | undefined {\r\n        return this[this.length - 1];\r\n    }\r\n\r\n    get(id: number): WithId<Tid> | undefined {\r\n        return this.find(crumb => crumb.id == id);\r\n    }\r\n}","import {IdStack, WithId} from \"./util/idStack\";\r\n\r\nexport class BreadCrumb<Tdata, TName extends string> implements WithId<number>{\r\n    id: number;\r\n    label: string;\r\n    data: Tdata;\r\n    type: TName\r\n\r\n    private static nextId = 1;\r\n\r\n\r\n    constructor(label: string, value: Tdata, type: TName) {\r\n        this.label = label;\r\n        this.data = value;\r\n        this.id = BreadCrumb.nextId++;\r\n        this.type = type;\r\n    }\r\n}\r\n\r\nexport class BreadCrumbStack<TName extends string, Tbreadcrumb extends BreadCrumb<any, TName> & WithId<number>,> extends IdStack<Tbreadcrumb, number> {}\r\n","import models, {Branded} from \"../js/mopidy\";\r\nimport {BreadCrumb} from \"./breadCrumb\";\r\nimport {ExpandedRef} from \"./refs\";\r\nimport {Controller} from \"./controllers/controller\";\r\nimport {getBaseUrl, getDefaultImageUrl} from \"./global\";\r\nimport Ref = models.Ref;\r\nimport Image = models.Image;\r\nimport Artist = models.Artist;\r\n\r\ndeclare const __brand: unique symbol;\r\n\r\nexport type RememberId = Branded<string, \"RememberId\">;\r\n\r\nexport interface RememberDef {\r\n    id: RememberId,\r\n    text: string,\r\n}\r\n\r\nexport type AlbumUri = Branded<string, \"AlbumUri\">;\r\nexport type TrackUri = Branded<string, \"TrackUri\">;\r\nexport type RadioUri = Branded<string, \"RadioUri\">;\r\nexport type PlaylistUri = Branded<string, \"PlaylistUri\">;\r\nexport type GenreUri = Branded<string, \"GenreUri\">;\r\nexport type ArtistUri = Branded<string, \"ArtistUri\">;\r\nexport type ImageUri = Branded<string, \"ImageUri\">;\r\nexport type StreamUri = Branded<string, \"StreamUri\">;\r\nexport type LibraryUri = Branded<string, \"LibraryUri\">;\r\nexport type BrowseUri = Branded<string, \"BrowseUri\">;\r\n\r\nexport type AllUris = AlbumUri | TrackUri | RadioUri | PlaylistUri | GenreUri | ArtistUri | ImageUri | StreamUri | LibraryUri | BrowseUri;\r\n\r\nexport type ItemType =  \"None\" | \"File\" | \"Stream\" | \"Album\";\r\n\r\nexport type FilterBreadCrumbTypeName = \"home\" | \"browseFilter\" | \"ref\";\r\n\r\nexport class BrowseFilterBreadCrumb<T> extends BreadCrumb<T, FilterBreadCrumbTypeName> {\r\n    constructor(label: string, filter: T, type: FilterBreadCrumbTypeName) {\r\n        super(label, filter, type);\r\n    }\r\n}\r\n\r\nexport type Uri = string;\r\nexport class BreadCrumbHome extends BrowseFilterBreadCrumb<null> {\r\n    constructor() {\r\n        super(\"Home\", null, \"home\");\r\n    }\r\n}\r\nexport class BreadCrumbBrowseFilter extends BrowseFilterBreadCrumb<BrowseFilter> {\r\n    constructor(label: string, filter: BrowseFilter) {\r\n        super(label, filter, \"browseFilter\");\r\n    }\r\n}\r\nexport class BreadCrumbRef<T extends AllUris> extends BrowseFilterBreadCrumb<Ref<T>> {\r\n    constructor(label: string, ref: Ref<T>) {\r\n        super(label, ref, \"ref\");\r\n    }\r\n}\r\nexport type FilterBreadCrumb = BreadCrumbRef<AllUris> | BreadCrumbBrowseFilter | BreadCrumbHome;\r\n\r\nexport function isBreadCrumbForAlbum(breadCrumb: BreadCrumbRef<AllUris>): breadCrumb is BreadCrumbRef<AlbumUri> {\r\n    return breadCrumb.data.type == \"album\";\r\n}\r\nexport function isBreadCrumbForArtist(breadCrumb: BreadCrumbRef<AllUris>): breadCrumb is BreadCrumbRef<ArtistUri> {\r\n    return breadCrumb.data.type == \"artist\";\r\n}\r\n\r\nexport type ImageLookup = {[string: AllUris]: Image[]}\r\n\r\nexport interface BrowseFilterFlags {\r\n    album: boolean;\r\n    track: boolean;\r\n    radio: boolean;\r\n    artist: boolean;\r\n    playlist: boolean;\r\n    genre: boolean;\r\n}\r\n\r\nexport class BrowseFilter implements BrowseFilterFlags{\r\n    searchText: string;\r\n    album: boolean;\r\n    track: boolean;\r\n    radio: boolean;\r\n    artist: boolean;\r\n    playlist: boolean;\r\n    genre: boolean;\r\n    addedSince: number;\r\n\r\n    constructor() {\r\n        this.searchText = \"\";\r\n        this.track = false;\r\n        this.artist = false;\r\n        this.genre = false;\r\n        this.radio = false;\r\n        this.playlist = false;\r\n        this.album = false;\r\n        this.addedSince = 0;\r\n    }\r\n\r\n    isNoTypeSelected(): boolean {\r\n        return !(this.album || this.track || this.radio || this.artist || this.playlist || this.genre);\r\n    }\r\n\r\n    isAllTypesSelected(): boolean {\r\n        return this.album && this.track && this.radio && this.artist && this.playlist && this.genre;\r\n    }\r\n\r\n    getSelectedFilters() {\r\n        return [\"album\", \"track\", \"radio\", \"artist\", \"playlist\", \"genre\"].filter(key => this[key as keyof BrowseFilterFlags] == true);\r\n    }\r\n\r\n    isEmpty(): boolean {\r\n        return (\r\n            this.isNoTypeSelected()\r\n            || this.isAllTypesSelected()\r\n        )\r\n        && this.searchText == \"\";\r\n    }\r\n}\r\n\r\nexport interface AlbumModel {\r\n    type: \"album\";\r\n    tracks: TrackUri[];\r\n    albumInfo: models.Album | null;\r\n    ref: ExpandedRef\r\n}\r\n\r\nexport interface FileTrackModel {\r\n    type: \"file\";\r\n    track: models.Track;\r\n    title: string;\r\n    composer?: string;\r\n    performer: string;\r\n    songlenght: number;\r\n    ref: ExpandedRef;\r\n}\r\n\r\nexport interface StreamTrackModel {\r\n    type: \"stream\";\r\n    track: models.Track;\r\n    name: string;\r\n    ref: ExpandedRef;\r\n}\r\n\r\nexport interface NoneTrackModel {\r\n    type: \"none\";\r\n}\r\n\r\nexport const TrackNone = {type: \"none\"} as NoneTrackModel;\r\n\r\nexport class ExpandedFileTrackModel {\r\n    track: FileTrackModel;\r\n    album: AlbumModel | null;\r\n\r\n    constructor(track: FileTrackModel, album: AlbumModel | null) {\r\n        this.track = track;\r\n        this.album = album;\r\n    }\r\n\r\n    get bigImageUrl() {\r\n        return getBaseUrl() +  \"/eboback/image/\" + (this.track.ref.idMaxImage);\r\n    }\r\n}\r\n\r\nexport class ExpandedStreamModel {\r\n    stream: StreamTrackModel;\r\n    historyLines: ExpandedHistoryLineGroup[];\r\n\r\n    constructor(stream: StreamTrackModel, historyLinew: ExpandedHistoryLineGroup[]) {\r\n        this.stream = stream;\r\n        this.historyLines = historyLinew;\r\n    }\r\n\r\n    get bigImageUrl() {\r\n        return getBaseUrl() + \"/eboback/image/\" + (this.stream.ref?.idMaxImage?? \"-- no expanded ref or image --\");\r\n    }\r\n}\r\n\r\nexport interface AlbumMetaData {\r\n    showTrackNumbers: boolean,\r\n    albumTitle: string,\r\n    imageFile: string\r\n}\r\n\r\nexport interface CachedAlbumMetaData {\r\n    meta: AlbumMetaData | null,\r\n}\r\n\r\nexport class ExpandedAlbumModel {\r\n    album: AlbumModel;\r\n    meta: AlbumMetaData | null;\r\n    controller: Controller;\r\n\r\n    constructor(album: AlbumModel, controller: Controller, meta: AlbumMetaData | null) {\r\n        this.album = album;\r\n        this.controller = controller;\r\n        this.meta = meta;\r\n    }\r\n\r\n    get bigImageUrl(): string {\r\n        if(this.album.ref.idMaxImage)\r\n            return getBaseUrl() + \"/eboback/image/\" + this.album.ref.idMaxImage;\r\n        return getDefaultImageUrl(this.album.ref.refType);\r\n    }\r\n\r\n    async getTrackModels() {\r\n        let trackModels: FileTrackModel[] = [];\r\n        for(let trackUri of this.album.tracks) {\r\n            let model = await this.controller.cache.lookupTrackCached(trackUri);\r\n            if(model)\r\n                trackModels.push(model as FileTrackModel);\r\n        }\r\n        return trackModels;\r\n    }\r\n\r\n    async getGenreReplacements(): Promise<GenreReplacement[]> {\r\n        let trackModels = await this.getTrackModels();\r\n        let genreDefPromises = [...new Set(trackModels\r\n            .filter(track => track.track.genre != undefined)\r\n            .map(track => track.track.genre as string))]\r\n            .map(async genre => (await this.controller.cache.getGenreReplacementsCached()).get(genre))\r\n            .filter(genre => genre != undefined) as Promise<GenreReplacement>[];\r\n        return Promise.all(genreDefPromises);\r\n    }\r\n\r\n    async getArtists()  {\r\n        let trackModels = await this.getTrackModels();\r\n        let artistMap: Map<string, Artist> = new Map();\r\n        trackModels\r\n            .map(track => track.track.artists?? [])\r\n            .flat()\r\n            .forEach(artist => artistMap.set(artist.name, artist));\r\n        return [...artistMap.values()]\r\n    }\r\n\r\n    async getComposers() {\r\n        let trackModels = await this.getTrackModels();\r\n        let artistMap: Map<string, Artist> = new Map();\r\n        trackModels\r\n            .map(track => track.track.composers?? [])\r\n            .flat()\r\n            .forEach(artist => artistMap.set(artist.name, artist));\r\n        return [...artistMap.values()]\r\n    }\r\n\r\n    /// using this function forces all data to be collected in one 'transaction', avoiding a race condition in between async calls.\r\n    async getAllDetails() {\r\n        let all = await Promise.all([this.getTrackModels(), this.getArtists(), this.getComposers(), this.getGenreReplacements()]);\r\n        return {tracks: all[0], artists: all[1], composers: all[2], genreDefs: all[3]};\r\n    }\r\n}\r\n\r\nexport interface ExpandedHistoryLineGroup {\r\n    remembered: boolean,\r\n    lines: string[]\r\n}\r\n\r\nexport function isInstanceOfExpandedStreamModel(model: ExpandedAlbumModel | ExpandedStreamModel | ExpandedFileTrackModel | null): model is ExpandedStreamModel {\r\n    if(!model) return false;\r\n    return 'stream' in model;\r\n}\r\n\r\nexport function isInstanceOfExpandedTrackModel(model: ExpandedAlbumModel | ExpandedStreamModel | ExpandedFileTrackModel | null): model is ExpandedFileTrackModel {\r\n    if(!model) return false;\r\n    return 'track' in model;\r\n}\r\n\r\nexport type TrackModel = NoneTrackModel | FileTrackModel | StreamTrackModel;\r\nexport type DeepReadonly<T> = T extends Function ? T :\r\n    T extends object ? { readonly [K in keyof T]: DeepReadonly<T[K]> } :\r\n        T;\r\n\r\nexport enum ConnectionState {Offline, Online}\r\n\r\nexport enum MessageType { None, Info, Warning, Error}\r\n\r\nexport interface Message {\r\n    type: MessageType,\r\n    message: string\r\n}\r\n\r\nexport interface PlaybackFlags {\r\n    repeat: boolean,\r\n    random: boolean,\r\n    consume: boolean,\r\n    single: boolean\r\n}\r\n\r\nexport type PlayState = \"stopped\" | \"playing\" | \"paused\" | \"unknown\"; //todo: \"unknown\" is not a mopidy state but a local one. Split up type?\r\n\r\nexport interface HistoryRef {\r\n    __model__: string,\r\n    name: string;\r\n    type: string;\r\n    uri: string;\r\n}\r\n\r\nexport interface MopidyHistoryLine {\r\n    timestamp: number;\r\n    ref: HistoryRef;\r\n}\r\n\r\nexport type LibraryItem = models.Track[];\r\nexport type LibraryDict = { [index: string]: LibraryItem };\r\n\r\nexport const NoStreamTitles: StreamTitles = {uri: \"\", active_titles: []};\r\n\r\nexport interface StreamTitles {\r\n    uri: string;\r\n    active_titles: string[]\r\n}\r\n\r\nexport enum AlbumDataType {\r\n    None,\r\n    Loading,\r\n    Loaded,\r\n    StreamLinesLoaded\r\n}\r\n\r\ninterface AlbumDataNone {\r\n    type: AlbumDataType.None;\r\n}\r\n\r\ninterface AlbumDataLoading {\r\n    type: AlbumDataType.Loading;\r\n}\r\n\r\nexport interface AlbumDataLoaded {\r\n    type: AlbumDataType.Loaded;\r\n    album: AlbumModel;\r\n}\r\n\r\nexport interface AlbumStreamLinesLoaded {\r\n    type: AlbumDataType.StreamLinesLoaded;\r\n    albumTrack: models.Track;\r\n}\r\n\r\nexport const AlbumNone: AlbumDataNone = {\r\n    type: AlbumDataType.None\r\n}\r\n\r\nexport type AlbumData = AlbumDataLoaded | AlbumDataNone | AlbumDataLoading | AlbumStreamLinesLoaded;\r\n\r\nexport enum Views {\r\n    NowPlaying = \"#NowPlaying\",\r\n    Browse = \"#Browse\",\r\n    Album = \"#Album\",\r\n    Settings = \"#Settings\",\r\n    WhatsNew = \"#WhatsNew\",\r\n    Remembered = \"#Remembered\",\r\n    Genres = \"#Genres\"\r\n}\r\n\r\nexport interface GenreReplacement {\r\n    ref: Ref<GenreUri>;\r\n    replacement: string | null;\r\n}\r\n\r\nexport interface GenreDef {\r\n    name: string,\r\n    child: string,\r\n    sequence: number,\r\n    level: number,\r\n}\r\n\r\nexport interface HistoryLineDef {\r\n    moment: Date;\r\n    type: \"track\"; //todo: other types?\r\n    uri: TrackUri;\r\n    name: string;\r\n    ref_count: number;\r\n    album: string;\r\n    artist: string;\r\n}\r\n\r\nexport type PlaybackUserOptions = \"justPlay\" | \"repeat\" | \"repeatSingle\" | \"single\";","import {AlbumUri, AllUris, PlaybackUserOptions, RememberId, TrackUri} from \"./modelTypes\";\r\nimport {EboDialog} from \"./components/eboDialog\";\r\nimport {DisplayMode} from \"./components/eboListItemComp\";\r\nimport {RefType} from \"./refs\";\r\n\r\nexport interface EboEventHandlersEventMap {\r\n    \"activeStreamLinesChanged.eboplayer\"        : VoidArgs,\r\n    \"addItemListClicked.eboplayer\"              : GuiSourceArgs,\r\n    \"addTrackClicked.eboplayer\"                 : TrackUriArgs,\r\n    \"albumToViewChanged.eboplayer\"              : VoidArgs,\r\n    \"bigTrackAlbumImgClicked.eboplayer\"         : VoidArgs,\r\n    \"bigTrackAlbumSmallImgClicked.eboplayer\"    : VoidArgs,\r\n    \"breadCrumbClick.eboplayer\"                 : BreadcrumbArgs,\r\n    \"breadCrumbsChanged.eboplayer\"              : VoidArgs,\r\n    \"browseResultClick.eboplayer\"               : BrowseResultClickArgs,\r\n    \"browseResultDblClick.eboplayer\"            : UriArgs,\r\n    \"browseToArtist.eboplayer\"                  : RefArgs,\r\n    \"buttonBarAlbumImgClicked.eboplayer\"        : VoidArgs,\r\n    \"changingVolume.eboplayer\"                  : VolumeEventArgs,\r\n    \"connectionChanged.eboplayer\"               : VoidArgs, //todo: never received?\r\n    \"currentImageSet.eboplayer\"                 : VoidArgs, //todo: never received?\r\n    \"currentRefsLoaded.eboplayer\"               : VoidArgs,\r\n    \"currentTrackChanged.eboplayer\"             : VoidArgs,\r\n    \"deleteRemember.eboplayer\"                  : RemeberIdArgs,\r\n    \"genreDefsChanged.eboplayer\"                : VoidArgs,\r\n    \"detailsAlbumImgClicked.eboplayer\"          : VoidArgs,\r\n    \"dialogOkClicked.eboplayer\"                 : DialogArgs,\r\n    \"displayModeChanged.eboplayer\"              : DisplayModeArgs,\r\n    \"editClicked.eboplayer\"                     : GuiSourceArgs,\r\n    \"genreReplacementsChanged.eboplayer\"        : VoidArgs,\r\n    \"guiBrowseFilterChanged.eboplayer\"          : VoidArgs,\r\n    \"historyChanged.eboplayer\"                  : VoidArgs,\r\n    \"longPress.eboplayer\"                       : VoidArgs,\r\n    \"messageChanged.eboplayer\"                  : VoidArgs,\r\n    \"modelBrowseFilterChanged.eboplayer\"        : VoidArgs,\r\n    \"newPlaylistClicked.eboplayer\"              : GuiSourceArgs,\r\n    \"optionSelected.eboplayer\"                  : OptionArgs,\r\n    \"pausePressed.eboplayer\"                    : VoidArgs,\r\n    \"playItemListClicked.eboplayer\"             : GuiSourceArgs,\r\n    \"playPressed.eboplayer\"                     : VoidArgs,\r\n    \"playTrackClicked.eboplayer\"                : TrackUriArgs,\r\n    \"playbackModeChanged.eboplayer\"             : VoidArgs,\r\n    \"playbackStateChanged.eboplayer\"            : VoidArgs,\r\n    \"pressedChange.eboplayer\"                   : PressedArgs,\r\n    \"programTitleChanged.eboplayer\"             : VoidArgs,\r\n    \"refsFiltered.eboplayer\"                    : VoidArgs,\r\n    \"rememberStreamLines.eboplayer\"             : StreamLinesArgs,\r\n    \"rememberedRequested.eboplayer\"             : VoidArgs,\r\n    \"remembersChanged.eboplayer\"                : VoidArgs,\r\n    \"replaceItemListClicked.eboplayer\"          : GuiSourceArgs,\r\n    \"saveClicked.eboplayer\"                     : SaveUriArgs,\r\n    \"scanFinished.eboplayer\"                    : VoidArgs,\r\n    \"scanRequested.eboplayer\"                   : VoidArgs,\r\n    \"scanStatusChanged.eboplayer\"               : StringArgs,\r\n    \"selectedTrackChanged.eboplayer\"            : VoidArgs,\r\n    \"stopPressed.eboplayer\"                     : VoidArgs,\r\n    \"trackClicked.eboplayer\"                    : UriArgs,\r\n    \"trackListChanged.eboplayer\"                : VoidArgs,\r\n    \"updateAlbumData.eboplayer\"                 : UriArgs,\r\n    \"uploadAlbumImageClicked.eboplayer\"         : AlbumImageUrlArgs,\r\n    \"viewChanged.eboplayer\"                     : VoidArgs,\r\n    \"volumeChanged.eboplayer\"                   : VoidArgs,\r\n    \"whatsNewRequested.eboplayer\"               : VoidArgs,\r\n}\r\n\r\nexport default interface EboEventTarget {\r\n    addEboEventListener<K extends keyof EboEventHandlersEventMap>(\r\n        type: K,\r\n        listener: (this: EboEventTarget, ev: EboplayerEvent<K, EboEventHandlersEventMap[K]>) => any, options?: boolean | AddEventListenerOptions): void;\r\n\r\n    dispatchEboEvent<K extends keyof EboEventHandlersEventMap>(key: K, args: EboEventHandlersEventMap[K]): boolean;\r\n}\r\n\r\nexport class EboplayerEvent<K extends keyof EboEventHandlersEventMap, T extends EboEventArgs> extends CustomEvent<T> {\r\n    protected constructor(event: K, detail?: T) {\r\n        super(event, {detail, bubbles: true, composed: true, cancelable: true});\r\n    }\r\n}\r\n\r\nexport function createEvent<K extends keyof EboEventHandlersEventMap>(event: K, detail?: EboEventHandlersEventMap[K]) {\r\n    return new CustomEvent(event, {detail, bubbles: true, composed: true, cancelable: true});\r\n}\r\n\r\nexport interface VolumeEventArgs {volume: number}\r\nexport interface GuiSourceArgs {source: GuiSource}\r\n\r\nexport interface EboEventArgs {}\r\n\r\nexport type VoidArgs = {\r\n    [K in any] : never\r\n}\r\n\r\nexport interface StreamLinesArgs extends EboEventArgs {\r\n    lines: string[]\r\n}\r\n\r\nexport interface RemeberIdArgs extends EboEventArgs {\r\n    id: RememberId\r\n}\r\n\r\nexport interface OptionArgs extends EboEventArgs {\r\n    selected: PlaybackUserOptions | null\r\n}\r\n\r\nexport interface UriArgs extends EboEventArgs {\r\n    uri: AllUris\r\n}\r\n\r\nexport interface RefArgs extends EboEventArgs {\r\n    name: string; //todo: use pre-existing type instead of these 3 fields?\r\n    type: RefType;\r\n    uri: AllUris;\r\n}\r\n\r\nexport interface AlbumImageUrlArgs extends EboEventArgs {\r\n    albumUri: AlbumUri;\r\n    imageUrl: string;\r\n}\r\n\r\nexport interface PressedArgs extends EboEventArgs {\r\n    pressed: boolean\r\n}\r\n\r\nexport interface StringArgs extends EboEventArgs {\r\n    text: string\r\n}\r\n\r\nexport interface DialogArgs extends EboEventArgs {\r\n    dialog: EboDialog\r\n}\r\n\r\nexport interface TrackUriArgs extends EboEventArgs {\r\n    uri: TrackUri\r\n}\r\n\r\nexport interface DisplayModeArgs extends EboEventArgs {\r\n    mode: DisplayMode\r\n}\r\n\r\nexport interface SaveUriArgs extends EboEventArgs {\r\n    source: GuiSource,\r\n    uri: AllUris\r\n}\r\n\r\nexport interface BreadcrumbArgs extends EboEventArgs {\r\n    breadcrumbId: number\r\n}\r\nexport interface BrowseResultArgs extends EboEventArgs {\r\n    label: string,\r\n    uri: AllUris,\r\n    type: string,\r\n}\r\n\r\nexport interface BrowseResultClickArgs extends EboEventArgs {\r\n    label: string,\r\n    uri: AllUris,\r\n    type: string,\r\n}\r\n\r\nexport type GuiSource = \"albumView\" | \"browseView\";\r\nexport interface GuiSourceArgs extends EboEventArgs {\r\n    source: GuiSource\r\n}\r\n\r\nexport class EboEventTargetClass extends EventTarget implements EboEventTarget {\r\n    dispatchEboEvent<K extends keyof EboEventHandlersEventMap>(key: K, args: EboEventHandlersEventMap[K]): boolean {\r\n        return super.dispatchEvent(createEvent(key, args));\r\n    }\r\n\r\n    addEboEventListener<K extends keyof EboEventHandlersEventMap>(\r\n        type: K,\r\n        listener: (this: EboEventTarget, ev: EboplayerEvent<K, EboEventHandlersEventMap[K]>) => any, options?: boolean | AddEventListenerOptions): void {\r\n        // @ts-ignore\r\n        super.addEventListener(type, listener, options);\r\n    }\r\n}\r\n\r\nexport function addEboEventListener<K extends keyof EboEventHandlersEventMap>(\r\n    target: HTMLElement,\r\n    type: K,\r\n    listener: (this: EboEventTarget, ev: EboplayerEvent<K, EboEventHandlersEventMap[K]>) => any, options?: boolean | AddEventListenerOptions): void {\r\n    // @ts-ignore\r\n    target.addEventListener(type, listener, options);\r\n}\r\n","import models from \"../js/mopidy\";\r\nimport {AllRefs, EmptySearchResults, ExpandedRef, Refs, SearchResults} from \"./refs\";\r\nimport {AlbumMetaData, AlbumModel, AlbumUri, AllUris, BreadCrumbHome, BrowseFilter, CachedAlbumMetaData, ConnectionState, FileTrackModel, FilterBreadCrumb, FilterBreadCrumbTypeName, GenreDef, GenreReplacement, HistoryLineDef, Message, MessageType, NoneTrackModel, PlaybackFlags, PlayState, RememberDef, StreamTitles, StreamTrackModel, StreamUri, TrackModel, TrackUri, Views} from \"./modelTypes\";\r\nimport {BreadCrumbStack} from \"./breadCrumb\";\r\nimport {EboEventTargetClass} from \"./events\";\r\nimport TlTrack = models.TlTrack;\r\n\r\n\r\nexport type OnlyGetMethods<T> = {\r\n    [K in keyof T as\r\n        K extends `get${string}`| `addEboEventListener`\r\n            ? T[K] extends (...args: any[]) => any\r\n                ? K\r\n                : never\r\n            : never\r\n    ]: T[K]\r\n};\r\n\r\nexport type ReadOnlyModel = OnlyGetMethods<Model>;\r\n\r\nexport interface AlbumToView {\r\n    albumUri: AlbumUri;\r\n    selectedTrackUri: TrackUri | null;\r\n}\r\n\r\nexport class BrowseFilterBreadCrumbStack extends BreadCrumbStack<FilterBreadCrumbTypeName, FilterBreadCrumb>{}\r\n\r\n// Model contains the data to be viewed and informs the view of changes through events.\r\n// Views should not update the model directly. See ViewModel for that.\r\nexport class Model extends EboEventTargetClass implements ReadOnlyModel {\r\n    currentTrack: TrackUri | StreamUri | null = null;\r\n    //note that selectedTrack is not part of the mopidy server.\r\n    //don't set selectedTrack to currentTrack unless you want it displayed\r\n    selectedTrack: TrackUri | StreamUri | null = null;\r\n    volume: number;\r\n    connectionState: ConnectionState = ConnectionState.Offline;\r\n    currentMessage: Message = {\r\n        type: MessageType.None,\r\n        message: \"\"\r\n    };\r\n\r\n    private playbackMode: PlaybackFlags = {\r\n        repeat: false,\r\n        random: false,\r\n        consume: false,\r\n        single: false\r\n    }\r\n    private playState: PlayState = \"unknown\";\r\n    private activeStreamLines: StreamTitles;\r\n    private history: HistoryLineDef[];\r\n    private trackList: TlTrack[] = [];\r\n    private libraryCache: Map<string, (FileTrackModel | StreamTrackModel | AlbumModel)> = new Map();\r\n    private imageCache: Map<string, string> = new Map();\r\n    private metaCache: Map<string, CachedAlbumMetaData> = new Map();\r\n    private currentBrowseFilter= new BrowseFilter();\r\n    // private filterBreadCrumbStack: BreadCrumbStack<number> = new BreadCrumbStack<number>();\r\n    private filterBreadCrumbStack: BrowseFilterBreadCrumbStack = new BrowseFilterBreadCrumbStack();\r\n    private genreReplacements: Map<string, GenreReplacement> = new Map();\r\n    private genreDefs: GenreDef[] = [];\r\n    private currentProgramTitle: string = \"\";\r\n\r\n    private allRefs: AllRefs | null = null;\r\n    private currentRefs: Refs | null = null;\r\n    private view: Views = Views.NowPlaying;\r\n    private albumToView: AlbumToView | null = null;\r\n    // private albumCache: Set<LibraryItem> = new Map();\r\n    private remembers: RememberDef[] | null = null;\r\n    private scanStatus: string = \"\";\r\n    private allRefsMap: Map<AllUris, ExpandedRef> | null = null;\r\n\r\n    constructor() {\r\n        super();\r\n        this.initializeBreadcrumbStack();\r\n    }\r\n\r\n    getScanStatus = () => this.scanStatus;\r\n\r\n    getCurrentProgramTitle(): string {\r\n        return this.currentProgramTitle;\r\n    }\r\n\r\n    setCurrentProgramTitle(title: string) {\r\n        this.currentProgramTitle = title;\r\n        this.dispatchEboEvent(\"programTitleChanged.eboplayer\", {});\r\n    }\r\n\r\n    setGenreReplacements(defs: GenreReplacement[]) {\r\n        this.genreReplacements = new Map<string, GenreReplacement>();\r\n        for (let def of defs) {\r\n            this.genreReplacements.set(def.ref.name ?? \"???\", def);\r\n        }\r\n        this.dispatchEboEvent(\"genreReplacementsChanged.eboplayer\", {});\r\n    }\r\n    getGenreReplacements = () => this.genreReplacements;\r\n\r\n    pushBreadCrumb(crumb: FilterBreadCrumb) {\r\n        this.filterBreadCrumbStack.push(crumb);\r\n        this.dispatchEboEvent(\"breadCrumbsChanged.eboplayer\", {});\r\n    }\r\n    popBreadCrumb() {\r\n        let crumb = this.filterBreadCrumbStack.pop();\r\n        this.dispatchEboEvent(\"breadCrumbsChanged.eboplayer\", {});\r\n        return crumb;\r\n    }\r\n\r\n    getBreadCrumbs = () => this.filterBreadCrumbStack;\r\n\r\n    resetBreadCrumbsTo(id: number) {\r\n        this.filterBreadCrumbStack.resetTo(id);\r\n        this.dispatchEboEvent(\"breadCrumbsChanged.eboplayer\", {});\r\n    }\r\n\r\n    private initializeBreadcrumbStack() {\r\n        this.filterBreadCrumbStack.length = 0;\r\n        this.filterBreadCrumbStack.push(new BreadCrumbHome());\r\n    }\r\n\r\n    clearBreadCrumbs() {\r\n        this.initializeBreadcrumbStack();\r\n        this.dispatchEboEvent(\"breadCrumbsChanged.eboplayer\", {});\r\n    }\r\n\r\n    setAllRefs(refs: AllRefs) {\r\n        this.allRefs = refs;\r\n        this.allRefsMap = new Map<AllUris, ExpandedRef>(\r\n            refs.allRefs\r\n                .map(res => [res.uri as AllUris, res])\r\n        );\r\n    }\r\n\r\n    getCurrentSearchResults(): SearchResults {\r\n        return this.currentRefs?.getSearchResults() ?? EmptySearchResults;\r\n    }\r\n\r\n    getAllRefs = () => this.allRefs;\r\n    getAllRefsMap = () => this.allRefsMap;\r\n\r\n    async filterCurrentRefs(){\r\n        if(!this.currentRefs)\r\n            return;\r\n        this.currentRefs.browseFilter = this.currentBrowseFilter;\r\n        await this.currentRefs.filter();\r\n        this.dispatchEboEvent(\"refsFiltered.eboplayer\", {});\r\n    }\r\n\r\n    getImageFromCache(uri: AllUris): string | undefined {\r\n        return this.imageCache.get(uri);\r\n    }\r\n\r\n    addImageToCache(uri: AllUris, image: string) {\r\n        this.imageCache.set(uri, image);\r\n    }\r\n\r\n    addImagesToCache(map: Map<AllUris, string>) {\r\n        for(let [uri, image] of map) {\r\n            this.addImageToCache(uri, image);\r\n        }\r\n    }\r\n\r\n    setConnectionState(state: ConnectionState) {\r\n        this.connectionState  = state;\r\n        if(this.connectionState == ConnectionState.Online)\r\n            this.clearMessage();\r\n        else\r\n            this.setErrorMessage(\"Offline\");\r\n        this.dispatchEboEvent(\"connectionChanged.eboplayer\", {});\r\n    }\r\n\r\n    getConnectionState = () => this.connectionState;\r\n\r\n    getCachedInfo(uri: string): (FileTrackModel | StreamTrackModel  | AlbumModel | null) {\r\n        return this.libraryCache.get(uri) ?? null;\r\n    }\r\n\r\n    getCurrentBrowseFilter = () => this.currentBrowseFilter;\r\n    setCurrentBrowseFilter(browseFilter: BrowseFilter) {\r\n        this.currentBrowseFilter = browseFilter;\r\n        this.dispatchEboEvent(\"modelBrowseFilterChanged.eboplayer\", {});\r\n    }\r\n\r\n    setBrowseFilterBreadCrumbs(breadCrumbStack: BrowseFilterBreadCrumbStack) {\r\n        this.filterBreadCrumbStack.length = 0;\r\n        this.filterBreadCrumbStack.push(...breadCrumbStack);\r\n        this.dispatchEboEvent(\"breadCrumbsChanged.eboplayer\", {});\r\n    }\r\n\r\n    getCurrentTrack(): TrackUri | StreamUri | null {\r\n        return this.currentTrack;\r\n    }\r\n\r\n    setCurrentTrack(track: TrackModel | null) {\r\n        if(track?.type == \"none\") {\r\n            this.currentTrack = null;\r\n            return;\r\n        }\r\n        this.currentTrack = track?.track?.uri ?? null;\r\n        if(this.currentTrack)\r\n            this.addToLibraryCache(this.currentTrack, track as (FileTrackModel | StreamTrackModel | AlbumModel)); //excluding NoneTrackModel\r\n        this.dispatchEboEvent(\"currentTrackChanged.eboplayer\", {});\r\n    }\r\n\r\n    getSelectedTrack = () => this.selectedTrack;\r\n\r\n    setSelectedTrack(uri: TrackUri | StreamUri | null) {\r\n        if(uri == \"\")\r\n            this.selectedTrack = null;\r\n        else\r\n            this.selectedTrack = uri;\r\n        this.dispatchEboEvent(\"selectedTrackChanged.eboplayer\", {});\r\n    }\r\n\r\n    setVolume(volume: number) {\r\n        this.volume = volume;\r\n        this.dispatchEboEvent(\"volumeChanged.eboplayer\", {});\r\n    }\r\n\r\n    private setMessage(message: Message) {\r\n        this.currentMessage = message;\r\n        this.dispatchEboEvent(\"messageChanged.eboplayer\", {});\r\n    }\r\n\r\n    getCurrentMessage = () => this.currentMessage;\r\n\r\n    clearMessage() {\r\n        this.setMessage( { type: MessageType.None, message: \"\"});\r\n    }\r\n    setInfoMessage(message: string) {\r\n        this.setMessage( { type: MessageType.Info, message});\r\n    }\r\n    setWarningMessage(message: string) {\r\n        this.setMessage( { type: MessageType.Warning, message});\r\n    }\r\n    setErrorMessage(message: string) {\r\n        this.setMessage( { type: MessageType.Error, message});\r\n    }\r\n\r\n    setPlaybackMode(state: PlaybackFlags) {\r\n        this.playbackMode = {...state};\r\n        this.dispatchEboEvent(\"playbackModeChanged.eboplayer\", {});\r\n    }\r\n    getPlaybackMode = () => this.playbackMode;\r\n\r\n    getVolume = () => this.volume;\r\n\r\n    getPlayState(): PlayState {\r\n        return this.playState;\r\n    }\r\n\r\n    setPlayState(state: PlayState) {\r\n        this.playState = state;\r\n        this.dispatchEboEvent(\"playbackStateChanged.eboplayer\", {});\r\n    }\r\n\r\n    setActiveStreamLinesHistory(streamTitles: StreamTitles) {\r\n        this.activeStreamLines = streamTitles;\r\n        this.dispatchEboEvent(\"activeStreamLinesChanged.eboplayer\", {});\r\n    }\r\n\r\n    getActiveStreamLines = () => this.activeStreamLines;\r\n\r\n    setHistory(history: HistoryLineDef[]) {\r\n        this.history = history;\r\n        this.dispatchEboEvent(\"historyChanged.eboplayer\", {});\r\n    }\r\n\r\n    getHistory = () => this.history;\r\n\r\n    setTrackList(trackList: TlTrack[]) {\r\n        this.trackList = trackList;\r\n        this.dispatchEboEvent(\"trackListChanged.eboplayer\", {});\r\n    }\r\n    addToTrackList(trackList: TlTrack[]) {\r\n        this.trackList.push(...trackList);\r\n        this.dispatchEboEvent(\"trackListChanged.eboplayer\", {});\r\n    }\r\n    getTrackList = () => this.trackList;\r\n\r\n    //Doesn't overwrite\r\n    addToLibraryCache(uri: string, item: (FileTrackModel | StreamTrackModel | AlbumModel)) {\r\n        if(!this.libraryCache.has(uri))\r\n            this.libraryCache.set(uri, item);\r\n    }\r\n\r\n    //Doesn't overwrite\r\n    addToMetaCache(albumUri: string, item: AlbumMetaData | null) {\r\n        if(!this.metaCache.has(albumUri))\r\n            this.metaCache.set(albumUri, {meta: item});\r\n    }\r\n\r\n    getFromMetaCache(albumUri: string): CachedAlbumMetaData | undefined {\r\n        return this.metaCache.get(albumUri);\r\n    }\r\n\r\n    updateLibraryCache(uri: string, item: (FileTrackModel | StreamTrackModel | AlbumModel)) {\r\n        this.libraryCache.set(uri, item);\r\n    }\r\n\r\n    //Overwrites!\r\n    addItemsToLibraryCache(items: (FileTrackModel | StreamTrackModel | AlbumModel)[]) {\r\n        for(let item of items) {\r\n            if(item.type == \"album\") {\r\n                if(item.albumInfo)\r\n                    this.updateLibraryCache(item.albumInfo.uri, item);\r\n            }\r\n            else\r\n                this.updateLibraryCache(item.track.uri, item);\r\n        }\r\n    }\r\n\r\n    getFromLibraryCache(uri: string): (FileTrackModel | StreamTrackModel | AlbumModel) | null {\r\n        return this.libraryCache.get(uri) ?? null;\r\n    }\r\n\r\n    setCurrentRefs(refs: Refs | null) {\r\n        this.currentRefs = refs;\r\n        this.dispatchEboEvent(\"currentRefsLoaded.eboplayer\", {});\r\n    }\r\n\r\n    setView(view: Views) {\r\n        this.view = view;\r\n        this.dispatchEboEvent(\"viewChanged.eboplayer\", {});\r\n    }\r\n    getView = () => this.view;\r\n\r\n    setAlbumToView(uri: AlbumUri, selectedTrackUri: TrackUri | null) {\r\n        this.albumToView = {albumUri: uri, selectedTrackUri: selectedTrackUri};\r\n        this.dispatchEboEvent(\"albumToViewChanged.eboplayer\", {});\r\n    }\r\n    getAlbumToView = () => this.albumToView;\r\n\r\n    setRemembers(remembers: RememberDef[] | null) {\r\n        this.remembers = remembers;\r\n        this.dispatchEboEvent(\"remembersChanged.eboplayer\", {});\r\n    }\r\n\r\n    getRemembers = () => this.remembers;\r\n\r\n    setScanStatus(status: string) {\r\n        this.scanStatus = status;\r\n        this.dispatchEboEvent(\"scanStatusChanged.eboplayer\", {text: status});\r\n    }\r\n\r\n    getGenreDefs = () => this.genreDefs;\r\n    setGenreDefs(genreDefs: GenreDef[]) {\r\n        this.genreDefs = genreDefs;\r\n        this.dispatchEboEvent(\"genreDefsChanged.eboplayer\", {});\r\n    }\r\n}\r\n","import {EboComponent} from \"../components/EboComponent\";\r\nimport EboEventTarget, {EboEventHandlersEventMap, EboplayerEvent} from \"../events\";\r\nimport { State } from \"../playerState\";\r\n\r\nexport interface Parent<Child> {\r\n    addChildren(...children: Child[]): void;\r\n\r\n    get children(): Child[];\r\n}\r\n\r\nexport abstract class View  implements Parent<View> {\r\n    protected state: State;\r\n    private _children: View[] = [];\r\n\r\n    constructor(state: State) {\r\n        this.state = state;\r\n    }\r\n\r\n    abstract bind(): void;\r\n\r\n    addChildren(...children: View[]) {\r\n        this._children.push(...children);\r\n    }\r\n\r\n    get children(): View[] {\r\n        return this._children;\r\n    }\r\n\r\n    bindRecursive() {\r\n        this.children.forEach(child => child.bindRecursive());\r\n        this.bind();\r\n    }\r\n}\r\n\r\nexport abstract class ComponentView<T extends EboComponent> extends View {\r\n    protected component: T;\r\n\r\n    protected constructor(state: State, component: T) {\r\n        super(state);\r\n        this.component = component;\r\n    }\r\n\r\n    protected on<K extends keyof EboEventHandlersEventMap>(\r\n        type: K,\r\n        listener: (this: EboEventTarget, ev: EboplayerEvent<K, EboEventHandlersEventMap[K]>) => any, options?: boolean | AddEventListenerOptions\r\n    ): void {\r\n        this.component.addEboEventListener(type, listener, options);\r\n    }\r\n\r\n}","import {View} from \"./view\";\r\nimport {MessageType} from \"../modelTypes\";\r\n\r\nexport class HeaderView extends View {\r\n    bind() {\r\n        this.state.getModel().addEboEventListener(\"messageChanged.eboplayer\", () => {\r\n            this.onMessageChanged();\r\n        });\r\n    }\r\n\r\n    private onMessageChanged() {\r\n        let msg = this.state.getModel().getCurrentMessage();\r\n        let headerSpan = document.getElementById(\"contentHeadline\") as HTMLSpanElement;\r\n        headerSpan.innerText = msg.message;\r\n        switch (msg.type) {\r\n            case MessageType.Error:\r\n                headerSpan.classList.add(\"warning\");\r\n                break;\r\n            default:\r\n                headerSpan.classList.remove(\"warning\", \"error\");\r\n                break;\r\n        }\r\n    }\r\n}","//GENERATED by build_commands.ts (although probably customized, so do a diff when regenerating).\n// noinspection JSUnusedGlobalSymbols\n\nimport models, {core, Mopidy} from \"../js/mopidy\";\nimport {SearchResult} from \"./refs\";\nimport {AllUris, LibraryDict} from \"./modelTypes\";\nimport TlTrack = models.TlTrack;\nimport PlaybackState = core.PlaybackState;\nimport Playlist = models.Playlist;\nimport Ref = models.Ref;\nimport FilterCriteria = core.FilterCriteria;\n\nexport class Commands {\n    protected mopidy: Mopidy;\n    core: Core;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n        this.core = new Core(mopidy);\n    }\n}\n\nclass Core {\n    mopidy: Mopidy;\n    history: Core_History;\n    library: Core_Library;\n    mixer: Core_Mixer;\n    playback: Core_Playback;\n    playlists: Core_Playlists;\n    tracklist: Core_Tracklist;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n        this.history = new Core_History(mopidy);\n        this.library = new Core_Library(mopidy);\n        this.mixer = new Core_Mixer(mopidy);\n        this.playback = new Core_Playback(mopidy);\n        this.playlists = new Core_Playlists(mopidy);\n        this.tracklist = new Core_Tracklist(mopidy);\n    }\n\n    //Get list of URI schemes we can handle\n    getUriSchemes(): Promise<any> {\n        return this.mopidy.send(\"core.get_uri_schemes\") as Promise<any>;\n    }\n    //Get version of the Mopidy core API\n    getVersion(): Promise<any> {\n        return this.mopidy.send(\"core.get_version\") as Promise<any>;\n    }\n}\n\nclass Core_History {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Get the track history.\n    //\n    //The timestamps are milliseconds since epoch.\n    //\n    //:returns: the track history\n    //:rtype: list of (timestamp, :class:`mopidy.models.Ref`) tuples\n    getHistory(): Promise<any> {\n        return this.mopidy.send(\"core.history.get_history\") as Promise<any>;\n    }\n    //Get the number of tracks in the history.\n    //\n    //:returns: the history length\n    //:rtype: int\n    getLength(): Promise<any> {\n        return this.mopidy.send(\"core.history.get_length\") as Promise<any>;\n    }\n}\n\nclass Core_Library {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Browse directories and tracks at the given ``uri``.\n    //\n    //``uri`` is a string which represents some directory belonging to a\n    //backend. To get the intial root directories for backends pass\n    //:class:`None` as the URI.\n    //\n    //Returns a list of :class:`mopidy.models.Ref` objects for the\n    //directories and tracks at the given ``uri``.\n    //\n    //The :class:`~mopidy.models.Ref` objects representing tracks keep the\n    //track's original URI. A matching pair of objects can look like this::\n    //\n    //    Track(uri='dummy:/foo.mp3', name='foo', artists=..., album=...)\n    //    Ref.track(uri='dummy:/foo.mp3', name='foo')\n    //\n    //The :class:`~mopidy.models.Ref` objects representing directories have\n    //backend specific URIs. These are opaque values, so no one but the\n    //backend that created them should try and derive any meaning from them.\n    //The only valid exception to this is checking the scheme, as it is used\n    //to route browse requests to the correct backend.\n    //\n    //For example, the dummy library's ``/bar`` directory could be returned\n    //like this::\n    //\n    //    Ref.directory(uri='dummy:directory:/bar', name='bar')\n    //\n    //:param string uri: URI to browse\n    //:rtype: list of :class:`mopidy.models.Ref`\n    //\n    //.. versionadded:: 0.18\n    browse(uri: string | null ): Promise<Ref<AllUris>[]> {\n        return this.mopidy.send(\"core.library.browse\", {uri}) as Promise<Ref<AllUris>[]>;\n    }\n    //List distinct values for a given field from the library.\n    //\n    //This has mainly been added to support the list commands the MPD\n    //protocol supports in a more sane fashion. Other frontends are not\n    //recommended to use this method.\n    //\n    //:param string field: Any one of ``uri``, ``track_name``, ``album``,\n    //    ``artist``, ``albumartist``, ``composer``, ``performer``,\n    //    ``track_no``, ``genre``, ``date``, ``comment``, ``disc_no``,\n    //    ``musicbrainz_albumid``, ``musicbrainz_artistid``, or\n    //    ``musicbrainz_trackid``.\n    //:param dict query: Query to use for limiting results, see\n    //    :meth:`search` for details about the query format.\n    //:rtype: set of values corresponding to the requested field type.\n    //\n    //.. versionadded:: 1.0\n    getDistinct(field: string, query: Object): Promise<any> {\n        return this.mopidy.send(\"core.library.get_distinct\", {field, query}) as Promise<any>;\n    }\n    //Lookup the images for the given URIs\n    //\n    //Backends can use this to return image URIs for any URI they know about\n    //be it tracks, albums, playlists. The lookup result is a dictionary\n    //mapping the provided URIs to lists of images.\n    //\n    //Unknown URIs or URIs the corresponding backend couldn't find anything\n    //for will simply return an empty list for that URI.\n    //\n    //:param uris: list of URIs to find images for\n    //:type uris: list of string\n    //:rtype: {uri: tuple of :class:`mopidy.models.Image`}\n    //\n    //.. versionadded:: 1.0\n    getImages(uris: string[]): Promise<any> {\n        return this.mopidy.send(\"core.library.get_images\", {uris}) as Promise<any>;\n    }\n    //Lookup the given URIs.\n    //\n    //If the URI expands to multiple tracks, the returned list will contain\n    //them all.\n    //\n    //:param uris: track URIs\n    //:type uris: list of string\n    //:rtype: {uri: list of :class:`mopidy.models.Track`}\n    lookup(uris: string[]): Promise<LibraryDict> {\n        return this.mopidy.send(\"core.library.lookup\", {uris}) as Promise<LibraryDict>;\n    }\n    //Refresh library. Limit to URI and below if an URI is given.\n    //\n    //:param uri: directory or track URI\n    //:type uri: string\n    refresh(uri: string): Promise<any> {\n        return this.mopidy.send(\"core.library.refresh\", {uri}) as Promise<any>;\n    }\n    //Search the library for tracks where ``field`` contains ``values``.\n    //\n    //``field`` can be one of ``uri``, ``track_name``, ``album``, ``artist``,\n    //``albumartist``, ``composer``, ``performer``, ``track_no``, ``genre``,\n    //``date``, ``comment``, ``disc_no``, ``musicbrainz_albumid``,\n    //``musicbrainz_artistid``, ``musicbrainz_trackid`` or ``any``.\n    //\n    //If ``uris`` is given, the search is limited to results from within the\n    //URI roots. For example passing ``uris=['file:']`` will limit the search\n    //to the local backend.\n    //\n    //Examples::\n    //\n    //    # Returns results matching 'a' in any backend\n    //    search({'any': ['a']})\n    //\n    //    # Returns results matching artist 'xyz' in any backend\n    //    search({'artist': ['xyz']})\n    //\n    //    # Returns results matching 'a' and 'b' and artist 'xyz' in any\n    //    # backend\n    //    search({'any': ['a', 'b'], 'artist': ['xyz']})\n    //\n    //    # Returns results matching 'a' if within the given URI roots\n    //    # \"file:///media/music\" and \"spotify:\"\n    //    search({'any': ['a']}, uris=['file:///media/music', 'spotify:'])\n    //\n    //    # Returns results matching artist 'xyz' and 'abc' in any backend\n    //    search({'artist': ['xyz', 'abc']})\n    //\n    //:param query: one or more queries to search for\n    //:type query: dict\n    //:param uris: zero or more URI roots to limit the search to\n    //:type uris: list of string or :class:`None`\n    //:param exact: if the search should use exact matching\n    //:type exact: :class:`bool`\n    //:rtype: list of :class:`mopidy.models.SearchResult`\n    //\n    //.. versionadded:: 1.0\n    //    The ``exact`` keyword argument.\n    search(query: Object, uris?: string[], exact: boolean = false): Promise<SearchResult[]> {\n        return this.mopidy.send(\"core.library.search\", {query, uris, exact}) as Promise<SearchResult[]>;\n    }\n}\n\nclass Core_Mixer {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Get mute state.\n    //\n    //:class:`True` if muted, :class:`False` unmuted, :class:`None` if\n    //unknown.\n    getMute(): Promise<any> {\n        return this.mopidy.send(\"core.mixer.get_mute\") as Promise<any>;\n    }\n    //Get the volume.\n    //\n    //Integer in range [0..100] or :class:`None` if unknown.\n    //\n    //The volume scale is linear.\n    getVolume(): Promise<any> {\n        return this.mopidy.send(\"core.mixer.get_volume\") as Promise<any>;\n    }\n    //Set mute state.\n    //\n    //:class:`True` to mute, :class:`False` to unmute.\n    //\n    //Returns :class:`True` if call is successful, otherwise :class:`False`.\n    setMute(mute: boolean): Promise<any> {\n        return this.mopidy.send(\"core.mixer.set_mute\", {mute}) as Promise<any>;\n    }\n    //Set the volume.\n    //\n    //The volume is defined as an integer in range [0..100].\n    //\n    //The volume scale is linear.\n    //\n    //Returns :class:`True` if call is successful, otherwise :class:`False`.\n    setVolume(volume: number): Promise<any> {\n        return this.mopidy.send(\"core.mixer.set_volume\", {volume}) as Promise<any>;\n    }\n}\n\nclass Core_Playback {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Get the currently playing or selected track.\n    //\n    //Returns a :class:`mopidy.models.TlTrack` or :class:`None`.\n    getCurrentTlTrack(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_current_tl_track\") as Promise<any>;\n    }\n    //Get the currently playing or selected TLID.\n    //\n    //Extracted from :meth:`get_current_tl_track` for convenience.\n    //\n    //Returns a :class:`int` or :class:`None`.\n    //\n    //.. versionadded:: 1.1\n    getCurrentTlid(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_current_tlid\") as Promise<any>;\n    }\n    //Get the currently playing or selected track.\n    //\n    //Extracted from :meth:`get_current_tl_track` for convenience.\n    //\n    //Returns a :class:`mopidy.models.Track` or :class:`None`.\n    getCurrentTrack(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_current_track\") as Promise<any>;\n    }\n    //Get The playback state.\n    getState(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_state\") as Promise<any>;\n    }\n    //Get the current stream title or :class:`None`.\n    getStreamTitle(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_stream_title\") as Promise<any>;\n    }\n    //Get time position in milliseconds.\n    getTimePosition(): Promise<any> {\n        return this.mopidy.send(\"core.playback.get_time_position\") as Promise<any>;\n    }\n    //Change to the next track.\n    //\n    //The current playback state will be kept. If it was playing, playing\n    //will continue. If it was paused, it will still be paused, etc.\n    next(): Promise<any> {\n        return this.mopidy.send(\"core.playback.next\") as Promise<any>;\n    }\n    //Pause playback.\n    pause(): Promise<any> {\n        return this.mopidy.send(\"core.playback.pause\") as Promise<any>;\n    }\n    //Play the given track, or if the given tl_track and tlid is\n    //:class:`None`, play the currently active track.\n    //\n    //Note that the track **must** already be in the tracklist.\n    //\n    //.. deprecated:: 3.0\n    //    The ``tl_track`` argument. Use ``tlid`` instead.\n    //\n    //:param tl_track: track to play\n    //:type tl_track: :class:`mopidy.models.TlTrack` or :class:`None`\n    //:param tlid: TLID of the track to play\n    //:type tlid: :class:`int` or :class:`None`\n    play(tl_track?: null, tlid?: number): Promise<any> {\n        return this.mopidy.send(\"core.playback.play\", {tl_track, tlid}) as Promise<any>;\n    }\n    //Change to the previous track.\n    //\n    //The current playback state will be kept. If it was playing, playing\n    //will continue. If it was paused, it will still be paused, etc.\n    previous(): Promise<any> {\n        return this.mopidy.send(\"core.playback.previous\") as Promise<any>;\n    }\n    //If paused, resume playing the current track.\n    resume(): Promise<any> {\n        return this.mopidy.send(\"core.playback.resume\") as Promise<any>;\n    }\n    //Seeks to time position given in milliseconds.\n    //\n    //:param time_position: time position in milliseconds\n    //:type time_position: int\n    //:rtype: :class:`True` if successful, else :class:`False`\n    seek(time_position: number): Promise<boolean> {\n        return this.mopidy.send(\"core.playback.seek\", {time_position}) as Promise<boolean>;\n    }\n    //Set the playback state.\n    //\n    //Must be :attr:`PLAYING`, :attr:`PAUSED`, or :attr:`STOPPED`.\n    //\n    //Possible states and transitions:\n    //\n    //.. digraph:: state_transitions\n    //\n    //    \"STOPPED\" -> \"PLAYING\" [ label=\"play\" ]\n    //    \"STOPPED\" -> \"PAUSED\" [ label=\"pause\" ]\n    //    \"PLAYING\" -> \"STOPPED\" [ label=\"stop\" ]\n    //    \"PLAYING\" -> \"PAUSED\" [ label=\"pause\" ]\n    //    \"PLAYING\" -> \"PLAYING\" [ label=\"play\" ]\n    //    \"PAUSED\" -> \"PLAYING\" [ label=\"resume\" ]\n    //    \"PAUSED\" -> \"STOPPED\" [ label=\"stop\" ]\n    setState(new_state: PlaybackState): Promise<any> {\n        return this.mopidy.send(\"core.playback.set_state\", {new_state}) as Promise<any>;\n    }\n    //Stop playing.\n    stop(): Promise<any> {\n        return this.mopidy.send(\"core.playback.stop\") as Promise<any>;\n    }\n}\n\nclass Core_Playlists {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Get a list of the currently available playlists.\n    //\n    //Returns a list of :class:`~mopidy.models.Ref` objects referring to the\n    //playlists. In other words, no information about the playlists' content\n    //is given.\n    //\n    //:rtype: list of :class:`mopidy.models.Ref`\n    //\n    //.. versionadded:: 1.0\n    asList(): Promise<Ref<AllUris>[]> {\n        return this.mopidy.send(\"core.playlists.as_list\") as Promise<Ref<AllUris>[]>;\n    }\n    //Create a new playlist.\n    //\n    //If ``uri_scheme`` matches an URI scheme handled by a current backend,\n    //that backend is asked to create the playlist. If ``uri_scheme`` is\n    //:class:`None` or doesn't match a current backend, the first backend is\n    //asked to create the playlist.\n    //\n    //All new playlists must be created by calling this method, and **not**\n    //by creating new instances of :class:`mopidy.models.Playlist`.\n    //\n    //:param name: name of the new playlist\n    //:type name: string\n    //:param uri_scheme: use the backend matching the URI scheme\n    //:type uri_scheme: string\n    //:rtype: :class:`mopidy.models.Playlist` or :class:`None`\n    create(name: string, uri_scheme: string): Promise<Playlist> {\n        return this.mopidy.send(\"core.playlists.create\", {name, uri_scheme}) as Promise<Playlist>;\n    }\n    //Delete playlist identified by the URI.\n    //\n    //If the URI doesn't match the URI schemes handled by the current\n    //backends, nothing happens.\n    //\n    //Returns :class:`True` if deleted, :class:`False` otherwise.\n    //\n    //:param uri: URI of the playlist to delete\n    //:type uri: string\n    //:rtype: :class:`bool`\n    //\n    //.. versionchanged:: 2.2\n    //    Return type defined.\n    delete(uri: string): Promise<boolean> {\n        return this.mopidy.send(\"core.playlists.delete\", {uri}) as Promise<boolean>;\n    }\n    //Get the items in a playlist specified by ``uri``.\n    //\n    //Returns a list of :class:`~mopidy.models.Ref` objects referring to the\n    //playlist's items.\n    //\n    //If a playlist with the given ``uri`` doesn't exist, it returns\n    //:class:`None`.\n    //\n    //:rtype: list of :class:`mopidy.models.Ref`, or :class:`None`\n    //\n    //.. versionadded:: 1.0\n    getItems(uri: string): Promise<Ref<AllUris>[]> {\n        return this.mopidy.send(\"core.playlists.get_items\", {uri}) as Promise<Ref<AllUris>[]>;\n    }\n    //Get the list of URI schemes that support playlists.\n    //\n    //:rtype: list of string\n    //\n    //.. versionadded:: 2.0\n    getUriSchemes(): Promise<string[]> {\n        return this.mopidy.send(\"core.playlists.get_uri_schemes\") as Promise<string[]>;\n    }\n    //Lookup playlist with given URI in both the set of playlists and in any\n    //other playlist sources. Returns :class:`None` if not found.\n    //\n    //:param uri: playlist URI\n    //:type uri: string\n    //:rtype: :class:`mopidy.models.Playlist` or :class:`None`\n    lookup(uri: string): Promise<Playlist> {\n        return this.mopidy.send(\"core.playlists.lookup\", {uri}) as Promise<Playlist>;\n    }\n    //Refresh the playlists in :attr:`playlists`.\n    //\n    //If ``uri_scheme`` is :class:`None`, all backends are asked to refresh.\n    //If ``uri_scheme`` is an URI scheme handled by a backend, only that\n    //backend is asked to refresh. If ``uri_scheme`` doesn't match any\n    //current backend, nothing happens.\n    //\n    //:param uri_scheme: limit to the backend matching the URI scheme\n    //:type uri_scheme: string\n    refresh(uri_scheme: string): Promise<any> {\n        return this.mopidy.send(\"core.playlists.refresh\", {uri_scheme}) as Promise<any>;\n    }\n    //Save the playlist.\n    //\n    //For a playlist to be saveable, it must have the ``uri`` attribute set.\n    //You must not set the ``uri`` atribute yourself, but use playlist\n    //objects returned by :meth:`create` or retrieved from :attr:`playlists`,\n    //which will always give you saveable playlists.\n    //\n    //The method returns the saved playlist. The return playlist may differ\n    //from the saved playlist. E.g. if the playlist name was changed, the\n    //returned playlist may have a different URI. The caller of this method\n    //must throw away the playlist sent to this method, and use the\n    //returned playlist instead.\n    //\n    //If the playlist's URI isn't set or doesn't match the URI scheme of a\n    //current backend, nothing is done and :class:`None` is returned.\n    //\n    //:param playlist: the playlist\n    //:type playlist: :class:`mopidy.models.Playlist`\n    //:rtype: :class:`mopidy.models.Playlist` or :class:`None`\n    save(playlist: Playlist): Promise<Playlist> {\n        return this.mopidy.send(\"core.playlists.save\", {playlist}) as Promise<Playlist>;\n    }\n}\n\nclass Core_Tracklist {\n    mopidy: Mopidy;\n\n    constructor(mopidy: Mopidy) {\n        this.mopidy = mopidy;\n    }\n\n    //Add tracks to the tracklist.\n    //\n    //If ``uris`` is given instead of ``tracks``, the URIs are\n    //looked up in the library and the resulting tracks are added to the\n    //tracklist.\n    //\n    //If ``at_position`` is given, the tracks are inserted at the given\n    //position in the tracklist. If ``at_position`` is not given, the tracks\n    //are appended to the end of the tracklist.\n    //\n    //Triggers the :meth:`mopidy.core.CoreListener.tracklist_changed` event.\n    //\n    //:param tracks: tracks to add\n    //:type tracks: list of :class:`mopidy.models.Track` or :class:`None`\n    //:param at_position: position in tracklist to add tracks\n    //:type at_position: int or :class:`None`\n    //:param uris: list of URIs for tracks to add\n    //:type uris: list of string or :class:`None`\n    //:rtype: list of :class:`mopidy.models.TlTrack`\n    //\n    //.. versionadded:: 1.0\n    //    The ``uris`` argument.\n    //\n    //.. deprecated:: 1.0\n    //    The ``tracks`` argument. Use ``uris``.\n    add(tracks?: undefined, at_position?: number, uris?: string[]): Promise<TlTrack[]> {\n        return this.mopidy.send(\"core.tracklist.add\", {tracks, at_position, uris}) as Promise<TlTrack[]>;\n    }\n    //Clear the tracklist.\n    //\n    //Triggers the :meth:`mopidy.core.CoreListener.tracklist_changed` event.\n    clear(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.clear\") as Promise<any>;\n    }\n    //The track that will be played after the given track.\n    //\n    //Not necessarily the same track as :meth:`next_track`.\n    //\n    //.. deprecated:: 3.0\n    //    Use :meth:`get_eot_tlid` instead.\n    //\n    //:param tl_track: the reference track\n    //:type tl_track: :class:`mopidy.models.TlTrack` or :class:`None`\n    //:rtype: :class:`mopidy.models.TlTrack` or :class:`None`\n    eotTrack(tl_track?: TlTrack): Promise<TlTrack> {\n        return this.mopidy.send(\"core.tracklist.eot_track\", {tl_track}) as Promise<TlTrack>;\n    }\n    //Filter the tracklist by the given criteria.\n    //\n    //Each rule in the criteria consists of a model field and a list of\n    //values to compare it against. If the model field matches any of the\n    //values, it may be returned.\n    //\n    //Only tracks that match all the given criteria are returned.\n    //\n    //Examples::\n    //\n    //    # Returns tracks with TLIDs 1, 2, 3, or 4 (tracklist ID)\n    //    filter({'tlid': [1, 2, 3, 4]})\n    //\n    //    # Returns track with URIs 'xyz' or 'abc'\n    //    filter({'uri': ['xyz', 'abc']})\n    //\n    //    # Returns track with a matching TLIDs (1, 3 or 6) and a\n    //    # matching URI ('xyz' or 'abc')\n    //    filter({'tlid': [1, 3, 6], 'uri': ['xyz', 'abc']})\n    //\n    //:param criteria: one or more rules to match by\n    //:type criteria: dict, of (string, list) pairs\n    //:rtype: list of :class:`mopidy.models.TlTrack`\n    filter(criteria: FilterCriteria): Promise<TlTrack[]> {\n        return this.mopidy.send(\"core.tracklist.filter\", {criteria}) as Promise<TlTrack[]>;\n    }\n    //Get consume mode.\n    //\n    //:class:`True`\n    //    Tracks are removed from the tracklist when they have been played.\n    //:class:`False`\n    //    Tracks are not removed from the tracklist.\n    getConsume(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_consume\") as Promise<any>;\n    }\n    //The TLID of the track that will be played after the current track.\n    //\n    //Not necessarily the same TLID as returned by :meth:`get_next_tlid`.\n    //\n    //:rtype: :class:`int` or :class:`None`\n    //\n    //.. versionadded:: 1.1\n    getEotTlid(): Promise<number> {\n        return this.mopidy.send(\"core.tracklist.get_eot_tlid\") as Promise<number>;\n    }\n    //Get length of the tracklist.\n    getLength(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_length\") as Promise<any>;\n    }\n    //The tlid of the track that will be played if calling\n    //:meth:`mopidy.core.PlaybackController.next()`.\n    //\n    //For normal playback this is the next track in the tracklist. If repeat\n    //is enabled the next track can loop around the tracklist. When random is\n    //enabled this should be a random track, all tracks should be played once\n    //before the tracklist repeats.\n    //\n    //:rtype: :class:`int` or :class:`None`\n    //\n    //.. versionadded:: 1.1\n    getNextTlid(): Promise<number> {\n        return this.mopidy.send(\"core.tracklist.get_next_tlid\") as Promise<number>;\n    }\n    //Returns the TLID of the track that will be played if calling\n    //:meth:`mopidy.core.PlaybackController.previous()`.\n    //\n    //For normal playback this is the previous track in the tracklist. If\n    //random and/or consume is enabled it should return the current track\n    //instead.\n    //\n    //:rtype: :class:`int` or :class:`None`\n    //\n    //.. versionadded:: 1.1\n    getPreviousTlid(): Promise<number> {\n        return this.mopidy.send(\"core.tracklist.get_previous_tlid\") as Promise<number>;\n    }\n    //Get random mode.\n    //\n    //:class:`True`\n    //    Tracks are selected at random from the tracklist.\n    //:class:`False`\n    //    Tracks are played in the order of the tracklist.\n    getRandom(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_random\") as Promise<any>;\n    }\n    //Get repeat mode.\n    //\n    //:class:`True`\n    //    The tracklist is played repeatedly.\n    //:class:`False`\n    //    The tracklist is played once.\n    getRepeat(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_repeat\") as Promise<any>;\n    }\n    //Get single mode.\n    //\n    //:class:`True`\n    //    Playback is stopped after current song, unless in ``repeat`` mode.\n    //:class:`False`\n    //    Playback continues after current song.\n    getSingle(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_single\") as Promise<any>;\n    }\n    //Get tracklist as list of :class:`mopidy.models.TlTrack`.\n    getTlTracks(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_tl_tracks\") as Promise<any>;\n    }\n    //Get tracklist as list of :class:`mopidy.models.Track`.\n    getTracks(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_tracks\") as Promise<any>;\n    }\n    //Get the tracklist version.\n    //\n    //Integer which is increased every time the tracklist is changed. Is not\n    //reset before Mopidy is restarted.\n    getVersion(): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.get_version\") as Promise<any>;\n    }\n    //The position of the given track in the tracklist.\n    //\n    //If neither *tl_track* or *tlid* is given we return the index of\n    //the currently playing track.\n    //\n    //:param tl_track: the track to find the index of\n    //:type tl_track: :class:`mopidy.models.TlTrack` or :class:`None`\n    //:param tlid: TLID of the track to find the index of\n    //:type tlid: :class:`int` or :class:`None`\n    //:rtype: :class:`int` or :class:`None`\n    //\n    //.. versionadded:: 1.1\n    //    The *tlid* parameter\n    index(tl_track?: TlTrack, tlid?: number): Promise<number> {\n        return this.mopidy.send(\"core.tracklist.index\", {tl_track, tlid}) as Promise<number>;\n    }\n    //Move the tracks in the slice ``[start:end]`` to ``to_position``.\n    //\n    //Triggers the :meth:`mopidy.core.CoreListener.tracklist_changed` event.\n    //\n    //:param start: position of first track to move\n    //:type start: int\n    //:param end: position after last track to move\n    //:type end: int\n    //:param to_position: new position for the tracks\n    //:type to_position: int\n    move(start: number, end: number, to_position: number): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.move\", {start, end, to_position}) as Promise<any>;\n    }\n    //The track that will be played if calling\n    //:meth:`mopidy.core.PlaybackController.next()`.\n    //\n    //For normal playback this is the next track in the tracklist. If repeat\n    //is enabled the next track can loop around the tracklist. When random is\n    //enabled this should be a random track, all tracks should be played once\n    //before the tracklist repeats.\n    //\n    //.. deprecated:: 3.0\n    //    Use :meth:`get_next_tlid` instead.\n    //\n    //:param tl_track: the reference track\n    //:type tl_track: :class:`mopidy.models.TlTrack` or :class:`None`\n    //:rtype: :class:`mopidy.models.TlTrack` or :class:`None`\n    nextTrack(tl_track?: TlTrack): Promise<TlTrack> {\n        return this.mopidy.send(\"core.tracklist.next_track\", {tl_track}) as Promise<TlTrack>;\n    }\n    //Returns the track that will be played if calling\n    //:meth:`mopidy.core.PlaybackController.previous()`.\n    //\n    //For normal playback this is the previous track in the tracklist. If\n    //random and/or consume is enabled it should return the current track\n    //instead.\n    //\n    //.. deprecated:: 3.0\n    //    Use :meth:`get_previous_tlid` instead.\n    //\n    //:param tl_track: the reference track\n    //:type tl_track: :class:`mopidy.models.TlTrack` or :class:`None`\n    //:rtype: :class:`mopidy.models.TlTrack` or :class:`None`\n    previousTrack(tl_track?: TlTrack): Promise<TlTrack> {\n        return this.mopidy.send(\"core.tracklist.previous_track\", {tl_track}) as Promise<TlTrack>;\n    }\n    //Remove the matching tracks from the tracklist.\n    //\n    //Uses :meth:`filter()` to lookup the tracks to remove.\n    //\n    //Triggers the :meth:`mopidy.core.CoreListener.tracklist_changed` event.\n    //\n    //:param criteria: one or more rules to match by\n    //:type criteria: dict, of (string, list) pairs\n    //:rtype: list of :class:`mopidy.models.TlTrack` that were removed\n    remove(criteria: FilterCriteria): Promise<TlTrack[]> {\n        return this.mopidy.send(\"core.tracklist.remove\", {criteria}) as Promise<TlTrack[]>;\n    }\n    //Set consume mode.\n    //\n    //:class:`True`\n    //    Tracks are removed from the tracklist when they have been played.\n    //:class:`False`\n    //    Tracks are not removed from the tracklist.\n    setConsume(value: boolean): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.set_consume\", {value}) as Promise<any>;\n    }\n    //Set random mode.\n    //\n    //:class:`True`\n    //    Tracks are selected at random from the tracklist.\n    //:class:`False`\n    //    Tracks are played in the order of the tracklist.\n    setRandom(value: boolean): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.set_random\", {value}) as Promise<any>;\n    }\n    //Set repeat mode.\n    //\n    //To repeat a single track, set both ``repeat`` and ``single``.\n    //\n    //:class:`True`\n    //    The tracklist is played repeatedly.\n    //:class:`False`\n    //    The tracklist is played once.\n    setRepeat(value: boolean): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.set_repeat\", {value}) as Promise<any>;\n    }\n    //Set single mode.\n    //\n    //:class:`True`\n    //    Playback is stopped after current song, unless in ``repeat`` mode.\n    //:class:`False`\n    //    Playback continues after current song.\n    setSingle(value: boolean): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.set_single\", {value}) as Promise<any>;\n    }\n    //Shuffles the entire tracklist. If ``start`` and ``end`` is given only\n    //shuffles the slice ``[start:end]``.\n    //\n    //Triggers the :meth:`mopidy.core.CoreListener.tracklist_changed` event.\n    //\n    //:param start: position of first track to shuffle\n    //:type start: int or :class:`None`\n    //:param end: position after last track to shuffle\n    //:type end: int or :class:`None`\n    shuffle(start?: number, end?: number): Promise<any> {\n        return this.mopidy.send(\"core.tracklist.shuffle\", {start, end}) as Promise<any>;\n    }\n    //Returns a slice of the tracklist, limited by the given start and end\n    //positions.\n    //\n    //:param start: position of first track to include in slice\n    //:type start: int\n    //:param end: position after last track to include in slice\n    //:type end: int\n    //:rtype: :class:`mopidy.models.TlTrack`\n    slice(start: number, end: number): Promise<TlTrack> {\n        return this.mopidy.send(\"core.tracklist.slice\", {start, end}) as Promise<TlTrack>;\n    }\n}\n\n","// the first part of Mopidy extensions which serve radio streams\r\nlet radioExtensionsList = ['somafm', 'tunein', 'dirble', 'audioaddict']\r\n\r\nlet uriClassList = [\r\n    ['spotify', 'fa-spotify'],\r\n    ['spotifytunigo', 'fa-spotify'],\r\n    ['spotifyweb', 'fa-spotify'],\r\n    ['local', 'fa-file-sound-o'],\r\n    ['file', 'fa-file-sound-o'],\r\n    ['m3u', 'fa-file-sound-o'],\r\n    ['podcast', 'fa-rss-square'],\r\n    ['podcast+file', 'fa-rss-square'],\r\n    ['podcast+itunes', 'fa-apple'],\r\n    ['dirble', 'fa-microphone'],\r\n    ['tunein', 'fa-headphones'],\r\n    ['soundcloud', 'fa-soundcloud'],\r\n    ['sc', 'fa-soundcloud'],\r\n    ['gmusic', 'fa-google'],\r\n    ['internetarchive', 'fa-university'],\r\n    ['somafm', 'fa-flask'],\r\n    ['youtube', 'fa-youtube'],\r\n    ['yt', 'fa-youtube'],\r\n    ['audioaddict', 'fa-bullhorn'],\r\n    ['subsonic', 'fa-folder-open']\r\n]\r\n\r\nlet uriHumanList = [\r\n    ['spotify', 'Spotify'],\r\n    ['spotifytunigo', 'Spotify browse'],\r\n    ['spotifyweb', 'Spotify browse'],\r\n    ['local', 'Local media'],\r\n    ['m3u', 'Local playlists'],\r\n    ['podcast', 'Podcasts'],\r\n    ['podcast+itunes', 'iTunes Store: Podcasts'],\r\n    ['dirble', 'Dirble'],\r\n    ['tunein', 'TuneIn'],\r\n    ['soundcloud', 'SoundCloud'],\r\n    ['gmusic', 'Google Music'],\r\n    ['internetarchive', 'Internet Archive'],\r\n    ['somafm', 'Soma FM'],\r\n    ['youtube', 'YouTube'],\r\n    ['audioaddict', 'AudioAddict'],\r\n    ['subsonic', 'Subsonic']\r\n]\r\n\r\n// List of Mopidy URI schemes that should not be searched directly.\r\n// Also blacklists 'yt' in favour of using the other 'youtube' supported scheme.\r\nexport const searchBlacklist = [\r\n    'file',\r\n    'http',\r\n    'https',\r\n    'mms',\r\n    'rtmp',\r\n    'rtmps',\r\n    'rtsp',\r\n    'yt'\r\n]\r\n\r\n// List of known audio file extensions\r\n// TODO: consider querying GStreamer for supported audio formats - see:https://discuss.mopidy.com/t/supported-codecs-file-formats/473\r\nconst VALID_AUDIO_EXT = [\r\n    'aa', 'aax',  // Audible.com\r\n    'aac',  // Advanced Audio Coding format\r\n    'aiff',  // Apple\r\n    'au',  // Sun Microsystems\r\n    'flac',  // Free Lossless Audio Codec\r\n    'gsm',\r\n    'iklax',\r\n    'ivs',\r\n    'm4a',\r\n    'm4b',\r\n    'm4p',\r\n    'mp3',\r\n    'mpc',  // Musepack\r\n    'ogg', 'oga', 'mogg',  // Ogg-Vorbis\r\n    'opus',  // Internet Engineering Task Force (IETF)\r\n    'ra', 'rm',  // RealAudio\r\n    'raw',\r\n    'tta',  // True Audio\r\n    'vox',\r\n    'wav',\r\n    'wma',  // Microsoft\r\n    'wv',\r\n    'webm'  // HTML5 video\r\n]\r\n\r\n\r\n// from http://dzone.com/snippets/validate-url-regexp\r\nexport function validUri (uri: string) {\r\n    let regexp = /^(http|https|mms|rtmp|rtmps|rtsp):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\r\n    return regexp.test(uri);\r\n}\r\n\r\nexport function getScheme (uri: string) {\r\n    return uri.split(':')[0].toLowerCase();\r\n}\r\n\r\nexport function jsonParse<T>(data: string, defaultValue: T): T {\r\n    try {\r\n        return JSON.parse(data);\r\n    } catch (e) {\r\n        console.error(e);\r\n        return defaultValue;\r\n    }\r\n}","import {BrowseFilterBreadCrumbStack, Model} from \"../model\";\r\nimport {jsonParse} from \"../functionsvars\";\r\nimport {AllUris, BreadCrumbBrowseFilter, BreadCrumbHome, BreadCrumbRef, BrowseFilter, FilterBreadCrumb} from \"../modelTypes\";\r\nimport {BreadCrumb, BreadCrumbStack} from \"../breadCrumb\";\r\nimport models from \"../../js/mopidy\";\r\nimport Ref = models.Ref;\r\n\r\nconst CURRENT_BROWSE_FILTERS__KEY = \"currentBrowseFilters\";\r\nconst BROWSE_FILTERS_BREADCRUMBS_KEY = \"browseFiltersBreadCrumbs\";\r\n\r\nexport class LocalStorageProxy {\r\n    private model: Model;\r\n\r\n    constructor(model: Model) {\r\n        this.model = model;\r\n    }\r\n\r\n    loadCurrentBrowseFilter() {\r\n        let browseFilterString = localStorage.getItem(CURRENT_BROWSE_FILTERS__KEY);\r\n        if (browseFilterString) {\r\n            let browseFilterObject = jsonParse(browseFilterString, this.model.getCurrentBrowseFilter());\r\n            let browseFilter = new BrowseFilter();\r\n            Object.assign(browseFilter, browseFilterObject);\r\n            this.model.setCurrentBrowseFilter(browseFilter);\r\n            return;\r\n        }\r\n        console.error(\"Could not load or parse browse filter bread crumbs from local storage. Using default bread crumbs.\");\r\n    }\r\n\r\n    loadBrowseFiltersBreadCrumbs() {\r\n        let breadCrumbsString = localStorage.getItem(BROWSE_FILTERS_BREADCRUMBS_KEY);\r\n        if (breadCrumbsString) {\r\n            let breadCrumbsArray = jsonParse(breadCrumbsString, this.model.getBreadCrumbs());\r\n            let breadCrumbs = new BrowseFilterBreadCrumbStack();\r\n            breadCrumbsArray\r\n                .map(crumb => {\r\n                    switch (crumb.type) {\r\n                        case \"browseFilter\":\r\n                            let browseFilter = new BrowseFilter();\r\n                            Object.assign(browseFilter, crumb.data);\r\n                            return new BreadCrumbBrowseFilter(crumb.label, browseFilter);\r\n                        case \"ref\":\r\n                            return new BreadCrumbRef(crumb.label, crumb.data as Ref<AllUris>);\r\n                        case \"home\":\r\n                            return new BreadCrumbHome();\r\n                    }\r\n                })\r\n                .forEach(crumb =>\r\n                    breadCrumbs.push(crumb));\r\n            if(breadCrumbs.length == 0) {\r\n                breadCrumbs.push(new BreadCrumbHome());\r\n            }\r\n            else {\r\n                if (breadCrumbs[0].type != \"home\")\r\n                    breadCrumbs.unshift(new BreadCrumbHome());\r\n            }\r\n            this.model.setBrowseFilterBreadCrumbs(breadCrumbs);\r\n            return;\r\n        }\r\n        console.error(\"Could not load or parse browse filters from local storage. Using default filters.\");\r\n    }\r\n\r\n    saveCurrentBrowseFilter(browseFilter: BrowseFilter) {\r\n        let obj = JSON.stringify(browseFilter);\r\n        console.log(obj);\r\n        localStorage.setItem(CURRENT_BROWSE_FILTERS__KEY, obj);\r\n    }\r\n\r\n    saveBrowseFilterBreadCrumbs(breadCrumbs: BrowseFilterBreadCrumbStack) {\r\n        let obj = JSON.stringify(breadCrumbs);\r\n        console.log(obj);\r\n        localStorage.setItem(BROWSE_FILTERS_BREADCRUMBS_KEY, obj);\r\n    }\r\n\r\n}","import {AlbumMetaData, AlbumUri, AllUris, GenreDef, GenreReplacement, HistoryLineDef, RememberDef, RememberId, StreamTitles, StreamUri, TrackUri} from \"../modelTypes\";\r\nimport {ExpandedRef} from \"../refs\";\r\n\r\nexport type AlbumMetaDict = {[uri: AlbumUri]: AlbumMetaData};\r\n\r\nexport class WebProxy {\r\n    private ebobackBase: string;\r\n    private eboplayerBase: string;\r\n\r\n    constructor(hostAndPort: string) {\r\n        this.ebobackBase = `http://${hostAndPort}/eboback/data/`;\r\n        this.eboplayerBase = `http://${hostAndPort}/eboplayer2/`;\r\n    }\r\n\r\n    playerUrl(relPath: string) {\r\n        return new URL(this.eboplayerBase+relPath);\r\n    }\r\n    ebobackUrl(relPath: string) {\r\n        return new URL(this.ebobackBase+relPath);\r\n    }\r\n\r\n    async fetchActiveStreamLines(uri: StreamUri) {\r\n        let url = this.playerUrl(`stream/activeLines`);\r\n        url.searchParams.set(\"uri\", uri);\r\n        let res = await fetch(url);\r\n        return await res.json() as StreamTitles;\r\n    }\r\n\r\n    async fetchAllStreamLines(uri: string) {\r\n        let url = this.playerUrl(`stream/allLines`);\r\n        url.searchParams.set(\"uri\", uri);\r\n        let res = await fetch(url);\r\n        return await res.json() as string[];\r\n    }\r\n\r\n    async fetchMetaDatas(albumUris: AlbumUri[]) {\r\n        let url = this.ebobackUrl(`get_album_metas`);\r\n        //don't use url params, as max url lenght is 2048\r\n        //don't use get aa it's body is meaningless\r\n        let data = new FormData();\r\n        data.append(\"uris\", albumUris.join(\",\"));\r\n        let res = await fetch(url, {method: 'POST', body: data});\r\n        let text = await res.text();\r\n        if(text)\r\n            return JSON.parse(text) as AlbumMetaDict;\r\n        return {};\r\n    }\r\n\r\n    async fetchMetaData(albumUri: string) {\r\n        let url = this.ebobackUrl(`get_album_meta`);\r\n        url.searchParams.set(\"uri\", albumUri);\r\n        let res = await fetch(url);\r\n        let text = await res.text();\r\n        if(text)\r\n            return JSON.parse(text) as AlbumMetaData;\r\n        return null;\r\n    }\r\n\r\n    async addRefToPlaylist(playlistUri: AllUris, itemUri: AllUris, refType: string, sequence: number) {\r\n        let url = this.ebobackUrl(`add_ref_to_playlist`);\r\n        //add params to body of post request\r\n        let data = new FormData();\r\n        data.append(\"playlist_uri\", playlistUri);\r\n        data.append(\"item_uri\", itemUri);\r\n        data.append(\"ref_type\", refType);\r\n        data.append(\"sequence\", sequence.toString());\r\n        let res = await fetch(url, {method: 'POST', body: data});\r\n        return await res.json();\r\n    }\r\n\r\n    async fetchGenreReplacements() {\r\n        let url = this.ebobackUrl(`get_genre_replacements`);\r\n        let res = await fetch(url);\r\n        return await res.json() as GenreReplacement[];\r\n    }\r\n\r\n    async fetchGenreDefs() {\r\n        let url = this.ebobackUrl(`get_genre_defs`);\r\n        let res = await fetch(url);\r\n        return await res.json() as GenreDef[];\r\n    }\r\n\r\n    async remember(text: string) {\r\n        let url = this.ebobackUrl(`save_remember`);\r\n        let res = await fetch(url, {method: 'POST', body: text});\r\n        return await res.json();\r\n    }\r\n\r\n    async deleteRemember(id: RememberId) {\r\n        let url = this.ebobackUrl(`delete_remember`);\r\n        let res = await fetch(url, {method: 'POST', body: id});\r\n        return await res.json();\r\n    }\r\n\r\n    async fetchRemembers() {\r\n        let url = this.ebobackUrl(`get_remembers`);\r\n        let res = await fetch(url);\r\n        return await res.json() as RememberDef[];\r\n    }\r\n\r\n    async fetchHistory() {\r\n        let url = this.ebobackUrl(`get_history`);\r\n        let res = await fetch(url);\r\n        return await res.json() as HistoryLineDef[];\r\n    }\r\n\r\n    async fetchAllRefs() {\r\n        let url = this.ebobackUrl(`get_all_refs`);\r\n        let res = await fetch(url);\r\n        return await res.json() as ExpandedRef[];\r\n    }\r\n\r\n    async updateAlbumData(albumUri: AlbumUri) {\r\n        let url = this.ebobackUrl(`update_album_data`);\r\n        url.searchParams.set(\"album_uri\", albumUri);\r\n        let res = await fetch(url);\r\n        await res.text(); //todo: needed?\r\n        return null;\r\n    }\r\n    async uploadAlbumImages(albumUri: AlbumUri, imageUrl: string) {\r\n        let url = this.ebobackUrl(`upload_album_image`);\r\n        url.searchParams.set(\"album_uri\", albumUri);\r\n        url.searchParams.set(\"image_url\", imageUrl);\r\n        let res = await fetch(url);\r\n        await res.text(); //todo: needed?\r\n        return null;\r\n    }\r\n}","import {Model} from \"../model\";\r\nimport {Commands} from \"../commands\";\r\nimport models, {core, Mopidy} from \"../../js/mopidy\";\r\nimport {MopidyProxy} from \"../proxies/mopidyProxy\";\r\nimport {LocalStorageProxy} from \"../proxies/localStorageProxy\";\r\nimport {getHostAndPort} from \"../global\";\r\nimport {createAllRefs, SomeRefs} from \"../refs\";\r\nimport {AlbumModel, AlbumUri, AllUris, BreadCrumbBrowseFilter, BreadCrumbHome, BreadCrumbRef, BrowseFilter, ConnectionState, ExpandedAlbumModel, ExpandedFileTrackModel, ExpandedHistoryLineGroup, ExpandedStreamModel, isBreadCrumbForAlbum, NoStreamTitles, PlaylistUri, PlayState, RememberId, StreamTitles, StreamUri, TrackNone, TrackUri, Views} from \"../modelTypes\";\r\nimport {JsonRpcController} from \"../jsonRpcController\";\r\nimport {WebProxy} from \"../proxies/webProxy\";\r\nimport {PlayController} from \"./playController\";\r\nimport {View} from \"../views/view\";\r\nimport {RefArgs} from \"../events\";\r\nimport {CacheHandler} from \"./cacheHandler\";\r\nimport TlTrack = models.TlTrack;\r\nimport Ref = models.Ref;\r\nimport Playlist = models.Playlist;\r\nimport PlaybackState = core.PlaybackState;\r\n\r\nexport const LIBRARY_PROTOCOL = \"eboback:\";\r\n\r\n//The controller updates the model and has functions called by the views.\r\n//The controller does not update the views directly.\r\n//The controller should not listen to model events, to avoid circular updates (dead loops).\r\nexport class Controller extends Commands {\r\n    protected model: Model;\r\n    public mopidyProxy: MopidyProxy;\r\n    public webProxy: WebProxy;\r\n    public localStorageProxy: LocalStorageProxy;\r\n    private eboWsFrontCtrl: JsonRpcController;\r\n    private eboWsBackCtrl: JsonRpcController;\r\n    protected player: PlayController;\r\n    cache: CacheHandler;\r\n\r\n    constructor(model: Model, mopidy: Mopidy, eboWsFrontCtrl: JsonRpcController, eboWsBackCtrl: JsonRpcController, mopdyProxy: MopidyProxy, player: PlayController, cache: CacheHandler) {\r\n        super(mopidy);\r\n        this.cache = cache;\r\n        this.model  = model;\r\n        this.player = player;\r\n        this.mopidyProxy = mopdyProxy;\r\n        this.webProxy = new WebProxy(getHostAndPort());\r\n        this.localStorageProxy = new LocalStorageProxy(model);\r\n        this.eboWsFrontCtrl = eboWsFrontCtrl;\r\n        this.eboWsBackCtrl = eboWsBackCtrl;\r\n    }\r\n\r\n    async getInitialData(views: View[])  {\r\n        this.model.setVolume(await this.mopidyProxy.fetchVolume());\r\n        await this.setCurrentTrackAndFetchDetails(await this.mopidyProxy.fetchCurrentTlTrack());\r\n        this.model.setPlayState((await this.mopidyProxy.fetchPlayState()) as PlayState);\r\n        this.model.setPlaybackMode(await this.mopidyProxy.getPlaybackFlags());\r\n        this.model.setTrackList(await this.mopidyProxy.fetchTracklist());\r\n        await this.fetchAllAlbums();\r\n        this.localStorageProxy.loadCurrentBrowseFilter();\r\n        this.localStorageProxy.loadBrowseFiltersBreadCrumbs();\r\n        await this.fetchRefsForCurrentBreadCrumbs();\r\n        await this.filterBrowseResults();\r\n        await this.cache.getGenreReplacementsCached();\r\n        await this.cache.getRemembersCached();\r\n        await this.cache.getGenreDefs();\r\n    }\r\n\r\n    initialize (views: View[]) {\r\n        this.mopidy.on('state:online', async () => {\r\n            this.model.setConnectionState(ConnectionState.Online);\r\n            await this.getInitialData(views);\r\n            this.model.setHistory(await this.webProxy.fetchHistory());\r\n        });\r\n\r\n        this.mopidy.on('state:offline', () => {\r\n            this.model.setConnectionState(ConnectionState.Offline);\r\n        });\r\n\r\n        this.mopidy.on('event:optionsChanged', async () =>{\r\n            this.model.setPlaybackMode(await this.mopidyProxy.getPlaybackFlags());\r\n        });\r\n\r\n        this.mopidy.on('event:trackPlaybackStarted', async (data: {tl_track: TlTrack}) => { //todo: try to link `name` argument to `data` type automatically.\r\n            await this.setCurrentTrackAndFetchDetails(data.tl_track);\r\n        });\r\n\r\n        this.mopidy.on('event:trackPlaybackEnded', async (data: {tl_track: TlTrack}) => {\r\n            await this.setCurrentTrackAndFetchDetails(data.tl_track);\r\n        });\r\n\r\n        this.mopidy.on('event:trackPlaybackResumed', async (data: {tl_track: TlTrack}) => {\r\n            await this.setCurrentTrackAndFetchDetails(data.tl_track);\r\n        });\r\n\r\n        this.mopidy.on('event:playlistsLoaded', ()  => {\r\n            // library.getPlaylists();\r\n        });\r\n\r\n        this.mopidy.on('event:playlistChanged', (data: {playlist: Playlist}) => {\r\n            // delete this.stateplaylists[data.playlist.uri];\r\n            // library.getPlaylists();\r\n        });\r\n\r\n        this.mopidy.on('event:playlistDeleted', (data: {uir: PlaylistUri}) => {\r\n            // delete this.stateplaylists[data.uri];\r\n            // library.getPlaylists();\r\n        });\r\n\r\n        this.mopidy.on('event:volumeChanged', (data: {volume: number}) => {\r\n            this.model.setVolume(data.volume);\r\n        });\r\n\r\n        this.mopidy.on('event:muteChanged', (_data: any) => {\r\n        });\r\n\r\n        this.mopidy.on('event:playbackStateChanged', async (data: {new_state: PlaybackState}) => {\r\n            await this.onPlaybackStateChanged(data);\r\n        });\r\n\r\n        this.mopidy.on('event:tracklistChanged', async () => {\r\n            this.model.setTrackList(await this.mopidyProxy.fetchTracklist());\r\n            await this.setCurrentTrackAndFetchDetails(await this.mopidyProxy.fetchCurrentTrack());\r\n        });\r\n\r\n        this.mopidy.on('event:seeked', () => {\r\n        });\r\n\r\n        //log all events:\r\n        this.mopidy.on((data: any) => {\r\n            if(data instanceof MessageEvent) {\r\n                try {\r\n                    let dataObject = JSON.parse(data.data);\r\n                    if((dataObject.event ?? \"\") == \"stream_title_changed\")\r\n                        return;\r\n                } catch (e) {} //not valid json.\r\n            }\r\n            if(typeof(data) == \"object\") {\r\n                if((data.title && Object.keys(data).length) == 1)\r\n                    return;\r\n            }\r\n            if(data instanceof Array) {\r\n                if (data.length && data[0] == \"event:streamTitleChanged\")\r\n                    return;\r\n            }\r\n            console.log(data);\r\n        });\r\n        this.eboWsFrontCtrl.on(\"event:streamHistoryChanged\", (data: {stream_titles: StreamTitles}) => {\r\n            let streamTitles: StreamTitles = data.stream_titles;\r\n            this.model.setActiveStreamLinesHistory(streamTitles);\r\n        });\r\n        this.eboWsFrontCtrl.on(\"event:programTitleChanged\", (data: {program_title: string}) => {\r\n            this.model.setCurrentProgramTitle(data.program_title);\r\n        });\r\n        this.eboWsBackCtrl.on((data: any) => {\r\n            console.log(data);\r\n        });\r\n        this.eboWsBackCtrl.on(\"event:scanStarted\", (data: any) => {\r\n            this.model.setScanStatus(\"Scan started...\\n\");\r\n        });\r\n        this.eboWsBackCtrl.on(\"event:scanStatus\", (data: any) => {\r\n            this.model.setScanStatus(this.model.getScanStatus() + (data.message as string) + \"\\n\");\r\n        });\r\n        this.eboWsBackCtrl.on(\"event:scanFinished\", (data: any) => {\r\n            this.model.setScanStatus(this.model.getScanStatus() + \"Scan completed.\");\r\n            this.model.dispatchEboEvent(\"scanFinished.eboplayer\", {});\r\n        });\r\n    }\r\n\r\n    async fetchAllAlbums() {\r\n        let albumRefs = await this.mopidyProxy.browse(LIBRARY_PROTOCOL+\"directory?type=album\") as Ref<AlbumUri>[];\r\n        return await this.cache.lookupAlbumsCached(albumRefs.map(ref => ref.uri));\r\n    }\r\n\r\n    private async onPlaybackStateChanged(data: { new_state: PlaybackState; }) {\r\n        this.model.setPlayState(data.new_state);\r\n        await this.updateStreamLines();\r\n    }\r\n\r\n    async setCurrentTrackAndFetchDetails(data: (TlTrack | null)) {\r\n        if(!data) {\r\n            this.model.setCurrentTrack(TrackNone);\r\n            return;\r\n        }\r\n        let trackModel = await this.cache.lookupTrackCached(data.track.uri as TrackUri);\r\n        this.model.setCurrentTrack(trackModel);\r\n        if(!this.model.selectedTrack) {\r\n            let uri = trackModel?.track?.uri as TrackUri | undefined;\r\n            this.model.setSelectedTrack(uri?? null);\r\n        }\r\n        await this.updateStreamLines();\r\n\r\n        //todo: do this only when a track is started?s\r\n        // this.core.playback.getTimePosition().then(processCurrentposition, console.error)\r\n        // this.core.mixer.getMute().then(processMute, console.error)\r\n    }\r\n\r\n    private async updateStreamLines() {\r\n        if (this.model.getPlayState() != \"playing\") {\r\n            this.model.setActiveStreamLinesHistory(NoStreamTitles);\r\n            return;\r\n        }\r\n        if (this.model.currentTrack == null) {\r\n            this.model.setActiveStreamLinesHistory(NoStreamTitles);\r\n            return;\r\n        }\r\n\r\n        let trackModel = await this.cache.lookupTrackCached(this.model.currentTrack);\r\n        if (trackModel?.type == \"stream\") {\r\n            let lines = await this.webProxy.fetchActiveStreamLines(this.model.currentTrack as StreamUri);\r\n            this.model.setActiveStreamLinesHistory(lines);\r\n        } else {\r\n            this.model.setActiveStreamLinesHistory(NoStreamTitles);\r\n        }\r\n    }\r\n\r\n    async setAndSaveBrowseFilter(filter: BrowseFilter) {\r\n        this.localStorageProxy.saveCurrentBrowseFilter(filter);\r\n        this.model.setCurrentBrowseFilter(filter);\r\n        await this.filterBrowseResults();\r\n    }\r\n\r\n    async diveIntoBrowseResult(label: string, uri: AllUris, type: string, addTextFilterBreadcrumb: boolean) {\r\n        if(type  == \"radio\") { //todo\r\n            return; //don't dive.\r\n        }\r\n        if(type == \"track\") {\r\n            let track = await this.getExpandedTrackModel(uri as TrackUri) as ExpandedFileTrackModel;\r\n            if(track.album?.albumInfo?.uri)\r\n                this.showAlbum(track.album?.albumInfo?.uri, uri as TrackUri);\r\n            //else: don't dive\r\n            return; //don't change the breadcrumb and filter.\r\n        }\r\n\r\n        if(type == \"album\") {\r\n            this.getExpandedAlbumModel(uri as AlbumUri).then(() => { //fetch before changing view, to avoid flicker.\r\n                this.showAlbum(uri as AlbumUri, null);\r\n            });\r\n        }\r\n\r\n        // set 2 new breadCrumbs and a new browseFilter.\r\n        // > setting the browseFilter should only trigger a view update. NOT a re-filter!!!\r\n        if(addTextFilterBreadcrumb) {\r\n            let browseFilter = this.model.getCurrentBrowseFilter();\r\n            if(! browseFilter.isEmpty()) {\r\n                let breadCrumb1 = new BreadCrumbBrowseFilter(browseFilter.searchText, browseFilter);\r\n                this.model.pushBreadCrumb(breadCrumb1);\r\n            }\r\n        }\r\n        let ref: Ref<AllUris> = {type: type as models.ModelType, name: label, uri};\r\n        let breadCrumb2 = new BreadCrumbRef(label, ref);\r\n        this.model.pushBreadCrumb(breadCrumb2);\r\n\r\n        this.localStorageProxy.saveBrowseFilterBreadCrumbs(this.model.getBreadCrumbs());\r\n\r\n        let newBrowseFilter = new BrowseFilter();\r\n        //for each type, we dive into the next level of type. E.g., artist -> album -> track.\r\n        switch (type) {\r\n            case \"artist\": newBrowseFilter.album = true; break;\r\n            case \"genre\":\r\n                newBrowseFilter.radio = true;\r\n                newBrowseFilter.playlist = true;\r\n                newBrowseFilter.artist = true;\r\n                newBrowseFilter.album = true;\r\n                newBrowseFilter.track = true;\r\n                newBrowseFilter.genre = true;\r\n                break;\r\n            case \"playlist\":\r\n                newBrowseFilter.playlist = true;\r\n                newBrowseFilter.artist = true;\r\n                newBrowseFilter.album = true;\r\n                newBrowseFilter.track = true;\r\n                break;\r\n        }\r\n        await this.setAndSaveBrowseFilter(newBrowseFilter);\r\n\r\n        await this.fetchRefsForCurrentBreadCrumbs()\r\n        await this.filterBrowseResults();\r\n    }\r\n\r\n    async setWhatsNewFilter() {\r\n        await this.clearBreadCrumbs();\r\n        let browseFilter = new BrowseFilter();\r\n        browseFilter.addedSince = 1;\r\n        this.localStorageProxy.saveCurrentBrowseFilter(browseFilter);\r\n        this.model.setCurrentBrowseFilter(browseFilter);\r\n    }\r\n\r\n    async clearBreadCrumbs() {\r\n        this.model.resetBreadCrumbsTo(this.model.getBreadCrumbs()[0].id);\r\n    }\r\n\r\n    async resetToBreadCrumb(id: number) {\r\n        let breadCrumb = this.model.getBreadCrumbs().get(id);\r\n        let breadCrumbs = this.model.getBreadCrumbs();\r\n\r\n        //if the breadCrumb is a browseFilter, reset to the previous breadCrumb and set the current browseFilter to the one in the breadCrumb.\r\n        if(breadCrumb instanceof BreadCrumbBrowseFilter) {\r\n            this.model.resetBreadCrumbsTo(id);\r\n            let browseFilter = this.model.popBreadCrumb()?.data as BrowseFilter;\r\n            await this.setAndSaveBrowseFilter(browseFilter);\r\n            this.localStorageProxy.saveBrowseFilterBreadCrumbs(breadCrumbs);\r\n            await this.fetchRefsForCurrentBreadCrumbs()\r\n            await this.filterBrowseResults();\r\n        } else if(breadCrumb instanceof BreadCrumbRef) {\r\n            if(isBreadCrumbForAlbum(breadCrumb)) {\r\n                this.showAlbum(breadCrumb.data.uri, null);\r\n                return;\r\n            }\r\n            this.model.resetBreadCrumbsTo(id);\r\n            this.model.popBreadCrumb(); // remove the current breadCrumb as it will be added again below.\r\n            await this.diveIntoBrowseResult(breadCrumb.label, breadCrumb.data.uri, breadCrumb.data.type, false);\r\n        } else if (breadCrumb instanceof BreadCrumbHome) {\r\n            this.model.resetBreadCrumbsTo(id);\r\n            await this.setAndSaveBrowseFilter(new BrowseFilter());\r\n            this.localStorageProxy.saveBrowseFilterBreadCrumbs(breadCrumbs);\r\n            await this.fetchRefsForCurrentBreadCrumbs()\r\n            await this.filterBrowseResults();\r\n        }\r\n    }\r\n\r\n    async getExpandedTrackModel(trackUri: TrackUri | StreamUri | null): Promise<ExpandedStreamModel | ExpandedFileTrackModel | null>{\r\n        if(!trackUri)\r\n            return null;\r\n        let track = await this.cache.lookupTrackCached(trackUri);\r\n        if(track?.type == \"stream\") {\r\n            let streamLines = await this.fetchStreamLines(trackUri);\r\n            let remembers = await this.cache.lookupRemembersCached();\r\n            let rememberStrings = remembers.map(r => r.text);\r\n            let expandedStreamLines = streamLines.map(lines => {\r\n                let lineStr = lines.join(\"\\n\");\r\n                let expandedLineGroup: ExpandedHistoryLineGroup = {\r\n                    lines,\r\n                    remembered: rememberStrings.includes(lineStr)\r\n                };\r\n                return expandedLineGroup;\r\n            });\r\n            // noinspection UnnecessaryLocalVariableJS\r\n            return new ExpandedStreamModel(track, expandedStreamLines);\r\n        }\r\n        if(track) {\r\n            let uri = track?.track?.album?.uri;\r\n            let album: AlbumModel | null = null;\r\n            if(uri) {\r\n                let albums = await this.cache.lookupAlbumsCached([uri]);\r\n                album = albums[0];\r\n            }\r\n            return new ExpandedFileTrackModel(track, album);\r\n        }\r\n        throw new Error(\"trackUri not found in library\");\r\n    }\r\n\r\n    async getExpandedAlbumModel(albumUri: AlbumUri): Promise<ExpandedAlbumModel> {\r\n        let album =  (await this.cache.lookupAlbumsCached([albumUri]))[0];\r\n        let meta = await this.cache.getMetaDataCached(albumUri) ?? null;\r\n\r\n        return new ExpandedAlbumModel(album, this, meta);\r\n    }\r\n\r\n    setSelectedTrack(uri: TrackUri | StreamUri | null) {\r\n        this.model.setSelectedTrack(uri);\r\n    }\r\n\r\n    async fetchAllRefs() {\r\n        let allRefs = await this.webProxy.fetchAllRefs();\r\n\r\n        return createAllRefs(this.cache, allRefs);\r\n    }\r\n\r\n    async filterBrowseResults() {\r\n        await this.model.filterCurrentRefs();\r\n    }\r\n\r\n    async fetchRefsForCurrentBreadCrumbs() {\r\n        let breadCrumbs = this.model.getBreadCrumbs();\r\n        let lastCrumb = breadCrumbs.getLast();\r\n        if(!lastCrumb) {\r\n            await this.setAllRefsAsCurrent();\r\n            return;\r\n        }\r\n\r\n        if(lastCrumb instanceof BreadCrumbHome) {\r\n            await this.setAllRefsAsCurrent();\r\n            return;\r\n        }\r\n\r\n        if(lastCrumb instanceof BreadCrumbBrowseFilter) {\r\n            await this.setAllRefsAsCurrent();\r\n            return;\r\n        }\r\n\r\n        if(lastCrumb instanceof BreadCrumbRef) {\r\n            if(lastCrumb.data.type == \"playlist\") {\r\n                let playlistItems = await this.mopidyProxy.fetchPlaylistItems(lastCrumb.data.uri);\r\n                playlistItems.forEach(ref => {\r\n                    //\"local:track:Air/Moon%20Safari/01%20La%20Femme%20d%27Argent.wma\"\r\n\r\n                    if(!ref.name || ref.name == \"\") {\r\n                        ref.name = ref.uri\r\n                            .replace(LIBRARY_PROTOCOL + \"track:\", \"\")\r\n                            .replaceAll(\"%20\", \" \");\r\n                        //remove the last part of the uri, which is the file extension.\r\n                        ref.name = ref.name.split(\".\").slice(0, -1).join(\".\");\r\n                    }\r\n                });\r\n                this.model.setCurrentRefs(new SomeRefs(this.cache, playlistItems));\r\n                return;\r\n            }\r\n\r\n            let refs = await this.mopidyProxy.browse(lastCrumb.data.uri);\r\n            this.model.setCurrentRefs(new SomeRefs(this.cache, refs));\r\n            return;\r\n        }\r\n    }\r\n\r\n    private async setAllRefsAsCurrent() {\r\n        this.model.setCurrentRefs(await this.cache.getAllRefsCached());\r\n    }\r\n\r\n    async fetchStreamLines(streamUri: string) {\r\n        let stream_lines = await this.webProxy.fetchAllStreamLines(streamUri);\r\n        function groupLines (grouped: string[][], line: string) {\r\n            if(line == \"---\") {\r\n                grouped.push([]);\r\n                return grouped;\r\n            }\r\n            grouped[grouped.length-1].push(line);\r\n            return grouped;\r\n        }\r\n        return stream_lines\r\n            .reduce<string[][]>(groupLines, new Array([]))\r\n            .filter(lineGroup => lineGroup.length); // remove empty groups.\r\n    }\r\n\r\n    setView(view: Views) {\r\n        this.model.setView(view);\r\n    }\r\n\r\n    async addCurrentSearchResultsToPlayer() {\r\n        let results = this.model.getCurrentSearchResults();\r\n        await this.player.add(results.refs.map(r => r.item.uri as AllUris));\r\n    }\r\n\r\n    async createPlaylist(name: string) {\r\n        return this.mopidyProxy.createPlaylist(name)\r\n    }\r\n\r\n    async addRefToPlaylist(playlistUri: AllUris, itemUri: AllUris, refType: string, sequence: number) {\r\n        return this.webProxy.addRefToPlaylist(playlistUri, itemUri, refType, sequence);\r\n    }\r\n\r\n    showAlbum(albumUri: AlbumUri, selectedTrackUri: TrackUri | null) {\r\n        this.model.setAlbumToView(albumUri, selectedTrackUri);\r\n        this.model.setView(Views.Album);\r\n    }\r\n\r\n    async remember(s: string) {\r\n        let _status = await this.webProxy.remember(s);\r\n        this.model.setRemembers(null);\r\n    }\r\n\r\n    async startScan() {\r\n        await this.eboWsBackCtrl.send({method: \"start_scan\"}, \"fireAndForget\");\r\n    }\r\n\r\n    async deleteRemember(id: RememberId) {\r\n        await this.webProxy.deleteRemember(id);\r\n        this.model.setRemembers(null);\r\n    }\r\n\r\n    async browseToArtist(args: RefArgs) {\r\n        await this.clearBreadCrumbs();\r\n        await this.diveIntoBrowseResult(args.name, args.uri, args.type, false);\r\n        this.setView(Views.Browse);\r\n    }\r\n\r\n    async setRepeat(repeat: boolean) {\r\n        await this.mopidyProxy.setRepeat(repeat);\r\n    }\r\n\r\n    async setSingle(single: boolean) {\r\n        await this.mopidyProxy.setSingle(single);\r\n    }\r\n}\r\n","import {ComponentView} from \"./view\";\r\nimport {isInstanceOfExpandedStreamModel, isInstanceOfExpandedTrackModel, PlaybackUserOptions, Views} from \"../modelTypes\";\r\nimport {EboPlayerBar} from \"../components/eboPlayerBar\";\r\nimport {State} from \"../playerState\";\r\nimport {unreachable} from \"../global\";\r\n\r\nexport class PlayerBarView extends ComponentView<EboPlayerBar> {\r\n\r\n    constructor(state: State, component: EboPlayerBar) {\r\n        super(state, component);\r\n    }\r\n\r\n    bind() {\r\n        this.state.getModel().addEboEventListener(\"playbackStateChanged.eboplayer\", async () => {\r\n            await this.onPlaybackStateChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"currentTrackChanged.eboplayer\", async () => {\r\n            await this.onCurrentTrackChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"selectedTrackChanged.eboplayer\", async () => {\r\n            await this.onSelectedTrackChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"activeStreamLinesChanged.eboplayer\", () => {\r\n            this.onActiveStreamLinesChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"playbackModeChanged.eboplayer\", () => {\r\n            this.onPlaybackModeChanged();\r\n        });\r\n\r\n        this.component.addEboEventListener(\"playPressed.eboplayer\", async () => {\r\n            await this.state.getController().mopidyProxy.sendPlay();\r\n        });\r\n        this.component.addEboEventListener(\"stopPressed.eboplayer\", async () => {\r\n            await this.state.getController().mopidyProxy.sendStop();\r\n        });\r\n        this.component.addEboEventListener(\"pausePressed.eboplayer\", async () => {\r\n            await this.state.getController().mopidyProxy.sendPause();\r\n        });\r\n        this.component.addEboEventListener(\"buttonBarAlbumImgClicked.eboplayer\", () => {\r\n            this.onButtonBarImgClicked();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"volumeChanged.eboplayer\", () => {\r\n            this.onVolumeChanged();\r\n        });\r\n        this.component.addEboEventListener(\"changingVolume.eboplayer\", async (ev) => {\r\n            let value = ev.detail.volume;\r\n            await this.state.getController().mopidyProxy.sendVolume(value);\r\n        });\r\n        this.component.addEboEventListener(\"optionSelected.eboplayer\", async (ev) => {\r\n            await this.changeRepeat(ev.detail.selected);\r\n        });\r\n\r\n        this.state.getModel().addEboEventListener(\"viewChanged.eboplayer\", () => {\r\n            this.showHideInfo();\r\n        });\r\n    }\r\n\r\n    private onVolumeChanged() {\r\n        let volume = this.state.getModel().getVolume();\r\n        this.component.setAttribute(\"volume\", volume.toString());\r\n\r\n    }\r\n\r\n    private async onPlaybackStateChanged() {\r\n        let playState = this.state.getModel().getPlayState();\r\n        this.component.setAttribute(\"play_state\", playState);\r\n        await this.updateComponent();\r\n    }\r\n\r\n    private async onCurrentTrackChanged() {\r\n        await this.updateComponent();\r\n    }\r\n\r\n    private async onSelectedTrackChanged() {\r\n        await this.updateComponent();\r\n    }\r\n\r\n    private async updateComponent() {\r\n        let track = this.state.getModel().getCurrentTrack();\r\n        if (!track) {\r\n            this.component.setAttribute(\"text\", \"\");\r\n            this.component.setAttribute(\"allow_play\", \"false\");\r\n            this.component.setAttribute(\"allow_prev\", \"false\");\r\n            this.component.setAttribute(\"allow_next\", \"false\");\r\n            this.component.setAttribute(\"image_url\", \"\");\r\n            this.component.setAttribute(\"stop_or_pause\", \"stop\");\r\n        } else {\r\n            let trackModel = await this.state.getController().getExpandedTrackModel(track);\r\n            if (isInstanceOfExpandedStreamModel(trackModel)) {\r\n                let active_titles = \"\";\r\n                let activeStreamLines = this.state.getModel().getActiveStreamLines();\r\n                if (activeStreamLines)\r\n                    active_titles = activeStreamLines.active_titles.join(\"\\n\");\r\n                this.component.setAttribute(\"text\", active_titles);\r\n                this.component.setAttribute(\"allow_play\", \"true\");\r\n                this.component.setAttribute(\"allow_prev\", \"false\");\r\n                this.component.setAttribute(\"allow_next\", \"false\");\r\n                this.component.setAttribute(\"image_url\", trackModel.bigImageUrl);\r\n                this.component.setAttribute(\"stop_or_pause\", \"stop\");\r\n            } else if (isInstanceOfExpandedTrackModel(trackModel)) {\r\n                this.component.setAttribute(\"text\", trackModel.track.track.name?? \"--no name--\");\r\n                this.component.setAttribute(\"allow_play\", \"true\");\r\n                this.component.setAttribute(\"allow_prev\", \"false\");\r\n                this.component.setAttribute(\"allow_next\", \"false\");\r\n                this.component.setAttribute(\"image_url\", trackModel.bigImageUrl);\r\n                this.component.setAttribute(\"stop_or_pause\", \"pause\");\r\n            }\r\n        }\r\n        this.showHideInfo();\r\n    }\r\n\r\n    private showHideInfo() {\r\n        let currentTrack = this.state.getModel().getCurrentTrack();\r\n        let selectedTrack = this.state.getModel().getSelectedTrack();\r\n        let currentView = this.state.getModel().getView();\r\n        let show_info = false;\r\n        if(selectedTrack && currentTrack != selectedTrack)\r\n            show_info = true;\r\n        if(currentView != Views.NowPlaying)\r\n            show_info = true;\r\n        this.component.setAttribute(\"show_info\", show_info.toString());\r\n    }\r\n\r\n    private onButtonBarImgClicked() {\r\n        this.state.getController().setSelectedTrack(this.state.getModel().getCurrentTrack());\r\n        this.state.getController().setView(Views.NowPlaying);\r\n    }\r\n\r\n    private onActiveStreamLinesChanged() {\r\n        let lines = this.state.getModel().getActiveStreamLines();\r\n        this.component.setAttribute(\"text\", lines.active_titles.join(\"\\n\"));\r\n    }\r\n\r\n    private async changeRepeat(selected: PlaybackUserOptions | null) {\r\n        switch(selected) {\r\n            case \"repeat\":\r\n                await this.state.getController().setRepeat(true);\r\n                await this.state.getController().setSingle(false);\r\n                break;\r\n            case \"single\":\r\n                await this.state.getController().setRepeat(false);\r\n                await this.state.getController().setSingle(true);\r\n                break;\r\n            case \"repeatSingle\":\r\n                await this.state.getController().setRepeat(true);\r\n                await this.state.getController().setSingle(true);\r\n                break;\r\n            case null:\r\n            case \"justPlay\":\r\n                await this.state.getController().setRepeat(false);\r\n                await this.state.getController().setSingle(false);\r\n                break;\r\n            default:\r\n                unreachable(selected);\r\n        }\r\n    }\r\n\r\n    private onPlaybackModeChanged() {\r\n        let modes = this.state.getModel().getPlaybackMode();\r\n        let option: PlaybackUserOptions = \"justPlay\";\r\n        if(modes.repeat) {\r\n            if(modes.single)\r\n                option = \"repeatSingle\";\r\n            else\r\n                option = \"repeat\";\r\n        }\r\n        this.component.playMode = option;\r\n    }\r\n}\r\n","export class Batching {\r\n    constructor(private task: () => void) {\r\n    }\r\n    private requested = false;\r\n\r\n    async schedule() {\r\n        if(!this.requested) {\r\n            this.requested = true;\r\n            // noinspection ES6RedundantAwait\r\n            this.requested = await false;\r\n            this.execute();\r\n        }\r\n    }\r\n\r\n    private execute() {\r\n        this.task();\r\n    }\r\n}\r\n","import {Batching} from \"../Batching\";\r\nimport EboEventTarget, {createEvent, EboEventHandlersEventMap, EboplayerEvent} from \"../events\";\r\n\r\nexport interface HasName {\r\n    tagName: string;\r\n}\r\n\r\nexport abstract class EboComponent extends HTMLElement implements HasName, EboEventTarget {\r\n    get isRendered(): boolean {\r\n        return this._isRendered;\r\n    }\r\n    static globalCss: CSSStyleSheet[] = [];\r\n    static cssCache: Map<string, CSSStyleSheet> = new Map();\r\n    protected shadow: ShadowRoot;\r\n    protected styleTemplate?: HTMLTemplateElement;\r\n    protected divTemplate?: HTMLTemplateElement;\r\n    private connected = false;\r\n    private _isRendered = false;\r\n    private static readonly NO_TAG_NAME: string = \"todo: override in subclass\";\r\n    static tagName: string = EboComponent.NO_TAG_NAME;\r\n    private renderBatching: Batching;\r\n    private updateBatching: Batching;\r\n    protected cssNeeded: string[] = [];\r\n\r\n    protected constructor(styleText: string, htmlText: string) {\r\n        super();\r\n        if(styleText) {\r\n            this.styleTemplate = document.createElement(\"template\");\r\n            this.styleTemplate.innerHTML = styleText;\r\n        }\r\n        if(htmlText) {\r\n            this.divTemplate = document.createElement(\"template\");\r\n            this.divTemplate.innerHTML = htmlText;\r\n        }\r\n        this.renderBatching = new Batching(this.doRender.bind(this));\r\n        this.updateBatching = new Batching(this.doUpdate.bind(this));\r\n    }\r\n        // noinspection JSUnusedGlobalSymbols\r\n    attributeChangedCallback(name: string, oldValue: string, newValue: string) {\r\n        if(oldValue === newValue)\r\n            return;\r\n        this.attributeReallyChangedCallback(name, oldValue, newValue);\r\n    }\r\n\r\n    abstract attributeReallyChangedCallback(name: string, oldValue: string, newValue: string): void;\r\n\r\n    static setGlobalCss(text: string[]) {\r\n        this.globalCss = text.map(text => {\r\n            let css = new CSSStyleSheet();\r\n            css.replaceSync(text);\r\n            return css;\r\n        });\r\n    }\r\n\r\n    addEboEventListener<K extends keyof EboEventHandlersEventMap>(\r\n        type: K,\r\n        listener: (this: EboEventTarget, ev: EboplayerEvent<K, EboEventHandlersEventMap[K]>) => any, options?: boolean | AddEventListenerOptions): void {\r\n    // @ts-ignore\r\n        super.addEventListener(type, listener, options);\r\n    }\r\n\r\n    dispatchEboEvent<K extends keyof EboEventHandlersEventMap>(key: K, args: EboEventHandlersEventMap[K]): boolean {\r\n        return super.dispatchEvent(createEvent(key, args));\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    private connectedCallback() {\r\n        this.shadow = this.attachShadow({mode: \"open\"});\r\n        this.fetchCssAndCache().then( () => {\r\n            this.connected = true;\r\n            this.onConnected();\r\n            this.requestRender();\r\n        });\r\n    }\r\n\r\n    private async fetchCssAndCache() {\r\n        let fetches: Promise<string>[] = [];\r\n        this.cssNeeded.forEach(url => {\r\n            if (!EboComponent.cssCache.has(url)) {\r\n                fetches.push(fetch(url).then(res => res.text()));\r\n            }\r\n        });\r\n\r\n        const texts = await Promise.all(fetches);\r\n        texts.forEach((text, i) => {\r\n            let css = new CSSStyleSheet();\r\n            css.replaceSync(text);\r\n            EboComponent.cssCache.set(this.cssNeeded[i], css);\r\n        });\r\n    }\r\n\r\n    onConnected(){}\r\n\r\n    requestUpdate() {\r\n        // noinspection JSIgnoredPromiseFromCall\r\n        this.updateBatching.schedule();\r\n    }\r\n    private doUpdate() {\r\n        if (!this.connected)\r\n            return;\r\n        if (!this._isRendered)\r\n            return;\r\n        this.update(this.shadow);\r\n    }\r\n\r\n    update(shadow: ShadowRoot): void {\r\n        //should be overridden by subclasses.\r\n    }\r\n\r\n    requestRender() {\r\n        // noinspection JSIgnoredPromiseFromCall\r\n        this.renderBatching.schedule();\r\n    }\r\n    private doRender() {\r\n        if(!this.shadow)\r\n            return;\r\n        this.shadow.innerHTML = \"\";\r\n        let css = [...EboComponent.globalCss];\r\n        css = css.concat(this.cssNeeded.map(name => EboComponent.cssCache.get(name)!));\r\n        this.shadow.adoptedStyleSheets = css;\r\n        if(this.styleTemplate)\r\n            this.shadow.appendChild(this.styleTemplate.content.cloneNode(true));\r\n        if(this.divTemplate)\r\n            this.shadow.appendChild(this.divTemplate.content.cloneNode(true));\r\n\r\n        this.render(this.shadow);\r\n        this._isRendered = true;\r\n    }\r\n\r\n    render(shadow: ShadowRoot): void {\r\n        this.requestUpdate();\r\n    };\r\n\r\n    getShadow(){\r\n        return this.shadow;\r\n    }\r\n\r\n    setClassFromBoolAttribute(el: HTMLElement, attName: string) {\r\n        // @ts-ignore\r\n        if (this[attName] == true)\r\n            el.classList.add(attName);\r\n        else\r\n            el.classList.remove(attName);\r\n    }\r\n\r\n    setTextFromAttribute(attName: string) {\r\n        let el = this.shadow.getElementById(attName);\r\n        if(!el) {\r\n            console.warn(`Element with id \"${attName}\" not found.`);\r\n            return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        if (this[attName])\r\n            { // @ts-ignore\r\n                el.textContent = this[attName];\r\n            }\r\n        else\r\n            el.textContent = \"\";\r\n    }\r\n\r\n    protected updateStringProperty(name: string, newValue: string) {\r\n        // @ts-ignore\r\n        this[name] = newValue;\r\n\r\n    }\r\n    protected updateBoolProperty(name: string, newValue: string) {\r\n        if(newValue == null) {\r\n            // @ts-ignore\r\n            this[name] = false;\r\n            return;\r\n        }\r\n        if(newValue == \"\") {\r\n            // @ts-ignore\r\n            this[name] = true;\r\n            return;\r\n        }\r\n        if (![\"true\", \"false\"].includes(newValue))\r\n            throw `\"${name}\" attribute should be \"true\" or \"false\". Current value: \"${newValue}\"`;\r\n        // @ts-ignore\r\n        this[name] = newValue == \"true\";\r\n    }\r\n\r\n    static define(comp: new (...args: any[]) => EboComponent) {\r\n        // @ts-ignore\r\n        if((comp as typeof EboComponent).tagName == EboComponent.NO_TAG_NAME)\r\n            throw \"Component class should have tagName defined.\";\r\n        // @ts-ignore\r\n        customElements.define(comp.tagName, comp);\r\n    }\r\n\r\n    addShadowEventListener(id: string, type: string, listener: (this: HTMLElement, ev: MouseEvent) => any) {\r\n        this.shadow.getElementById(id)?.addEventListener(type, listener);\r\n    }\r\n}\r\n\r\n","import {EboComponent} from \"./EboComponent\";\r\n\r\nexport class EboProgressBar extends EboComponent {\r\n    static override readonly tagName=  \"ebo-progressbar\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"position\", \"min\", \"max\", \"button\", \"active\"];\r\n    private position: number = 51;\r\n    private min: number = 0;\r\n    private max: number = 100;\r\n    private active: boolean = false;\r\n    private button: boolean = true;\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n        .movingGradient {\r\n            background-color: #555;\r\n        }\r\n        .active .movingGradient {\r\n            --darkGradient: #555;\r\n            background: linear-gradient(to right, var(--darkGradient),\r\n            #2a84a5, var(--darkGradient), #ffffff,\r\n                var(--darkGradient), #ca497c, var(--darkGradient), #9e9c2d, var(--darkGradient), #ee7752, var(--darkGradient),\r\n                #2a84a5\r\n            );\r\n            background-size: 1100% 1100%;  /*Must be a multiple of the number of colors above for a smooth transistion and the last color must be the first*/\r\n            animation: gradient 15s forwards infinite linear;\r\n            animation-timing-function: linear;\r\n            animation-direction: normal;\r\n        }\r\n        .button #button {\r\n                background-color: white;\r\n                width: 3px; \r\n                display: inline-block;\r\n                box-shadow: 0 0 5px white, 0 0 5px white,  0 0 5px white, 0 0 5px white, 0 0 15px white;\r\n        }\r\n        @keyframes gradient {\r\n            0% {\r\n                background-position: 0% 50%;\r\n            }\r\n            100% {\r\n                background-position: 100% 50%;\r\n            }\r\n        }\r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <div style=\"\r\n            background-color: #444; \r\n            height: 1px; \r\n            display: flex; \r\n            \">\r\n            <div class=\"movingGradient\" style=\"\r\n                height: 1px;\r\n                display: inline-block;\">\r\n            </div>\r\n            <div id=\"button\"></div>\r\n        </div>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboProgressBar.styleText, EboProgressBar.htmlText);\r\n        this.requestRender();\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"position\":\r\n            case \"min\":\r\n            case \"max\":\r\n                let test = parseInt(newValue);\r\n                if (isNaN(test))\r\n                    throw `\"${name}\" attribute should be a number. Current value: \"${newValue}\"`;\r\n                this[name] = test;\r\n                break;\r\n            case \"active\":\r\n            case \"button\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        if(!(this.min <= this.position && this.position <= this.max))\r\n            throw `Attribute position=\"${this.position}\" should be between min=\"${this.min}\" and max=\"${this.max}\".`;\r\n        this.requestRender();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let percent = (this.position - this.min) / (this.max-this.min) * 100;\r\n        let styleElement = shadow.appendChild(document.createElement(\"style\"));\r\n        styleElement.innerHTML = `.movingGradient { width: ${percent}%; } `;\r\n        this.setClassFromBoolAttribute(shadow.firstElementChild as HTMLElement, \"button\");\r\n        this.setClassFromBoolAttribute(shadow.firstElementChild as HTMLElement, \"active\");\r\n    }\r\n\r\n}","import {View} from \"./view\";\r\nimport {TlId} from \"../../js/mopidy\";\r\nimport {HistoryLineDef, TrackUri} from \"../modelTypes\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class TimelineView extends View {\r\n    private clickedRow: HTMLTableRowElement;\r\n\r\n    constructor(state: State) {\r\n        super(state);\r\n    }\r\n\r\n    bind() {\r\n        this.state.getModel().addEboEventListener(\"historyChanged.eboplayer\", () => {\r\n            this.rebuildTimeline().then(r => {});\r\n        });\r\n        this.state.getModel().addEboEventListener(\"trackListChanged.eboplayer\", () => {\r\n            this.rebuildTimeline().then(r => {});\r\n        });\r\n        this.state.getModel().addEboEventListener(\"currentTrackChanged.eboplayer\", () => {\r\n            this.onCurrentTrackChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"selectedTrackChanged.eboplayer\", () => {\r\n            this.onSelectedTrackChanged();\r\n        });\r\n    }\r\n\r\n\r\n    private async rebuildTimeline() {\r\n        let history = this.state.getModel().getHistory() ?? [];\r\n        let trackList = this.state.getModel().getTrackList() ?? [];\r\n\r\n        let timelineTable = document.getElementById(\"timelineTable\") as HTMLTableElement;\r\n        let body = timelineTable.tBodies[0];\r\n        body.innerHTML = \"\";\r\n\r\n        if(history.length > 0 && trackList.length > 0 && history[0].uri == trackList[0].track.uri)\r\n            history.shift(); //remove most recent history line if it's the first track in the playlist.\r\n\r\n        // if we want to limit the number of history lines we can do so here.\r\n        // history = history.slice(0, 50);\r\n\r\n        //reverse order as we want the most recent tracks to at the bottom.\r\n        for(let i = history.length - 1; i >= 0; i-- ) {\r\n            this.insertHistoryLine(history[i], body);\r\n        }\r\n\r\n        for(let track of trackList) {\r\n            this.insertTrackLine(track.track.name??\"--no name--\", track.track.uri, body, [], track.tlid);\r\n        }\r\n\r\n        let uris = trackList.map(tl => tl.track.uri) as TrackUri[];\r\n        uris = [...new Set(uris)];\r\n\r\n        await this.setCurrentTrack();\r\n\r\n        body.querySelectorAll(\"tr\").forEach(tr => {\r\n            tr.addEventListener(\"dblclick\", ev => {this.onRowDoubleClicked(ev)});\r\n            tr.addEventListener(\"click\", ev => {this.onRowClicked(ev)});\r\n        });\r\n    }\r\n\r\n    private onRowClicked(ev: MouseEvent) {\r\n        let row = ev.currentTarget as HTMLTableRowElement;\r\n        this.setRowsClass(row, [\"clicked\"]);\r\n\r\n        this.state.getController().setSelectedTrack(row.dataset.uri as TrackUri);\r\n    }\r\n\r\n    private async onRowDoubleClicked(ev: MouseEvent) {\r\n        this.clickedRow = ev.currentTarget as HTMLTableRowElement;\r\n        if(this.clickedRow.dataset.tlid)\r\n            await this.state.getPlayer().play(parseInt(this.clickedRow.dataset.tlid) as TlId);\r\n        else\r\n            await this.state.getPlayer().clearAndPlay([this.clickedRow.dataset.uri as TrackUri]);\r\n    }\r\n\r\n    private setRowsClass(rowOrSelector: HTMLTableRowElement | string, classes: string[]) {\r\n        (document\r\n            .getElementById(\"timelineTable\") as HTMLTableElement)\r\n            .querySelectorAll(`tr`)\r\n            .forEach(tr =>\r\n                tr.classList.remove(...classes)\r\n            );\r\n        if(rowOrSelector instanceof HTMLTableRowElement)\r\n            rowOrSelector.classList.add(...classes);\r\n        else {\r\n            (document\r\n                .getElementById(\"timelineTable\") as HTMLTableElement)\r\n                .querySelectorAll(rowOrSelector)\r\n                .forEach(tr =>\r\n                    tr.classList.add(...classes)\r\n                );\r\n        }\r\n    }\r\n\r\n    private setSelectedTrack() {\r\n        let selectedTrackUri = this.state.getModel().getSelectedTrack();\r\n        this.setRowsClass(`tr[data-uri=\"${selectedTrackUri}\"]`, [\"selected\"]);\r\n    }\r\n\r\n    private async setCurrentTrack() {\r\n        let timelineTable = document.getElementById(\"timelineTable\") as HTMLTableElement;\r\n        let focusTrack = await this.state.getController().cache.lookupTrackCached(this.state.getModel().getCurrentTrack());\r\n        if(!focusTrack) {\r\n            focusTrack = await this.state.getController().cache.lookupTrackCached(this.state.getModel().getSelectedTrack());\r\n            if(!focusTrack)\r\n                return;\r\n        }\r\n        let currentUri = focusTrack.track.uri;\r\n        let trs = [...timelineTable.querySelectorAll(`tr[data-uri=\"${currentUri}\"]`)];\r\n        if(trs.length == 0)\r\n            return;\r\n        let tr = trs[trs.length - 1];\r\n        if(this.clickedRow?.dataset?.uri != focusTrack.track.uri)\r\n            tr.scrollIntoView( { block: \"nearest\" });\r\n        timelineTable.querySelectorAll(\"tr\").forEach(tr  => tr.classList.remove(\"current\", \"textGlow\"));\r\n        tr.classList.add(\"current\", \"textGlow\");\r\n    }\r\n\r\n    private insertHistoryLine(line: HistoryLineDef, body: HTMLTableSectionElement) {\r\n        this.insertTrackLine(line.name, line.uri, body, [\"historyLine\"], undefined, line.album, line.artist);\r\n    }\r\n\r\n    private insertTrackLine(title: string, uri: string, body: HTMLTableSectionElement, classes: string[] = [], tlid?: number, album?: string, artist?: string) {\r\n        let tr = document.createElement(\"tr\");\r\n        body.appendChild(tr);\r\n        tr.classList.add(\"trackLine\", ...classes);\r\n        if(!uri.startsWith(\"eboback\"))\r\n            tr.classList.add(\"italic\");\r\n        tr.dataset.uri = uri;\r\n        if(tlid)\r\n            tr.dataset.tlid = tlid.toString();\r\n        this.setTrackLineContent(tr, title, artist, album);\r\n        body.insertAdjacentHTML('beforeend', `\r\n<tr>\r\n    <td colspan=\"2\">\r\n        <div class=\"progressBar\"></div>\r\n    </td>\r\n</tr>\r\n            `);\r\n\r\n    }\r\n\r\n    private setTrackLineContent(tr: HTMLTableRowElement, title: string, artist: string = \"\", album: string = \"\") {\r\n        let artistStr = artist??\"\";\r\n        let albumStr = album??\"\";\r\n        tr.innerHTML = `\r\n    <td>\r\n        <h1>${title}</h1>\r\n        <small>${artistStr}  ${albumStr}</small>\r\n    </td>\r\n    <td>\r\n        <button><i class=\"fa fa fa-ellipsis-v\"></i></button>\r\n    </td>\r\n            `;\r\n    }\r\n\r\n    private onCurrentTrackChanged() {\r\n        this.setCurrentTrack();\r\n    }\r\n\r\n    private onSelectedTrackChanged() {\r\n        this.setSelectedTrack();\r\n    }\r\n\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {AlbumData, AlbumDataType, AlbumNone, ExpandedStreamModel} from \"../modelTypes\";\r\nimport {console_yellow} from \"../global\";\r\nimport {EboAlbumTracksComp} from \"./eboAlbumTracksComp\";\r\nimport {EboRadioDetailsComp} from \"./eboRadioDetailsComp\";\r\n\r\nclass EboBigTrackComp extends EboComponent {\r\n    get albumInfo(): AlbumData {\r\n        return this._albumInfo;\r\n    }\r\n\r\n    set albumInfo(value: AlbumData) {\r\n        this._albumInfo = value;\r\n        this.requestRender();\r\n    }\r\n\r\n    private _streamInfo: ExpandedStreamModel | null = null;\r\n    get streamInfo(): ExpandedStreamModel | null {\r\n        return this._streamInfo;\r\n    }\r\n    set streamInfo(value: ExpandedStreamModel | null) {\r\n        this._streamInfo = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    static override readonly tagName=  \"ebo-big-track-view\";\r\n    static progressBarAttributes = [\"position\", \"min\", \"max\", \"button\", \"active\"];\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\r\n        \"name\", \"stream_lines\", \"extra\", \"img\", \"disabled\", \"show_back\", \"program_title\",\r\n        ...EboBigTrackComp.progressBarAttributes\r\n    ];\r\n    private name: string = \"\";\r\n    private stream_lines: string = \"\";\r\n    private extra: string = \"\";\r\n    private enabled: boolean = false;\r\n    private show_back: boolean = false;\r\n    //for progressBar\r\n    private position: string = \"40\";\r\n    private min: string = \"0\";\r\n    private max: string = \"100\";\r\n    private button: string = \"false\";\r\n    private active: string = \"true\";\r\n    private program_title: string = \"\";\r\n\r\n    private img: string  = \"\";\r\n    private _albumInfo: AlbumData = AlbumNone;\r\n\r\n    static styleText= `\r\n            <style>\r\n                :host { \r\n                    display: flex;\r\n                } \r\n                h3 {\r\n                    margin-block-start: .5em;\r\n                    margin-block-end: .5em;\r\n                }\r\n                .albumCoverContainer {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    /*align-content: center;*/\r\n                    overflow: hidden;\r\n                }\r\n                img#bigImage {\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    object-fit: contain;\r\n                    min-width: 200px;\r\n                    min-height: 200px;\r\n                    background-image: radial-gradient(circle, rgba(255,255,255, .5) 0%, transparent 100%);\r\n                }\r\n                img#smallImage {\r\n                    width: 2.1rem;\r\n                    height: 2.1rem;\r\n                    object-fit: contain;\r\n                    margin-right: .5rem;\r\n                }\r\n                ebo-progressbar {\r\n                    margin-top: .5em;\r\n                }\r\n                #wrapper {\r\n                    display: flex;\r\n                    flex-direction: row;\r\n                    height: 100%;\r\n                    width: 100%;\r\n                    #front {\r\n                        display: flex;\r\n                        flex-direction: column;\r\n                        width: 100%;\r\n                        align-items: center;\r\n                    }\r\n                    #back {\r\n                        width: 100%;\r\n                        padding: 1rem;\r\n                    }\r\n                }\r\n                #wrapper.front {\r\n                    #back {\r\n                        display: none;\r\n                    }                \r\n                }\r\n                #wrapper.back {\r\n                    #front {\r\n                        position: absolute;\r\n                        display: none;\r\n                    }                \r\n                }\r\n                .info {\r\n                    font-size: .7em;\r\n                }\r\n                ebo-radio-details-view {\r\n                    height: 100%;\r\n                }\r\n                #albumTableWrapper {\r\n                    height: 100%;\r\n                    font-size: .8rem;\r\n                }\r\n            </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n            <div id=\"wrapper\" class=\"front\">\r\n                <div id=\"front\">\r\n                    <div class=\"albumCoverContainer\">\r\n                        <img id=\"bigImage\" style=\"visibility: hidden\" src=\"\" alt=\"Album cover\"/>\r\n                        <ebo-progressbar position=\"40\" active=\"false\" button=\"false\"></ebo-progressbar>\r\n                    </div>\r\n        \r\n                    <div id=\"info\">\r\n                        <h3 id=\"albumTitle\" class=\"selectable\"></h3>\r\n                        <h3 id=\"name\" class=\"selectable\"></h3>\r\n                        <div id=\"stream_lines\" class=\"selectable info\"></div>\r\n                        <div id=\"extra\" class=\"selectable info\"></div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"back\">\r\n                    <div id=\"header\" class=\"flexRow\">\r\n                        <img id=\"smallImage\" src=\"\" alt=\"Album image\">\r\n                        <span id=\"title\" class=\"selectable\"></span>\r\n                    </div>\r\n                    <div id=\"albumTableWrapper\">\r\n                        <ebo-radio-details-view img=\"images/default_cover.png\" ></ebo-radio-details-view>\r\n                    </div>\r\n                </div>\r\n            </div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboBigTrackComp.styleText, EboBigTrackComp.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        if(EboBigTrackComp.progressBarAttributes.includes(name)) {\r\n            this.updateStringProperty(name, newValue);\r\n            this.getShadow().querySelector(\"ebo-progressbar\")?.setAttribute(name, newValue);\r\n            return;\r\n        }\r\n        switch (name) {\r\n            case \"name\":\r\n            case \"stream_lines\":\r\n            case \"extra\":\r\n            case \"img\":\r\n            case \"program_title\":\r\n                this[name] = newValue;\r\n                break;\r\n            case \"enabled\":\r\n            case \"show_back\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        this.addShadowEventListener(\"bigImage\",\"click\", (ev) => {\r\n            this.dispatchEboEvent(\"bigTrackAlbumImgClicked.eboplayer\", {});\r\n        });\r\n        let smallImage = shadow.getElementById(\"smallImage\") as HTMLImageElement;\r\n        smallImage.addEventListener(\"click\", (ev) => {\r\n            this.dispatchEboEvent(\"bigTrackAlbumSmallImgClicked.eboplayer\", {});\r\n        });\r\n        this.requestUpdate();\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        [\"name\", \"stream_lines\", \"extra\"].forEach(attName => {\r\n            // @ts-ignore\r\n            shadow.getElementById(attName).innerHTML = this[attName];\r\n        });\r\n        if(this.program_title != \"\") {\r\n            // @ts-ignore\r\n            shadow.getElementById(\"name\").innerHTML = this.name + \" - \" + this.program_title;\r\n        }\r\n        let progressBarElement = shadow.querySelector(\"ebo-progressbar\") as HTMLElement;\r\n        EboBigTrackComp.progressBarAttributes.forEach(attName => {\r\n            // @ts-ignore\r\n            progressBarElement.setAttribute(attName, this[attName]);\r\n        });\r\n        let img = shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n        img.src = this.img;\r\n        this.switchFrontBackNoRender();\r\n        if(this.albumInfo.type == AlbumDataType.Loaded) {\r\n            // @ts-ignore\r\n            shadow.getElementById(\"albumTitle\").textContent = this.albumInfo.album.albumInfo.name;\r\n        }\r\n        let redioDetailsComp = shadow.querySelector(\"ebo-radio-details-view\") as EboRadioDetailsComp;\r\n        redioDetailsComp.streamInfo = this.streamInfo;\r\n        let smallImg = shadow.getElementById(\"smallImage\") as HTMLImageElement;\r\n        if(this.img != \"\") {\r\n            img.style.visibility = \"\";\r\n            smallImg.style.visibility = \"\";\r\n            img.src = this.img;\r\n            smallImg.src = this.img;\r\n        }\r\n        else {\r\n            img.style.visibility = \"hidden\";\r\n            smallImg.style.visibility = \"hidden\";\r\n        }\r\n        let title = shadow.getElementById(\"title\") as HTMLElement;\r\n        title.textContent = this.name;\r\n    }\r\n\r\n    private switchFrontBackNoRender() {\r\n        let wrapper = this.shadow.getElementById(\"wrapper\") as HTMLElement;\r\n        wrapper.classList.remove(\"front\", \"back\");\r\n        if (this.show_back)\r\n            wrapper.classList.add(\"back\");\r\n        else\r\n            wrapper.classList.add(\"front\");\r\n    }\r\n\r\n}\r\n\r\nexport default EboBigTrackComp","import {View} from \"./view\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class ComponentViewAdapter extends View {\r\n    protected componentId: string;\r\n\r\n    constructor(state: State, id: string) {\r\n        super(state);\r\n        this.componentId = id;\r\n    }\r\n\r\n    bind(): void {\r\n    }\r\n}","import {ComponentViewAdapter} from \"./componentViewAdapter\";\r\nimport {ExpandedFileTrackModel, ExpandedStreamModel, isInstanceOfExpandedStreamModel, StreamUri, TrackUri} from \"../modelTypes\";\r\nimport EboBigTrackComp from \"../components/eboBigTrackComp\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class BigTrackViewCurrentOrSelectedAdapter extends ComponentViewAdapter {\r\n    private streamLines: string;\r\n    private programTitle: string = \"\";\r\n    private uri: string | null = null;\r\n    private track: ExpandedStreamModel | ExpandedFileTrackModel | null;\r\n\r\n    constructor(state: State, id: string) {\r\n        super(state, id);\r\n    }\r\n\r\n    override bind() {\r\n        super.bind();\r\n        this.state.getModel().addEboEventListener(\"currentTrackChanged.eboplayer\", async () => {\r\n            await this.onCurrentOrSelectedChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"selectedTrackChanged.eboplayer\", async () => {\r\n            await this.onCurrentOrSelectedChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"activeStreamLinesChanged.eboplayer\", (ev) => {\r\n            this.onStreamLinesChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"programTitleChanged.eboplayer\", (ev) => {\r\n            this.onProgramTitleChanged();\r\n        });\r\n    }\r\n\r\n    private async onCurrentOrSelectedChanged() {\r\n        let currentTrackUri = this.state.getModel().getCurrentTrack();\r\n        let selectedTrackUri = this.state.getModel().getSelectedTrack();\r\n        await this.setUri(selectedTrackUri ?? currentTrackUri);\r\n    }\r\n\r\n    protected onStreamLinesChanged() {\r\n        let selectedTrackUri = this.state.getModel().getSelectedTrack();\r\n        let currentTrackUri = this.state.getModel().getCurrentTrack();\r\n        this.streamLines = \"\";\r\n        if(selectedTrackUri == currentTrackUri) {\r\n            let linesObject = this.state.getModel().getActiveStreamLines();\r\n            if (this.uri && linesObject?.uri == this.uri)\r\n                this.streamLines = linesObject.active_titles?.join(\"<br/>\") ?? \"\";\r\n        }\r\n        // @ts-ignore\r\n        document.getElementById(this.componentId).setAttribute(\"stream_lines\", this.streamLines);\r\n    }\r\n\r\n    async setUri(uri: TrackUri | StreamUri | null) {\r\n        this.uri = uri;\r\n        this.track = await this.state.getController().getExpandedTrackModel(uri);\r\n        this.setComponentData();\r\n    }\r\n\r\n    protected setComponentData() {\r\n        let name = \"no current track\";\r\n        let info = \"\";\r\n        let position: string;\r\n        let button: string;\r\n        let imageUrl: string;\r\n        if(!this.track) {\r\n            name = \"no current track\";\r\n            info = \"\";\r\n            position = \"0\";\r\n            button = \"false\";\r\n            imageUrl = \"\";\r\n        } else {\r\n            if (isInstanceOfExpandedStreamModel(this.track)) {\r\n                name = this.track.stream.name;\r\n                position = \"100\";\r\n                button = \"false\";\r\n                imageUrl = this.track.bigImageUrl;\r\n            } else {\r\n                name = this.track.track.title;\r\n                info = this.track.album?.albumInfo?.name?? \"--no name--\";\r\n                position = \"60\"; //todo: just a test\r\n                button = \"true\";\r\n                imageUrl = this.track.bigImageUrl;\r\n                let artists = this.track.track.track.artists.map(a => a.name).join(\", \");\r\n                let composers = this.track.track.track.composers?.map(c => c.name)?.join(\", \") ?? \"\";\r\n                if (artists)\r\n                    info += \"<br>\" + artists;\r\n                if (composers)\r\n                    info += \"<br>\" + composers;\r\n            }\r\n        }\r\n        let comp = document.getElementById(this.componentId) as EboBigTrackComp;\r\n        comp.setAttribute(\"name\", name);\r\n        comp.setAttribute(\"info\", info);\r\n        comp.setAttribute(\"position\", position);\r\n        comp.setAttribute(\"button\", button);\r\n        comp.setAttribute(\"img\", imageUrl);\r\n        comp.setAttribute(\"program_title\", this.programTitle);\r\n        this.onStreamLinesChanged();\r\n    }\r\n\r\n    private onProgramTitleChanged() {\r\n        this.programTitle = this.state.getModel().getCurrentProgramTitle();\r\n        this.setComponentData();\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {ExpandedAlbumModel, ExpandedStreamModel, TrackUri} from \"../modelTypes\";\r\nimport {EboMenuButton} from \"./eboMenuButton\";\r\n\r\nexport class EboAlbumTracksComp extends EboComponent {\r\n    get selected_track_uris(): TrackUri[] {\r\n        return this._selected_track_uris;\r\n    }\r\n\r\n    set selected_track_uris(value: TrackUri[]) {\r\n        this._selected_track_uris = value;\r\n        this.requestUpdate();\r\n    }\r\n    static override readonly tagName=  \"ebo-album-tracks-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"img\"];\r\n\r\n    set activeTrackUri(value: string | null) {\r\n        this._activeTrackUri = value;\r\n        this.highLightActiveTrack();\r\n    }\r\n    get albumInfo(): ExpandedAlbumModel | null {\r\n        return this._albumInfo;\r\n    }\r\n\r\n    set albumInfo(value: ExpandedAlbumModel | null) {\r\n        if(value != this._albumInfo) {\r\n            this._albumInfo = value;\r\n            this.requestRender();\r\n        }\r\n    }\r\n\r\n    private _activeTrackUri: string | null = null;\r\n    private _albumInfo: ExpandedAlbumModel | null = null;\r\n    private _selected_track_uris: TrackUri[] = [];\r\n\r\n    constructor() {\r\n        super(EboAlbumTracksComp.styleText, EboAlbumTracksComp.htmlText);\r\n\r\n        this.albumInfo = null;\r\n        this.requestRender();\r\n    }\r\n\r\n    static styleText = `\r\n            <style>\r\n                :host { \r\n                    display: flex;\r\n                    text-align: start;\r\n                } \r\n                #wrapper {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    height: 100%;\r\n                    width: 100%;\r\n                }\r\n                .info {\r\n                    font-size: .7em;\r\n                }\r\n                #tableScroller {\r\n                    overflow: scroll;\r\n                    scrollbar-width: none;\r\n                    height: 100%;    \r\n                }\r\n                #tracksTable {\r\n                    width: 100%;\r\n                    border-collapse: collapse;\r\n                    tr {\r\n                        border-bottom: 1px solid #ffffff80;\r\n                    }\r\n                }\r\n                .selected {\r\n                    background-color: var(--selected-background);\r\n                }\r\n            </style>\r\n        `;\r\n        static htmlText = `\r\n            <div id=\"wrapper\">\r\n                <div id=\"tableScroller\">\r\n                    <table id=\"tracksTable\">\r\n                        <tbody>\r\n                        </tbody>                \r\n                    </table>\r\n                </div>          \r\n            </div>\r\n            <dialog popover id=\"albumTrackPopup\">\r\n              Tadaaa....\r\n            </dialog>        \r\n        `;\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override async render(shadow:ShadowRoot) {\r\n        let tbody = (shadow.getElementById(\"tracksTable\") as HTMLTableElement).tBodies[0];\r\n        tbody.innerHTML  = \"\";\r\n        if(this.albumInfo) {\r\n            (await this.albumInfo.getTrackModels()).forEach(track => {\r\n                let tr = tbody.appendChild(document.createElement(\"tr\"));\r\n                let tdData = tr.appendChild(document.createElement(\"td\"));\r\n                tr.dataset.uri = track.track.uri;\r\n                tdData.innerText = track.track.name?? \"--no name--\";\r\n                let tdButton = tr.appendChild(document.createElement(\"td\"));\r\n                tdButton.innerHTML = `\r\n                    <ebo-menu-button >\r\n                        <div class=\"flexColumn\">\r\n                            <button id=\"\" class=\"roundBorder trackButton\">Set genre</button>\r\n                            <button id=\"\" class=\"roundBorder trackButton\">Add to playlist</button>\r\n                            <button id=\"\" class=\"roundBorder trackButton\">Rename</button>\r\n                            <button id=\"\" class=\"roundBorder trackButton\">Artist ></button>\r\n                            <button id=\"\" class=\"roundBorder trackButton\">Album ></button>\r\n                            <div class=\"flexRow\">\r\n                                <button id=\"addTrack\" class=\"roundBorder trackButton\">\r\n                                    <i class=\"fa fa-plus\"></i>\r\n                                </button>\r\n                                <button id=\"playTrack\" class=\"roundBorder trackButton\">\r\n                                    <i class=\"fa fa-play\"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>  \r\n                    </ebo-menu-button>`;\r\n                tdButton.querySelector(\"#addTrack\")?.addEventListener(\"click\", (ev) => {\r\n                    let menuButton = ev.target as HTMLElement;\r\n                    let button = menuButton.closest(\"ebo-menu-button\") as EboMenuButton;\r\n                    button.closeMenu();\r\n                    this.dispatchEboEvent(\"addTrackClicked.eboplayer\", {uri: track.track.uri as TrackUri});\r\n                });\r\n                tdButton.querySelector(\"#playTrack\")?.addEventListener(\"click\", (ev) => {\r\n                    let menuButton = ev.target as HTMLElement;\r\n                    let button = menuButton.closest(\"ebo-menu-button\") as EboMenuButton;\r\n                    button.closeMenu();\r\n                    this.dispatchEboEvent(\"playTrackClicked.eboplayer\", {uri: track.track.uri as TrackUri});\r\n                });\r\n                tr.addEventListener(\"click\", (ev) => {\r\n                    tr.classList.toggle(\"selected\");\r\n                    this.dispatchEboEvent(\"trackClicked.eboplayer\", {uri: tr.dataset.uri as TrackUri});\r\n                })\r\n            });\r\n        }\r\n        this.highLightActiveTrack();\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private highLightActiveTrack() {\r\n        if(!this._activeTrackUri)\r\n            return;\r\n        let tr = this.getShadow().querySelector(`tr[data-uri=\"${this._activeTrackUri}\"]`) as HTMLTableRowElement;\r\n        if(tr) {\r\n            tr.classList.add(\"current\", \"textGlow\");\r\n        }\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        shadow.querySelectorAll(\"tr\").forEach(tr => {\r\n            if(this._selected_track_uris.includes(tr.dataset.uri as TrackUri)) {\r\n                tr.classList.add(\"selected\");\r\n            } else\r\n                tr.classList.remove(\"selected\");\r\n        });\r\n    }\r\n\r\n    private getSelectedUris() {\r\n        return [...this.getShadow().querySelectorAll(\"tr.selected\") as NodeListOf<HTMLTableRowElement>]\r\n            .map((tr) => {\r\n                return tr.dataset.uri;\r\n            })\r\n            .filter((uri: string) => uri != null && uri != \"\" && uri != undefined) as TrackUri[];\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {GuiSource} from \"../events\";\r\nimport {AllUris} from \"../modelTypes\";\r\nimport {EboButton} from \"./eboButton\";\r\n\r\nexport type ListButtonState = \"show\" | \"hide\" | \"disabled\";\r\nexport type ListButtonStates = {\r\n    add: ListButtonState;\r\n    play: ListButtonState;\r\n    edit: ListButtonState;\r\n    replace: ListButtonState;\r\n    save: ListButtonState;\r\n    new_playlist: ListButtonState;\r\n    line_or_icon: ListButtonState;\r\n}\r\nexport type ListButtonName = keyof ListButtonStates;\r\nexport function ListButtonState_AllHidden(): ListButtonStates {\r\n    return {\r\n        add: \"hide\",\r\n            play: \"hide\",\r\n        edit: \"hide\",\r\n        replace: \"hide\",\r\n        save: \"hide\",\r\n        new_playlist: \"hide\",\r\n        line_or_icon: \"hide\"\r\n    };\r\n}\r\n\r\nexport class EboListButtonBar extends EboComponent {\r\n    get btn_states(): ListButtonStates {\r\n        return this._btn_states;\r\n    }\r\n\r\n    set btn_states(value: ListButtonStates) {\r\n        this._btn_states = value;\r\n        this.requestUpdate();\r\n    }\r\n    static override readonly tagName=  \"ebo-list-button-bar\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"list_source\", \"uri\", \"use_selected_color\"];\r\n    private _btn_states: ListButtonStates = ListButtonState_AllHidden();\r\n    list_source: GuiSource;\r\n    uri: string;\r\n    use_selected_color: boolean = false;\r\n    static styleText = `\r\n        <style>\r\n            #buttons {\r\n                display: flex;\r\n                flex-direction: row;\r\n                margin-bottom: .5em;\r\n                button.disabled {\r\n                    opacity: 0.2;\r\n                }\r\n                button.playButton {\r\n                    background-color: var(--playing-background);\r\n                    border: none;\r\n                }\r\n                img {\r\n                    height: 1.2rem;\r\n                }\r\n                ebo-button {\r\n                    height: 1.2rem;\r\n                    width: 1.4rem;\r\n                    position: relative;\r\n                    top: .4rem;\r\n                    margin-inline-start: .5rem;\r\n                }\r\n                button.selected {\r\n                    background-color: var(--selected-background);\r\n                }\r\n            }\r\n        </style>\r\n    `;\r\n    static htmlText = `\r\n        <div id=\"buttons\">\r\n            <button id=\"btnPlay\" class=\"roundBorder playButton iconButton\"><i class=\"fa fa-play\"></i></button>\r\n            <button id=\"btnAdd\" class=\"roundBorder playButton iconButton\"><i class=\"fa fa-plus\"></i></button>\r\n            <button id=\"btnReplace\" class=\"roundBorder playButton\">Replace</button>\r\n            <button id=\"btnEdit\" class=\"roundBorder\"><i class=\"fa fa-pencil\"></i></button>\r\n            <button id=\"btnSave\" class=\"roundBorder\">\r\n                <div class=\"flexRow\">\r\n                    >            \r\n                    <img id=\"bigImage\" src=\"images/icons/Playlist.svg\" alt=\"New playlist\" class=\"whiteIcon\">\r\n                </div>            \r\n            </button>\r\n            <button id=\"btnNewPlaylist\" class=\"roundBorder\">\r\n                <div class=\"flexRow\">\r\n                    <img id=\"bigImage\" src=\"images/icons/Playlist.svg\" alt=\"New playlist\" class=\"whiteIcon\">\r\n                    *            \r\n                </div>            \r\n            </button>\r\n            <ebo-button toggle id=\"btnDisplayMode\" img=\"images/icons/IconView.svg\" class=\"whiteIcon\"></ebo-button>\r\n        </div>                   \r\n    `;\r\n\r\n    constructor() {\r\n        super(EboListButtonBar.styleText, EboListButtonBar.htmlText);\r\n    }\r\n\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"list_source\":\r\n                this.list_source = newValue as GuiSource;\r\n                break;\r\n            case \"uri\":\r\n                this[name] = newValue;\r\n                break;\r\n            case \"use_selected_color\":\r\n                this.updateBoolProperty(name, newValue);\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        this.addShadowEventListener(\"btnPlay\", \"click\", () => {\r\n            if(this.btn_states.play != \"show\") return;\r\n            this.dispatchEboEvent(\"playItemListClicked.eboplayer\", {source: this.list_source});\r\n        });\r\n        this.addShadowEventListener(\"btnAdd\", \"click\", () => {\r\n            if(this.btn_states.add != \"show\") return;\r\n            this.dispatchEboEvent(\"addItemListClicked.eboplayer\", {source: this.list_source});\r\n        });\r\n        this.addShadowEventListener(\"btnReplace\", \"click\", () => {\r\n            if(this.btn_states.replace != \"show\") return;\r\n            this.dispatchEboEvent(\"replaceItemListClicked.eboplayer\", {source: this.list_source});\r\n        });\r\n        this.addShadowEventListener(\"btnEdit\", \"click\", () => {\r\n            if(this.btn_states.edit != \"show\") return;\r\n            this.dispatchEboEvent(\"editClicked.eboplayer\", {source: this.list_source});\r\n        });\r\n        this.addShadowEventListener(\"btnSave\", \"click\", () => {\r\n            if(this.btn_states.save != \"show\") return;\r\n            this.dispatchEboEvent(\"saveClicked.eboplayer\", {source: this.list_source, uri: this.uri as AllUris});\r\n        });\r\n        this.addShadowEventListener(\"btnNewPlaylist\", \"click\", () => {\r\n            if(this.btn_states.new_playlist != \"show\") return;\r\n            this.dispatchEboEvent(\"newPlaylistClicked.eboplayer\", {source: this.list_source});\r\n        });\r\n        let btnDisplayMode = this.shadow.getElementById(\"btnDisplayMode\") as EboButton;\r\n        btnDisplayMode.addEboEventListener(\"pressedChange.eboplayer\", (ev) => {\r\n           this.dispatchEboEvent(\"displayModeChanged.eboplayer\", {mode: ev.detail.pressed ? \"icon\" : \"line\"});\r\n        });\r\n        this.requestUpdate();\r\n    }\r\n\r\n    override update(shadow: ShadowRoot) {\r\n        this.updateButtonVisibility(\"btnPlay\", this._btn_states.play);\r\n        this.updateButtonVisibility(\"btnAdd\", this._btn_states.add);\r\n        this.updateButtonVisibility(\"btnReplace\", this._btn_states.replace);\r\n        this.updateButtonVisibility(\"btnEdit\", this._btn_states.edit);\r\n        this.updateButtonVisibility(\"btnSave\", this._btn_states.save);\r\n        this.updateButtonVisibility(\"btnNewPlaylist\", this._btn_states.new_playlist);\r\n        this.updateButtonVisibility(\"btnDisplayMode\", this._btn_states.line_or_icon);\r\n        let playButtons = shadow.querySelectorAll(\"button.playButton\");\r\n        playButtons.forEach(button => {\r\n            button.classList.toggle(\"selected\", this.use_selected_color);\r\n        });\r\n    }\r\n\r\n    private updateButtonVisibility(id: string, state: ListButtonState) {\r\n        let btn = this.shadow.getElementById(id) as HTMLButtonElement;\r\n        switch (state) {\r\n            case \"show\": btn.style.display = \"\"; break;\r\n            case \"hide\": btn.style.display = \"none\"; break;\r\n            case \"disabled\":\r\n                btn.disabled = true;\r\n                btn.classList.add(\"disabled\");\r\n                break;\r\n            default:\r\n                break;//no state specified: ignore\r\n        }\r\n    }\r\n}","import {View} from \"./view\";\r\nimport {ExpandedStreamModel, isInstanceOfExpandedStreamModel, isInstanceOfExpandedTrackModel, TrackUri, Views} from \"../modelTypes\";\r\nimport {EboBigAlbumComp} from \"../components/eboBigAlbumComp\";\r\nimport {EboBrowseComp} from \"../components/eboBrowseComp\";\r\nimport {unreachable} from \"../global\";\r\nimport {ListButtonState, ListButtonState_AllHidden, ListButtonStates} from \"../components/eboListButtonBar\";\r\nimport EboBigTrackComp from \"../components/eboBigTrackComp\";\r\nimport {EboSettingsComp} from \"../components/eboSettingsComp\";\r\nimport {BrowseView} from \"./browseView\";\r\nimport {DisplayMode} from \"../components/eboListItemComp\";\r\nimport {AlbumView} from \"./albumView\";\r\nimport {State} from \"../playerState\";\r\nimport {addEboEventListener} from \"../events\";\r\nimport {EboGenresComp} from \"../components/eboGenresComp\";\r\n\r\nexport class MainView extends View {\r\n    private browseView: BrowseView;\r\n    private albumView: AlbumView;\r\n\r\n    constructor(state: State, browseView: BrowseView, albumView: AlbumView) {\r\n        super(state);\r\n        this.browseView = browseView;\r\n        this.albumView = albumView;\r\n    }\r\n\r\n    bind() {\r\n        this.browseView.bind();\r\n        this.albumView.bind();\r\n        document.getElementById(\"headerSearchBtn\")?.addEventListener(\"click\", () => {\r\n            this.onBrowseButtonClick();\r\n        });\r\n        document.getElementById(\"settingsBtn\")?.addEventListener(\"click\", async () => {\r\n            await this.onSettingsButtonClick();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"selectedTrackChanged.eboplayer\", async () => {\r\n            await this.onSelectedTrackChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"trackListChanged.eboplayer\", async () => {\r\n            await this.onTrackListChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"viewChanged.eboplayer\", async () => {\r\n            await this.setCurrentView();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"albumToViewChanged.eboplayer\", async () => {\r\n            await this.onAlbumToViewChanged();\r\n        });\r\n        let currentTrackBigViewComp = document.getElementById(\"currentTrackBigView\") as EboBrowseComp;\r\n        currentTrackBigViewComp.addEboEventListener(\"bigTrackAlbumImgClicked.eboplayer\", async () => {\r\n            await this.onBigTrackAlbumImgClick();\r\n        });\r\n        currentTrackBigViewComp.addEboEventListener(\"bigTrackAlbumSmallImgClicked.eboplayer\", async () => {\r\n            currentTrackBigViewComp.setAttribute(\"show_back\", \"false\");\r\n        });\r\n        currentTrackBigViewComp.addEboEventListener(\"rememberStreamLines.eboplayer\", async (ev) => {\r\n            await this.rememberStreamLines(ev.detail.lines);\r\n        });\r\n\r\n        this.state.getModel().addEboEventListener(\"scanStatusChanged.eboplayer\", (ev) => {\r\n            let settingsComp = document.getElementById(\"settingsView\") as EboSettingsComp;\r\n            settingsComp.scanStatus = ev.detail.text;\r\n        });\r\n        this.state.getModel().addEboEventListener(\"scanFinished.eboplayer\", () => {\r\n            let settingsComp = document.getElementById(\"settingsView\") as EboSettingsComp;\r\n            settingsComp.setAttribute(\"show_whats_new\", \"\");\r\n        });\r\n        let settingsComp = document.getElementById(\"settingsView\") as EboSettingsComp;\r\n        settingsComp.addEboEventListener(\"scanRequested.eboplayer\", async () => {\r\n            await this.state.getController().startScan();\r\n        });\r\n        settingsComp.addEboEventListener(\"whatsNewRequested.eboplayer\", () => {\r\n            window.location.hash = \"#WhatsNew\";\r\n            window.location.reload();\r\n        });\r\n\r\n        let layout = document.getElementById(\"layout\") as HTMLElement;\r\n        addEboEventListener(layout, \"rememberedRequested.eboplayer\", () => {\r\n            this.state.getController().setView(Views.Remembered);\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private getListButtonStates(currentView: Views) {\r\n        let states: ListButtonStates = ListButtonState_AllHidden();\r\n        if(currentView == Views.Album) {\r\n            states = this.showHideTrackAndAlbumButtons(states, \"show\");\r\n            states.new_playlist = \"hide\";\r\n            states.edit = \"hide\";\r\n            states.line_or_icon = \"hide\";\r\n            return states;\r\n        }\r\n        return states;\r\n    }\r\n\r\n    private showHideTrackAndAlbumButtons(states: ListButtonStates, state: ListButtonState): ListButtonStates {\r\n        states.add = state;\r\n        states.replace = state;\r\n        states.play = state;\r\n        states.save = state;\r\n        states.edit = state;\r\n        return states;\r\n    }\r\n\r\n    private onBrowseButtonClick() {\r\n        let browseBtn = document.getElementById(\"headerSearchBtn\") as HTMLButtonElement;\r\n        switch (browseBtn.dataset.goto) {\r\n            case Views.Browse:\r\n                this.state.getController().setView(Views.Browse);\r\n                break;\r\n            case Views.NowPlaying:\r\n                this.state.getController().setView(Views.NowPlaying);\r\n                break;\r\n            case Views.Album:\r\n                this.state.getController().setView(Views.Album);\r\n                break;\r\n        }\r\n    }\r\n\r\n    async setCurrentView() {\r\n        let view = this.state.getModel().getView();\r\n        await this.showView(view);\r\n    }\r\n\r\n    private hashToViewId(hash: Views): string {\r\n        switch (hash) {\r\n            case Views.NowPlaying:\r\n                return \"currentTrackBigView\";\r\n            case Views.Browse:\r\n                return \"browseView\";\r\n            case Views.WhatsNew:\r\n                return \"browseView\"; //note this one!\r\n            case Views.Remembered:\r\n                return \"rememberedView\";\r\n            case Views.Album:\r\n                return \"bigAlbumView\";\r\n            case Views.Settings:\r\n                return \"settingsView\";\r\n            case Views.Genres:\r\n                return \"genresView\"\r\n            default:\r\n                return unreachable(hash);\r\n        }\r\n    }\r\n\r\n    private async showView(view: Views) {\r\n        let fullViews = document.querySelectorAll(\".fullView\");\r\n        fullViews.forEach(v => v.classList.remove(\"shownView\"));\r\n        let currentView = document.getElementById(this.hashToViewId(view)) as HTMLElement;\r\n        currentView.classList.add(\"shownView\");\r\n        let browseBtn = document.getElementById(\"headerSearchBtn\") as HTMLButtonElement;\r\n        let layout = document.getElementById(\"layout\") as HTMLElement;\r\n        let prevViewClass = [...layout.classList].filter(c => [\"browse\", \"bigAlbum\", \"bigTrack\"].includes(c))[0];\r\n        let resultsDisplayMode: DisplayMode = \"line\"; //todo: get from model.\r\n        layout.classList.remove(\"showFullView\");\r\n        switch (view) {\r\n            case Views.WhatsNew:\r\n                await this.state.getController().setWhatsNewFilter();\r\n                resultsDisplayMode = \"icon\";\r\n                layout.classList.add(\"showFullView\");\r\n                //fall through\r\n            case Views.Browse:\r\n                location.hash = view;\r\n                browseBtn.dataset.goto = Views.NowPlaying;\r\n                browseBtn.title = \"Now playing\";\r\n                this.browseView.updateCompFromState(resultsDisplayMode);\r\n                layout.classList.add(\"showFullView\");\r\n                break;\r\n            case Views.NowPlaying:\r\n                location.hash = \"\"; //default = now playing\r\n                browseBtn.dataset.goto = Views.Browse;\r\n                browseBtn.title = \"Search\";\r\n                break;\r\n            case Views.Album:\r\n                location.hash = Views.Album;\r\n                if(prevViewClass == \"browse\") { //Provide some navigation back.\r\n                    browseBtn.dataset.goto = Views.Browse;\r\n                    browseBtn.title = \"Search\";\r\n                } else {\r\n                    browseBtn.dataset.goto = Views.NowPlaying;\r\n                    browseBtn.title = \"Now playing\";\r\n                }\r\n                let albumComp = document.getElementById(\"bigAlbumView\") as EboBigAlbumComp;\r\n                albumComp.btn_states = this.getListButtonStates(view);\r\n                layout.classList.add(\"showFullView\");\r\n                break;\r\n            case Views.Settings:\r\n                location.hash = Views.Settings;\r\n                browseBtn.dataset.goto = Views.NowPlaying;\r\n                browseBtn.title = \"Now playing\";\r\n                layout.classList.add(\"showFullView\");\r\n                break;\r\n            case Views.Remembered:\r\n                location.hash = Views.Remembered;\r\n                browseBtn.dataset.goto = Views.NowPlaying;\r\n                browseBtn.title = \"Now playing\";\r\n                layout.classList.add(\"showFullView\");\r\n                break;\r\n            case Views.Genres:\r\n                location.hash = Views.Genres;\r\n                browseBtn.dataset.goto = Views.NowPlaying;\r\n                browseBtn.title = \"Now playing\";\r\n                layout.classList.add(\"showFullView\");\r\n                break;\r\n            default:\r\n                return unreachable(view);\r\n        }\r\n    }\r\n\r\n    private async onBigTrackAlbumImgClick() {\r\n        let selectedTrack = this.state.getModel().getSelectedTrack();\r\n        if (!selectedTrack) return;\r\n        let expandedTrackInfo = await this.state.getController().getExpandedTrackModel(selectedTrack);\r\n        if (!expandedTrackInfo) return;\r\n        if (isInstanceOfExpandedTrackModel(expandedTrackInfo)) {\r\n            if(expandedTrackInfo.album?.albumInfo)\r\n                this.state.getController().showAlbum(expandedTrackInfo.album.albumInfo.uri, expandedTrackInfo.track.track.uri as TrackUri); //Shouldn't be a Stream.\r\n            //todo: else?\r\n            return;\r\n        }\r\n        if(isInstanceOfExpandedStreamModel(expandedTrackInfo)) {\r\n            let bigTrackView = document.getElementById(\"currentTrackBigView\") as EboBigTrackComp;\r\n            bigTrackView.setAttribute(\"show_back\", \"true\");\r\n        }\r\n    }\r\n\r\n    private async onTrackListChanged() {\r\n        if(!this.state.getModel().getCurrentTrack()) {\r\n            let trackList = this.state.getModel().getTrackList();\r\n            if(trackList.length > 0)\r\n                await this.state.getController().setCurrentTrackAndFetchDetails(trackList[0]);\r\n        }\r\n    }\r\n\r\n    private async onSelectedTrackChanged() {\r\n        let uri = this.state.getModel().getSelectedTrack();\r\n        this.state.getController().cache.lookupTrackCached(uri)\r\n            .then(async track => {\r\n                if(track?.type == \"file\") {\r\n                    if(track.track.album) {\r\n                        let albumModel = await this.state.getController().getExpandedAlbumModel(track.track.album.uri);\r\n                        this.albumView.setAlbumComponentData(albumModel, track.track.uri as TrackUri); //Shoudln't be a Stream.\r\n                    }\r\n                    //todo: else?\r\n                }\r\n                else if(track?.type == \"stream\") {\r\n                    let albumComp = document.getElementById(\"bigAlbumView\") as EboBigAlbumComp;\r\n                    let streamModel = await this.state.getController().getExpandedTrackModel(track.track.uri) as ExpandedStreamModel;\r\n                    albumComp.albumInfo = null;\r\n                    albumComp.setAttribute(\"img\", streamModel.bigImageUrl);\r\n                    albumComp.setAttribute(\"name\", streamModel.stream.name);\r\n                    let bigTrackComp = document.getElementById(\"currentTrackBigView\") as EboBigTrackComp;\r\n                    bigTrackComp.streamInfo = streamModel;\r\n                }\r\n            });\r\n    }\r\n\r\n    private async onAlbumToViewChanged() {\r\n        let albumToView = this.state.getModel().getAlbumToView();\r\n        if(!albumToView)\r\n            return;\r\n        let albumModel = await this.state.getController().getExpandedAlbumModel(albumToView.albumUri);\r\n        this.albumView.setAlbumComponentData(albumModel, albumToView.selectedTrackUri);\r\n    }\r\n\r\n    private async rememberStreamLines(lines: string[]) {\r\n        await this.state.getController().remember(lines.join(\"\\n\"));\r\n    }\r\n\r\n    private async onSettingsButtonClick() {\r\n        await this.showView(Views.Settings);\r\n    }\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {AllUris, BreadCrumbBrowseFilter, BreadCrumbHome, BreadCrumbRef, BrowseFilter, FilterBreadCrumb, GenreReplacement} from \"../modelTypes\";\r\nimport {EmptySearchResults, GenreSearchResult, SearchResult, SearchResults} from \"../refs\";\r\nimport {GuiSource} from \"../events\";\r\nimport {unreachable} from \"../global\";\r\nimport {EboListButtonBar, ListButtonState_AllHidden, ListButtonStates} from \"./eboListButtonBar\";\r\nimport {EboBrowseFilterComp} from \"./eboBrowseFilterComp\";\r\nimport {DisplayMode, EboListItemComp} from \"./eboListItemComp\";\r\n\r\nexport class EboBrowseComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-browse-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"display_mode\"];\r\n    currentResultHasImages: boolean = false;\r\n\r\n    get genreReplacements(){\r\n        return this._genreReplacements;\r\n    }\r\n\r\n    set genreReplacements(value: Map<string, GenreReplacement>) {\r\n        this._genreReplacements = value;\r\n    }\r\n    get action_btn_states(): ListButtonStates {\r\n        return this._action_btn_states;\r\n    }\r\n    set action_btn_states(value: ListButtonStates) {\r\n        this._action_btn_states = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private static listSource: GuiSource = \"browseView\";\r\n\r\n    private _action_btn_states: ListButtonStates = ListButtonState_AllHidden();\r\n    get breadCrumbs(): FilterBreadCrumb[] {\r\n        return this._breadCrumbs;\r\n    }\r\n\r\n    set breadCrumbs(value: FilterBreadCrumb[]) {\r\n        this._breadCrumbs = value;\r\n        this.renderBreadCrumbs(); // don't render all, as user may be typing a search text.\r\n    }\r\n\r\n    private _breadCrumbs: FilterBreadCrumb[] = [];\r\n\r\n    get results(): SearchResults {\r\n        return this._results;\r\n    }\r\n\r\n    set results(value: SearchResults) {\r\n        this._results = value;\r\n        this.renderResults(); // don't render all, as user may be typing a search text.\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private _results: SearchResults = EmptySearchResults;\r\n\r\n    get browseFilter(): BrowseFilter {\r\n        return this._browseFilter;\r\n    }\r\n\r\n    set browseFilter(value: BrowseFilter) {\r\n        if(JSON.stringify(this._browseFilter) == JSON.stringify(value))\r\n            return;\r\n        this._browseFilter = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private display_mode: DisplayMode = \"line\";\r\n    private _browseFilter: BrowseFilter;\r\n\r\n    private _genreReplacements: Map<string, GenreReplacement>;\r\n\r\n    static styleText= `\r\n        <style>\r\n            :host { \r\n                display: flex;\r\n            } \r\n            #wrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n            #filterButtons {\r\n                margin-top: .3em;\r\n                display: flex;\r\n                flex-direction: row;\r\n            }\r\n            #searchBox {\r\n                & input {\r\n                    flex-grow: 1;\r\n                    color: white;\r\n                    border: none;\r\n                    &:focus {\r\n                        outline: none;\r\n                    }\r\n                }\r\n            }\r\n            \r\n           #filterBox {\r\n                margin-block: .5rem;\r\n                padding:.3rem;\r\n                background-color: rgba(0,0,0,.5);\r\n                border-radius: .5rem;\r\n            }\r\n            .filterButton {\r\n                width: 1.5em;\r\n                height: 1.5em;\r\n                object-fit: contain;\r\n                margin-right: .5em;\r\n            }\r\n            #searchResults {\r\n                display: flex;\r\n                flex-direction: column;\r\n                overflow: hidden;\r\n                height: 100%;\r\n            }\r\n            #tableWrapper {\r\n                height: 100%;\r\n                width: 100%;\r\n                overflow: scroll;\r\n                scrollbar-width: none;\r\n                td {\r\n                    padding-top: .2em;\r\n                    padding-bottom: .2em;\r\n                }\r\n            }\r\n            :host(.line) #tableWrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n            }\r\n            :host(.icon) #tableWrapper {\r\n                display: grid;\r\n                grid-template-columns: repeat(3, auto);\r\n            }\r\n            .breadcrumb {\r\n                background-color: var(--highlight-background);\r\n                border-radius: 1rem;\r\n                padding-inline-start: 0.5rem;\r\n                padding-inline-end: 0.6em;\r\n                corner-inline-end-shape: bevel;\r\n                .filterButton {\r\n                    filter: invert(100%) sepia(100%) saturate(0%) hue-rotate(350deg) brightness(104%) contrast(102%);\r\n                    height: 1rem;\r\n                    width: 1rem;\r\n                    position: relative;\r\n                    top: .1rem;\r\n                    margin-right: .2rem;\r\n                }\r\n            }\r\n            #expandFilterBtn {\r\n                margin-left: .5rem;\r\n            }\r\n        </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n<div id=\"wrapper\">\r\n    <div id=\"breadCrumbs\"></div>\r\n    <ebo-browse-filter></ebo-browse-filter>\r\n    <div id=\"searchResults\">\r\n        <ebo-list-button-bar list_source=\"${this.listSource}\"></ebo-list-button-bar>\r\n        <div id=\"searchInfo\">\r\n        </div>  \r\n        <div id=\"tableWrapper\">\r\n            Wait for it...\r\n        </div>\r\n    </div>\r\n</div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboBrowseComp.styleText, EboBrowseComp.htmlText);\r\n        this._browseFilter = new BrowseFilter();\r\n        this.results = EmptySearchResults;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"display_mode\":\r\n                this.updateStringProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    setFocusAndSelect() {\r\n        let searchText = this.getShadow().getElementById(\"searchText\") as HTMLInputElement;\r\n        searchText?.focus();\r\n        searchText?.select();\r\n    }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        this.renderBreadCrumbs();\r\n        this.renderResults();\r\n        this.requestUpdate();\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let listButtonBar = shadow.querySelector(\"ebo-list-button-bar\") as EboListButtonBar;\r\n        listButtonBar.btn_states = this.action_btn_states;\r\n        let browseFilterComp = shadow.querySelector(\"ebo-browse-filter\") as EboBrowseFilterComp;\r\n        browseFilterComp.browseFilter = this._browseFilter;\r\n        browseFilterComp.availableRefTypes = this.results.availableRefTypes;\r\n        let activeDisplayMode: DisplayMode = this.display_mode;\r\n\r\n        let lines = shadow.querySelectorAll(\"ebo-list-item\");\r\n        lines.forEach(line => line.setAttribute(\"display\", activeDisplayMode));\r\n        this.classList.remove(\"icon\", \"line\");\r\n        this.classList.add(activeDisplayMode);\r\n    }\r\n\r\n    setSearchInfo(text: string) {\r\n        let searchInfo = this.getShadow().getElementById(\"searchInfo\");\r\n        if(searchInfo)\r\n            searchInfo.innerHTML = text;\r\n    }\r\n\r\n    renderBreadCrumbs() {\r\n        if(!this.isRendered) //may be called directly, before initialization.\r\n            return;\r\n        let breadCrumbsDiv = this.getShadow().getElementById(\"breadCrumbs\") as HTMLDivElement;\r\n        breadCrumbsDiv.innerHTML = this.breadCrumbs\r\n            .map(crumb => this.renderBreadcrumb(crumb))\r\n            .join(\" \");\r\n\r\n        breadCrumbsDiv.querySelectorAll(\"button\").forEach(btn => {\r\n            btn.addEventListener(\"click\", (ev)  => {\r\n                this.onBreadCrumbClicked(ev);\r\n            });\r\n        })\r\n    }\r\n\r\n    private renderBreadcrumb(crumb: FilterBreadCrumb) {\r\n        if(crumb instanceof BreadCrumbRef)\r\n            return `<button data-id=\"${crumb.id}\" class=\"breadcrumb uri\">${crumb.label}</button>`;\r\n        else if(crumb instanceof BreadCrumbBrowseFilter) {\r\n            let selectedFilters = crumb.data.getSelectedFilters();\r\n            let imgTags = \"\";\r\n            let filterText = \"\";\r\n            imgTags = selectedFilters.map(filter => this.filterToImg(filter)).join(\"\");\r\n            if(crumb.data.searchText)\r\n                filterText = `\"${crumb.data.searchText}\"`;\r\n            return `<button data-id=\"${crumb.id}\" class=\"breadcrumb filter\">${imgTags}${filterText}</button>`;\r\n        }\r\n        else if(crumb instanceof BreadCrumbHome)\r\n            return `<button data-id=\"${crumb.id}\" class=\"breadcrumb filter\"><i class=\"fa fa-home\"></i></button>`;\r\n        return unreachable(crumb);\r\n    }\r\n\r\n    private filterToImg(filter: string) {\r\n        let imgUrl = \"\";\r\n        switch (filter) {\r\n            case \"album\": imgUrl = \"images/icons/Album.svg\"; break;\r\n            case \"track\": imgUrl = \"images/icons/Track.svg\"; break;\r\n            case \"radio\": imgUrl = \"images/icons/Radio.svg\"; break;\r\n            case \"artist\": imgUrl = \"images/icons/Artist.svg\"; break;\r\n            case \"playlist\": imgUrl = \"images/icons/Playlist.svg\"; break;\r\n            case \"genre\": imgUrl = \"images/icons/Genre.svg\"; break;\r\n        }\r\n        return `<img class=\"filterButton\" src=\"${imgUrl}\" alt=\"\">`;\r\n    }\r\n\r\n    async renderResults() {\r\n        if(!this.isRendered) //may be called directly, before initialization.\r\n            return;\r\n        this.setSearchInfo(\"\");\r\n\r\n        let tableWrapper = this.getShadow().getElementById(\"tableWrapper\") as HTMLDivElement;\r\n        tableWrapper.innerHTML = \"--no results--\";\r\n\r\n        if(this.results.refs.length == 0)\r\n            return;\r\n\r\n        tableWrapper.innerHTML = \"\";\r\n\r\n        let html = \"\";\r\n        for(let result of this.results.refs) {\r\n            let refType = result.item.refType;\r\n            let imageUrl = result.getImageUrl();\r\n            let imageClass = \"\";\r\n            if(imageUrl.endsWith(\".svg\"))\r\n                imageClass = \"whiteIcon svgImage\";\r\n            html += `\r\n                    <ebo-list-item\r\n                        data-uri=\"${result.item.uri}\"\r\n                        data-type=\"${refType}\"\r\n                        text=\"${result.item.name + this.getGenreAlias(result)}\"\r\n                        img=\"${imageUrl}\"\r\n                        image_class=\"${imageClass}\">\r\n                    </ebo-list-item>`;\r\n\r\n        }\r\n\r\n        tableWrapper.innerHTML = html;\r\n        tableWrapper.querySelectorAll(\"ebo-list-item\").forEach((row: HTMLElement) => {\r\n            row.addEventListener(\"dblclick\", ev => {this.onRowDoubleClicked(ev).then(r => {})});\r\n            row.addEventListener(\"click\", ev => {this.onRowClicked(ev)});\r\n        });\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private getGenreAlias(result: SearchResult) {\r\n        if(!(result instanceof GenreSearchResult))\r\n            return \"\";\r\n        let genreReplacement = this.genreReplacements?.get(result.item.name);\r\n        if(!genreReplacement)\r\n            return \"\";\r\n        if(genreReplacement.replacement != null)\r\n            return ` (${genreReplacement.replacement})`;\r\n        return \"\";\r\n    }\r\n\r\n    private onRowClicked(ev: MouseEvent) {\r\n        let row = ev.currentTarget as EboListItemComp;\r\n        this.dispatchEboEvent(\"browseResultClick.eboplayer\", {\"label\": row.getAttribute(\"text\")??\"\", \"uri\": row.dataset.uri as AllUris, \"type\": <string>row.dataset.type});\r\n    }\r\n\r\n    private async onRowDoubleClicked(ev: MouseEvent) {\r\n        let row = ev.currentTarget as EboListItemComp;\r\n        this.dispatchEboEvent(\"browseResultDblClick.eboplayer\", {uri: row.dataset.uri as AllUris});\r\n    }\r\n\r\n    private onBreadCrumbClicked(ev: MouseEvent) {\r\n        let btn = ev.currentTarget as HTMLButtonElement;\r\n        this.dispatchEboEvent(\"breadCrumbClick.eboplayer\", {breadcrumbId: parseInt(<string>btn.dataset.id)});\r\n    }\r\n\r\n}\r\n","const TIME_OUT_TIME = 500;\r\n\r\nexport class MouseTimer<Source> {\r\n    private activeTimer: number | null;\r\n    private readonly source: Source;\r\n    private mouseUpCount = 0;\r\n    private isMouseDown = false;\r\n\r\n    private readonly onClick: ((source: Source) => void) | undefined = undefined;\r\n    private readonly onTimeOut: ((source: Source) => void) | undefined = undefined;\r\n    private readonly onMultiClick: ((source: Source, clickCount: number) => void) | undefined = undefined;\r\n\r\n    constructor(source: Source,\r\n                onClick: ((source: Source) => void) | undefined = undefined,\r\n                onMultiClick: ((source: Source, clickCount: number) => void) | undefined = undefined,\r\n                onTimeOut: ((source: Source) => void) | undefined = undefined\r\n    ) {\r\n        this.source = source;\r\n        this.onClick = onClick;\r\n        this.onMultiClick = onMultiClick;\r\n        this.onTimeOut = onTimeOut;\r\n    }\r\n\r\n    onMouseDown = (ev: MouseEvent) => {\r\n        this.isMouseDown = true;\r\n        if(this.activeTimer)\r\n            return;\r\n        this.startPressTimer(ev, () => {\r\n            this.doTimeOut();\r\n        });\r\n    };\r\n\r\n    onMouseUp = (ev: MouseEvent) => {\r\n        this.isMouseDown = false;\r\n        if(!this.activeTimer)\r\n            return;\r\n        this.mouseUpCount++;\r\n        if(this.mouseUpCount > 1) {\r\n            this.onMultiClick?.(this.source, this.mouseUpCount);\r\n            return;\r\n        }\r\n        this.onClick?.(this.source);\r\n    };\r\n\r\n    onMouseLeave = (ev: MouseEvent) => {\r\n        this.cancelPressTimer();\r\n    }\r\n\r\n    doTimeOut() {\r\n        this.cancelPressTimer();\r\n        if(!this.isMouseDown)\r\n            return;\r\n        this.onTimeOut?.(this.source);\r\n    }\r\n\r\n    private cancelPressTimer() {\r\n        if(this.activeTimer)\r\n            clearTimeout(this.activeTimer);\r\n        this.activeTimer = null;\r\n    }\r\n\r\n    private startPressTimer(ev: MouseEvent, onTimeOutCallback: (ev: MouseEvent) => void) {\r\n        this.mouseUpCount = 0;\r\n        this.activeTimer = window.setTimeout(() => { //use `window.` to avoid conflict with nodejs version of setTimeout.\r\n            if(this.activeTimer)\r\n                onTimeOutCallback(ev);\r\n            this.cancelPressTimer();\r\n        }, TIME_OUT_TIME);\r\n    }\r\n\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {MouseTimer} from \"../MouseTimer\";\r\n\r\nexport class EboButton extends EboComponent {\r\n    static override readonly tagName=  \"ebo-button\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"toggle\", \"img\", \"img_pressed\", \"pressed\", \"opacity_off\", \"click\", \"disabled\"];\r\n    private pressed: boolean = false;\r\n    private disabled: boolean = false;\r\n    private img: string;\r\n    private pressTimer: MouseTimer<EboButton>;\r\n    private toggle: boolean = false;\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            img {\r\n                width: 100%;\r\n            }\r\n            :host {\r\n                opacity: 1;\r\n            }\r\n            :host([toggle]) { \r\n                opacity: 0.5; \r\n            }\r\n            :host([pressed]) { \r\n                opacity: 1; \r\n            }\r\n            :host([disabled]) {\r\n                opacity: .2; \r\n            }\r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <button>\r\n            <img id=\"bigImage\" src=\"\" alt=\"Button image\">\r\n            <slot></slot>           \r\n        </button>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboButton.styleText, EboButton.htmlText);\r\n        this.img = \"\";\r\n        this.pressTimer = new MouseTimer<EboButton>(\r\n            this,\r\n            (source) => this.onClick(source),\r\n            (source, clickCount) => this.onMultiClick(source, clickCount),\r\n            (source) => this.onFilterButtonTimeOut(source)\r\n        );\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"img\":\r\n                this[name] = newValue;\r\n                break;\r\n            case \"pressed\":\r\n            case \"disabled\":\r\n            case \"toggle\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let button = shadow.querySelector(\"button\") as HTMLButtonElement;\r\n        button.addEventListener(\"mousedown\", (ev) => {\r\n            this.pressTimer.onMouseDown(ev);\r\n        });\r\n        button.addEventListener(\"mouseup\", (ev) => {\r\n            this.pressTimer.onMouseUp(ev);\r\n        });\r\n        button.addEventListener(\"mouseleave\", (ev) => {\r\n            this.pressTimer.onMouseLeave(ev);\r\n        });\r\n        this.requestUpdate();\r\n    }\r\n\r\n    override update(shadow: ShadowRoot) {\r\n        let imgTag = shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n        if(this.img) {\r\n            imgTag.src = this.img;\r\n            imgTag.style.display = \"\";\r\n        } else {\r\n            imgTag.style.display = \"none\";\r\n        }\r\n        if(this.toggle)\r\n            this.setClassFromBoolAttribute(imgTag, \"pressed\");\r\n        this.setClassFromBoolAttribute(imgTag, \"disabled\");\r\n    }\r\n\r\n    private onClick(eboButton: EboButton) {\r\n        if(this.disabled) return;\r\n        let button = this.getShadow().querySelector(\"button\") as HTMLButtonElement;\r\n        if(this.toggle) {\r\n            this.pressed = !this.pressed;\r\n            this.setClassFromBoolAttribute(button, \"pressed\");\r\n            this.setAttribute(\"pressed\", this.pressed.toString());\r\n        }\r\n        this.dispatchEboEvent(\"pressedChange.eboplayer\", { pressed: this.pressed });\r\n    }\r\n\r\n    onFilterButtonTimeOut(source: EboButton) {\r\n        this.dispatchEboEvent(\"longPress.eboplayer\", {});\r\n    }\r\n\r\n    private onMultiClick(eboButton: EboButton, clickCount: number) {\r\n        if(this.disabled) return;\r\n        this.dispatchEvent(new Event(\"dblclick\", {bubbles: true, composed: true}));\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {EboAlbumTracksComp} from \"./eboAlbumTracksComp\";\r\nimport {ExpandedAlbumModel, TrackUri} from \"../modelTypes\";\r\nimport {GuiSource} from \"../events\";\r\nimport {EboAlbumDetails} from \"./eboAlbumDetails\";\r\nimport {EboListButtonBar, ListButtonState_AllHidden, ListButtonStates} from \"./eboListButtonBar\";\r\nimport {arrayToggle} from \"../global\";\r\n\r\n\r\nexport class EboBigAlbumComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-big-album-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"name\", \"extra\", \"img\", \"disabled\"];\r\n\r\n    get selected_track_uris(): TrackUri[] {\r\n        return (this.getShadow().querySelector(\"ebo-album-tracks-view\") as EboAlbumTracksComp).selected_track_uris;\r\n    }\r\n    set selected_track_uris(value: TrackUri[]) {\r\n        (this.getShadow().querySelector(\"ebo-album-tracks-view\") as EboAlbumTracksComp).selected_track_uris = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    get btn_states(): ListButtonStates {\r\n        return this._btn_states;\r\n    }\r\n\r\n    set btn_states(value: ListButtonStates) {\r\n        this._btn_states = value;\r\n        this.requestUpdate();\r\n    }\r\n    get activeTrackUri(): string | null {\r\n        return this._activeTrackUri;\r\n    }\r\n    set activeTrackUri(value: string | null) {\r\n        this._activeTrackUri = value;\r\n        this.onActiveTrackChanged();\r\n    }\r\n    get albumInfo(): ExpandedAlbumModel | null {\r\n        return this._albumInfo;\r\n    }\r\n\r\n    set albumInfo(value: ExpandedAlbumModel | null) {\r\n        this._albumInfo = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private _activeTrackUri: string | null = null;\r\n    static progressBarAttributes = [\"position\", \"min\", \"max\", \"button\", \"active\"];\r\n    private name: string = \"\";\r\n    private extra: string = \"\";\r\n    private img: string  = \"\";\r\n    private albumClickEvent: CustomEvent<unknown>;\r\n    private _albumInfo: ExpandedAlbumModel | null = null;\r\n    private _btn_states: ListButtonStates = ListButtonState_AllHidden();\r\n\r\n    static styleText= `\r\n        <style>\r\n            :host { \r\n                display: flex;\r\n            } \r\n            h3 {\r\n                margin-block-start: .5em;\r\n                margin-block-end: .5em;\r\n            }\r\n            .albumCoverContainer {\r\n                display: flex;\r\n                flex-direction: column;\r\n                align-content: center;\r\n                overflow: hidden;\r\n                flex-wrap: wrap;\r\n            }\r\n            img {\r\n                max-width: 90vw;\r\n                height: 45vh;\r\n                object-fit: contain;\r\n                background-image: radial-gradient(circle, rgba(255,255,255, .5) 0%, transparent 100%);\r\n            }\r\n            ebo-progressbar {\r\n                margin-top: .5em;\r\n            }\r\n            #wrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                height: 100%;\r\n                width: 100%;\r\n                #bottom {\r\n                    overflow: hidden;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                }\r\n            }\r\n            #wrapper.front {\r\n                #back {\r\n                    display: none;\r\n                }                \r\n            }\r\n            #wrapper.back {\r\n                #front {\r\n                    display: none;\r\n                }                \r\n            }\r\n            .info {\r\n                font-size: .7em;\r\n            }\r\n            #albumTableWrapper {\r\n                overflow: hidden;\r\n            }\r\n            ebo-album-tracks-view {\r\n                height: 100%;\r\n            }\r\n            #back {\r\n                min-height: 40vh;\r\n            }\r\n        </style>\r\n        `;\r\n\r\n    private static readonly list_source: GuiSource = \"albumView\";\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n        <div id=\"wrapper\" class=\"front\">\r\n            <div id=\"top\">\r\n                <div id=\"front\">\r\n                    <div class=\"albumCoverContainer\">\r\n                        <img id=\"bigImage\" src=\"\" alt=\"Album cover\"/>\r\n                    </div>\r\n        \r\n                    <div id=\"info\">\r\n                        <h3 id=\"text\" class=\"selectable\"></h3>\r\n                        <h3 id=\"name\" class=\"selectable\"></h3>\r\n                        <div id=\"stream_lines\" class=\"selectable info\"></div>\r\n                        <div id=\"extra\" class=\"selectable info\"></div>\r\n                    </div>\r\n                </div>\r\n                <div id=\"back\">\r\n                    <ebo-album-details></ebo-album-details>\r\n                </div>                \r\n            </div>\r\n            <div id=\"bottom\">\r\n                <ebo-list-button-bar list_source=\"${this.list_source}\"></ebo-list-button-bar>\r\n                <div id=\"albumTableWrapper\">\r\n                    <ebo-album-tracks-view img=\"\" ></ebo-album-tracks-view>\r\n                </div>\r\n            </div>\r\n        </div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboBigAlbumComp.styleText, EboBigAlbumComp.htmlText);\r\n        this.albumInfo = null;\r\n        this.albumClickEvent = new CustomEvent(\"albumClick\", {\r\n            bubbles: true,\r\n            cancelable: false,\r\n            composed: true, //needed to 'break' out of the shadow.\r\n            detail: \"todo: tadaaa!\"\r\n        });\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        if(EboBigAlbumComp.progressBarAttributes.includes(name)) {\r\n            this.updateStringProperty(name, newValue);\r\n            return;\r\n        }\r\n        switch (name) {\r\n            case \"name\":\r\n            case \"extra\":\r\n            case \"img\":\r\n                this[name] = newValue;\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let image = this.shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n        image.addEventListener(\"click\", () => {\r\n            let wrapper = this.getShadow().querySelector(\"#wrapper\") as HTMLElement;\r\n            wrapper.classList.toggle(\"front\");\r\n            wrapper.classList.toggle(\"back\");\r\n        });\r\n        this.addEboEventListener(\"detailsAlbumImgClicked.eboplayer\", () => {\r\n            let wrapper = this.getShadow().querySelector(\"#wrapper\") as HTMLElement;\r\n            wrapper.classList.add(\"front\");\r\n            wrapper.classList.remove(\"back\");\r\n        });\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        [\"name\", \"extra\"].forEach(attName => {\r\n            // @ts-ignore\r\n            shadow.getElementById(attName).innerHTML = this[attName];\r\n        });\r\n        let tracksComp = shadow.querySelector(\"ebo-album-tracks-view\") as EboAlbumTracksComp;\r\n        tracksComp.albumInfo = this.albumInfo;\r\n        let img = shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n        if(this.img != \"\") {\r\n            img.style.visibility = \"\";\r\n            img.src = this.img;\r\n        } else\r\n            img.style.visibility = \"hidden\";\r\n        if(this.albumInfo) {\r\n            let buttonBar = shadow.querySelector(\"ebo-list-button-bar\") as HTMLElement;\r\n            buttonBar.setAttribute(\"uri\", this.albumInfo.album.albumInfo?.uri?? \"--no albumInfo--\");\r\n            let albumDetails = shadow.querySelector(\"ebo-album-details\") as EboAlbumDetails;\r\n            albumDetails.albumInfo = this.albumInfo;\r\n        }\r\n        let listButtonBar = shadow.querySelector(\"ebo-list-button-bar\") as EboListButtonBar;\r\n        listButtonBar.btn_states = this.btn_states;\r\n        if(this.selected_track_uris.length > 0)\r\n            listButtonBar.setAttribute(\"use_selected_color\", \"true\");\r\n        else\r\n            listButtonBar.removeAttribute(\"use_selected_color\");\r\n    }\r\n\r\n    private onActiveTrackChanged() {\r\n        let tracksComp = this.getShadow().querySelector(\"ebo-album-tracks-view\") as EboAlbumTracksComp;\r\n        tracksComp.activeTrackUri = this.activeTrackUri;\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {inverseQuadratic100, quadratic100, unreachable} from \"../global\";\r\nimport {PlaybackUserOptions} from \"../modelTypes\";\r\n\r\nexport class EboPlayerBar extends EboComponent {\r\n    get playMode(): PlaybackUserOptions {\r\n        return this._playMode;\r\n    }\r\n\r\n    set playMode(value: PlaybackUserOptions) {\r\n        this._playMode = value;\r\n        this.requestUpdate();\r\n    }\r\n    static override readonly tagName=  \"ebo-player-bar\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"play_state\", \"image_url\", \"show_info\", \"volume\", \"allow_play\", \"allow_prev\", \"allow_next\", \"text\", \"stop_or_pause\"];\r\n    private play_state: string;\r\n    private show_info: boolean = false;\r\n    private isVolumeSliding: boolean = false;\r\n    private volume: number = 0;\r\n    private allow_play: boolean = true;\r\n    private allow_prev: boolean = true;\r\n    private allow_next: boolean = true;\r\n    private text: string = \"\";\r\n    private image_url: string = \"\";\r\n    private stop_or_pause: string;\r\n    private _playMode: PlaybackUserOptions = \"justPlay\";\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            img {\r\n                width: 2em;\r\n                height: 2em;\r\n                margin-right: 1em;\r\n            }\r\n        \r\n            .playing {\r\n                background-color: var(--playing-background);\r\n            }\r\n            #buttonBar  {\r\n                display: flex;\r\n                justify-content: center;\r\n                flex-wrap: wrap;\r\n                align-items: center;\r\n                align-content: center;\r\n            \r\n                & button {\r\n                    padding-left: .5ch;\r\n                    padding-right: .5ch;\r\n                }\r\n            }\r\n            #buttonBar {\r\n                display: flex;\r\n                justify-content: center;\r\n                align-items: center;\r\n            }\r\n            #volumeSlider {\r\n                width: 100px;\r\n            }\r\n            input[type='range'] {\r\n                & {\r\n                    margin: 10px 5px;\r\n                    height: 2px;\r\n                    background-color: gray;\r\n                    -webkit-appearance: none;\r\n                }\r\n            \r\n                &::-webkit-slider-thumb {\r\n                    padding: 0;\r\n            \r\n                    width: 7px;\r\n                    appearance: none;\r\n                    height: 7px;\r\n                    background: white;\r\n                    color: white;\r\n                    border-color: white;\r\n                    border-style: solid;\r\n                    border-width:7px;\r\n                    border-radius: 7px;\r\n                }\r\n            }\r\n            #wrapper {\r\n                width: 100%;\r\n                display: flex;\r\n                flex-direction: column;\r\n                justify-content: center;\r\n                align-items: center;\r\n                padding-top: .5em;\r\n                padding-bottom: .5em;\r\n            }\r\n            #text {\r\n                font-size: .7em;\r\n                text-align: center;\r\n                display: block;\r\n            }\r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <div id=\"wrapper\">\r\n            <div id=\"info\">\r\n                <span id=\"text\" class=\"selectable\">sdfsdf sdfsdf </span>\r\n            </div>\r\n            <div id=\"buttonBar\">\r\n                <img id=\"buttonBarImg\" src=\"images/default_cover.png\" alt=\"Album cover\"/>\r\n                <div id=\"buttonBar\">\r\n                    <button id=\"btnPrev\" title=\"Previous\"><i class=\"fa fa-fast-backward\"></i></button>\r\n                    <button id=\"btnPlay\" title=\"Play\"><i class=\"fa fa-play\"></i></button>\r\n                    <button id=\"btnNext\" title=\"Next\"><i class=\"fa fa-fast-forward\"></i></button>\r\n                    <input id=\"volumeSlider\" data-highlight=\"true\" name=\"volumeSlider\" data-mini=\"true\" type=\"range\" min=\"0\" value=\"0\" max=\"100\"/>\r\n                    <ebo-dropdown id=\"btnRepeat\" style=\"margin-left: 1em;\">\r\n                        <ebo-option value=\"${\"justPlay\" satisfies PlaybackUserOptions}\"><i class=\"fa fa-ellipsis-h\"></i></ebo-option>\r\n                        <ebo-option value=\"${\"repeat\" satisfies PlaybackUserOptions}\"><img src=\"images/icons/Repeat.svg\" alt=\"Repeat\" class=\"whiteIcon dropDownImage\" style=\"margin-block-start: .2rem;\"></ebo-option>\r\n                        <ebo-option value=\"${\"repeatSingle\" satisfies PlaybackUserOptions}\" ><img src=\"images/icons/RepeatOne.svg\" alt=\"Repeat one\" class=\"whiteIcon dropDownImage\" style=\"margin-block-start: .2rem;\"></ebo-option>\r\n                    </ebo-dropdown>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboPlayerBar.styleText, EboPlayerBar.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"image_url\":\r\n            case \"text\":\r\n            case \"play_state\":\r\n            case \"stop_or_pause\":\r\n                this[name] = newValue;\r\n                break;\r\n            case \"volume\":\r\n                this.volume = parseInt(newValue);\r\n                break;\r\n            case \"show_info\":\r\n            case \"allow_play\":\r\n            case \"allow_prev\":\r\n            case \"allow_next\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let slider = shadow.getElementById(\"volumeSlider\") as HTMLInputElement;\r\n        slider.oninput = (ev) => {\r\n            this.isVolumeSliding = true;\r\n            this.volume = quadratic100(parseInt(slider.value));\r\n            this.dispatchEboEvent(\"changingVolume.eboplayer\", {volume: this.volume});\r\n        };\r\n        slider.onmousedown = slider.ontouchstart = () => { this.isVolumeSliding = true;};\r\n        slider.onmouseup = slider.ontouchend = () => { this.isVolumeSliding = false;};\r\n\r\n        let btnPlay = shadow.getElementById('btnPlay') as HTMLButtonElement;\r\n        btnPlay.addEventListener(\"click\", (ev) => {\r\n            let title = btnPlay.querySelector('i')?.title as string;\r\n            switch (title) {\r\n                case \"Play\": this.dispatchEboEvent(\"playPressed.eboplayer\", {}); break;\r\n                case \"Pause\": this.dispatchEboEvent(\"pausePressed.eboplayer\", {}); break;\r\n                case \"Stop\": this.dispatchEboEvent(\"stopPressed.eboplayer\", {}); break;\r\n            }\r\n        });\r\n        let imgTag = shadow.getElementById(\"buttonBarImg\") as HTMLImageElement;\r\n        imgTag.addEventListener(\"click\", (ev) => {\r\n            this.dispatchEboEvent(\"buttonBarAlbumImgClicked.eboplayer\", {});\r\n        });\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        switch(this.play_state) {\r\n            case \"playing\":\r\n                if(this.stop_or_pause == \"pause\")\r\n                    this.setPlayButton('Pause', 'fa-pause');\r\n                else\r\n                    this.setPlayButton('Stop', 'fa-stop');\r\n                break;\r\n            case \"stopped\":\r\n            case \"paused\":\r\n                this.setPlayButton('Play', 'fa-play');\r\n                break;\r\n        }\r\n        // @ts-ignore\r\n        shadow.getElementById(\"btnNext\").style.opacity = this.allow_next ? \"1\" : \"0.5\" ;\r\n        // @ts-ignore\r\n        shadow.getElementById(\"btnPrev\").style.opacity = this.allow_prev ? \"1\" : \"0.5\";\r\n        // @ts-ignore\r\n        shadow.getElementById(\"btnPlay\").style.opacity = this.allow_play ? \"1\" : \"0.5\";\r\n\r\n        switch (this.playMode) {\r\n            case \"repeat\":\r\n            case \"repeatSingle\":\r\n            case \"justPlay\":\r\n            case \"single\":\r\n                shadow.getElementById(\"btnRepeat\")?.setAttribute(\"value\", this.playMode);\r\n                break;\r\n            default:\r\n                unreachable(this.playMode);\r\n        }\r\n\r\n        let titleEl = shadow.getElementById(\"text\") as HTMLElement;\r\n        let img = shadow.querySelector(\"img\") as HTMLImageElement;\r\n        titleEl.style.display = this.show_info ? \"\" : \"none\";\r\n        if(this.image_url) {\r\n            img.style.visibility =  this.show_info ? \"visible\" : \"hidden\";\r\n            img.setAttribute(\"src\", this.image_url);\r\n        }\r\n        else\r\n            img.style.visibility = \"hidden\";\r\n        if(!this.isVolumeSliding) {\r\n            let slider = shadow.getElementById(\"volumeSlider\") as HTMLInputElement;\r\n            let visualVolume = inverseQuadratic100(this.volume);\r\n            slider.value = Math.floor(visualVolume).toString();\r\n        }\r\n        let wrapper = shadow.getElementById(\"wrapper\") as HTMLElement;\r\n        wrapper.classList.toggle(\"playing\", this.play_state == \"playing\");\r\n        titleEl.innerHTML = this.text.replaceAll(\"\\n\", \"<br/>\");\r\n    }\r\n\r\n    private setPlayButton(title: string, addClass: string) {\r\n        let btnPlayIcon = this.getShadow().getElementById('btnPlay')?.querySelector('i') as HTMLElement;\r\n        btnPlayIcon.classList.remove(\"fa-play\", \"fa-pause\", \"fa-stop\" );\r\n        btnPlayIcon.classList.add(addClass);\r\n        btnPlayIcon.setAttribute('title', title);\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\n\r\nexport class EboMenuButton extends EboComponent {\r\n    static override readonly tagName=  \"ebo-menu-button\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [];\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            .menuButton {\r\n                padding: 0;\r\n                border-radius: 100vw;\r\n                aspect-ratio: 1;\r\n                \r\n                anchor-name: --popup-button;\r\n            }\r\n            \r\n            .popupMenu {\r\n                border: solid white 1px;\r\n                border-radius: 20px 20px 0px 20px;\r\n                position-anchor: --popup-button;\r\n                margin: 0;\r\n                inset: auto;\r\n                bottom: anchor(top);\r\n                right: anchor(right);\r\n                opacity: 0;\r\n                margin-inline-start: 0.25rem;\r\n                background-color: var(--body-background);\r\n                \r\n                &:popover-open {\r\n                    opacity: 1;\r\n                }\r\n            }\r\n            \r\n            .trackButton {\r\n                border-color: gray;\r\n                text-align: left;\r\n                & i {\r\n                    position: relative;\r\n                    top: 2px;\r\n                }\r\n            }\r\n      </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <button class=\"menuButton\" popovertarget=\"menu\">\r\n            ...\r\n        </button>\r\n        <div popover id=\"menu\" class=\"popupMenu\">\r\n            <slot></slot>\r\n        </div>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboMenuButton.styleText, EboMenuButton.htmlText);\r\n    }\r\n\r\n    override onConnected() {\r\n        super.onConnected();\r\n        this.requestRender();\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        this.requestRender();\r\n        }\r\n\r\n    closeMenu() {\r\n        (this.getShadow().getElementById(\"menu\") as HTMLElement).hidePopover();\r\n    }\r\n}","import {Model} from \"../model\";\r\nimport {MopidyProxy} from \"../proxies/mopidyProxy\";\r\nimport models, {TlId} from \"../../js/mopidy\";\r\nimport {AllUris} from \"../modelTypes\";\r\n\r\nexport class PlayController {\r\n    protected model: Model;\r\n    protected mopidyProxy: MopidyProxy;\r\n\r\n    constructor(model: Model, mopidyProxy: MopidyProxy) {\r\n        this.model = model;\r\n        this.mopidyProxy = mopidyProxy;\r\n    }\r\n\r\n    async clear() {\r\n        await this.mopidyProxy.clearTrackList();\r\n        this.model.setTrackList([]);\r\n    }\r\n    async clearAndPlay(uris: AllUris[]) {\r\n        await this.mopidyProxy.clearTrackList();\r\n        let trackList = await this.add(uris);\r\n        await this.play(trackList[0].tlid);\r\n    }\r\n\r\n    async play(tlid: TlId | undefined = undefined) {\r\n        tlid = tlid ?? this.model.getTrackList()[0].tlid;\r\n        await this.mopidyProxy.playTracklistItem(tlid);\r\n    }\r\n\r\n    async add(uris: AllUris[]) {\r\n        let tracks = await this.mopidyProxy.addTracksToTracklist(uris);\r\n        this.model.addToTrackList(tracks);\r\n        return tracks;\r\n    }\r\n}","import {Commands} from \"../commands\";\r\nimport models from \"../../js/mopidy\";\r\nimport {AllUris, MopidyHistoryLine, HistoryRef, ImageLookup, PlaylistUri, PlaybackFlags} from \"../modelTypes\";\r\nimport {SearchResult} from \"../refs\";\r\nimport TlTrack = models.TlTrack;\r\nimport Ref = models.Ref;\r\nimport Playlist = models.Playlist;\r\n\r\nexport class MopidyProxy {\r\n    private commands: Commands;\r\n\r\n    constructor(commands: Commands) {\r\n        this.commands = commands;\r\n    }\r\n\r\n    async fetchRootDirs() {\r\n        return this.browse(null);\r\n    }\r\n\r\n    async playTracklistItem(tlid: number) {\r\n        await this.commands.core.playback.play(null, tlid);\r\n    }\r\n\r\n    async addTracksToTracklist(uris: AllUris[]) {\r\n        return await this.commands.core.tracklist.add(undefined, undefined, uris);\r\n    }\r\n\r\n    async clearTrackList() {\r\n        await this.commands.core.tracklist.clear();\r\n    }\r\n\r\n    async browse<T extends AllUris>(uri: string | null) {\r\n        return await this.commands.core.library.browse(uri) as Ref<T>[];\r\n    }\r\n\r\n    async sendVolume(value: number) {\r\n        await this.commands.core.mixer.setVolume(Math.round(value));\r\n    }\r\n\r\n    async sendStop() {\r\n        return this.commands.core.playback.stop();\r\n    }\r\n\r\n    async sendPause() {\r\n        return this.commands.core.playback.pause();\r\n    }\r\n\r\n    async sendPlay() {\r\n        return this.commands.core.playback.play();\r\n    }\r\n\r\n    async search(uri: string) {\r\n        return await this.commands.core.library.search({uri}, [], true) as SearchResult[];\r\n    }\r\n\r\n    async lookup(uris: AllUris | AllUris[]) {\r\n        if (typeof uris == \"string\")\r\n            uris = [uris];\r\n        return await this.commands.core.library.lookup(uris);\r\n    }\r\n\r\n    async fetchTracklist(): Promise< TlTrack[]> {\r\n        return await this.commands.core.tracklist.getTlTracks();\r\n    }\r\n\r\n    async fetchHistory() {\r\n        let historyObject = await this.commands.core.history.getHistory() as [number, HistoryRef][];\r\n        let historyLines = historyObject.map(line => {\r\n            return {\r\n                timestamp: line[0],\r\n                ref: line[1]\r\n            } as MopidyHistoryLine;\r\n        });\r\n\r\n\r\n        //Make sure a stream is only listed once.\r\n        let foundStreams = new Set<string>();\r\n        let filtered = historyLines.filter(line => {\r\n            if (!line.ref.uri.startsWith(\"http:\"))\r\n                return true; //assume not a stream\r\n            if (foundStreams.has(line.ref.uri))\r\n                return false;\r\n            foundStreams.add(line.ref.uri);\r\n            return true;\r\n        });\r\n\r\n\r\n        let prev = {ref: {uri: \"\"}};\r\n        let dedupLines = filtered.filter((line) => {\r\n            if (line.ref.uri == prev.ref.uri)\r\n                return false;\r\n            prev = line;\r\n            return true;\r\n        });\r\n        return dedupLines;\r\n    }\r\n\r\n    async fetchCurrentTrack() {\r\n        return await this.commands.core.playback.getCurrentTlTrack() as TlTrack | null;\r\n    }\r\n\r\n    async fetchPlayLists() {\r\n        return await this.commands.core.playlists.asList() as Ref<PlaylistUri>[];\r\n    }\r\n\r\n    async fetchPlaylistItems(uri: string) {\r\n        return await this.commands.core.playlists.getItems(uri);\r\n    }\r\n\r\n    async fetchImages(uris: AllUris[]) {\r\n        return await this.commands.core.library.getImages(uris) as ImageLookup;\r\n    }\r\n\r\n    async fetchVolume() {\r\n        return await this.commands.core.mixer.getVolume() as number;\r\n    }\r\n\r\n    async fetchCurrentTlTrack() {\r\n        return await this.commands.core.playback.getCurrentTlTrack() as TlTrack;\r\n    }\r\n\r\n    async fetchPlayState() {\r\n        return await this.commands.core.playback.getState() as string;\r\n    }\r\n\r\n    createPlaylist(name: string) {\r\n        return this.commands.core.playlists.create(name, \"eboback\");\r\n    }\r\n\r\n    savePlaylist(playlist: Playlist) {\r\n        return this.commands.core.playlists.save(playlist);\r\n    }\r\n\r\n    setRepeat(repeat: boolean) {\r\n        return this.commands.core.tracklist.setRepeat(repeat);\r\n    }\r\n\r\n    setSingle(single: boolean) {\r\n        return this.commands.core.tracklist.setSingle(single);\r\n    }\r\n\r\n    async getPlaybackFlags(): Promise<PlaybackFlags> {\r\n        let repeat = await this.commands.core.tracklist.getRepeat();\r\n        let single = await this.commands.core.tracklist.getSingle();\r\n        let random = await this.commands.core.tracklist.getRandom();\r\n        let consume = await this.commands.core.tracklist.getConsume();\r\n        return {repeat, single, random, consume};\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {MouseTimer} from \"../MouseTimer\";\r\nimport {console_yellow} from \"../global\";\r\n\r\nexport class EboDialog extends EboComponent {\r\n    static override readonly tagName=  \"ebo-dialog\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"ok_text\"];\r\n\r\n    ok_text: string = \"TODO\";\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            dialog {\r\n                background-color: var(--body-background);\r\n                & input {\r\n                    background-color: var(--body-background);\r\n                }\r\n            }        \r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <dialog id=\"dialog\">\r\n            <div id=\"content\">\r\n                <slot></slot>\r\n            </div>\r\n            <div>\r\n                <button id=\"OkBtn\">TODO</button>\r\n                <button id=\"CancelBtn\">Cancel</button>\r\n            </div>\r\n        </dialog>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboDialog.styleText, EboDialog.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"ok_text\":\r\n                this[name] = newValue;\r\n                break;\r\n        }\r\n        this.requestUpdate();//don't request render or the dialog may not show.\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let okButton = shadow.getElementById(\"OkBtn\") as HTMLButtonElement;\r\n        okButton.addEventListener(\"click\", (ev) => {\r\n            this.onOkButtonClick(ev);\r\n        });\r\n        let cancelButton = shadow.getElementById(\"CancelBtn\") as HTMLButtonElement;\r\n        cancelButton.addEventListener(\"click\", (ev) => {\r\n            let dialog = this.getShadow().getElementById(\"dialog\") as HTMLDialogElement;\r\n            dialog.close();\r\n        });\r\n    }\r\n\r\n    private onOkButtonClick(ev: PointerEvent) {\r\n        let dialog = this.getShadow().getElementById(\"dialog\") as HTMLDialogElement;\r\n        this.dispatchEboEvent(\"dialogOkClicked.eboplayer\", { dialog: this });\r\n    }\r\n\r\n    showModal() {\r\n        let dialog = this.getShadow().getElementById(\"dialog\") as HTMLDialogElement;\r\n        dialog.showModal();\r\n    }\r\n\r\n    close() {\r\n        let dialog = this.getShadow().getElementById(\"dialog\") as HTMLDialogElement;\r\n        dialog.close();\r\n    }\r\n\r\n    override update(shadow: ShadowRoot) {\r\n        let okButton = shadow.getElementById(\"OkBtn\") as HTMLButtonElement;\r\n        okButton.innerText = this.ok_text;\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {AlbumUri, ArtistUri, ExpandedAlbumModel} from \"../modelTypes\";\r\nimport {console_yellow, searchImageOnGoogle} from \"../global\";\r\n\r\nexport class EboAlbumDetails extends EboComponent {\r\n    get albumInfo(): ExpandedAlbumModel | null {\r\n        return this._albumInfo;\r\n    }\r\n\r\n    set albumInfo(value: ExpandedAlbumModel | null) {\r\n        this._albumInfo = value;\r\n        this.requestUpdate();\r\n    }\r\n    static override readonly tagName=  \"ebo-album-details\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [];\r\n    private _albumInfo: ExpandedAlbumModel | null = null;\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            * {\r\n                font-size: .8rem;\r\n            }\r\n            #header {\r\n                margin-bottom: .5rem;\r\n            }\r\n            #albumName {\r\n                font-size: 1rem;\r\n            }\r\n            img {\r\n                width: 2.1rem;\r\n                height: 2.1rem;\r\n                object-fit: contain;\r\n                margin-right: .5rem;\r\n            }\r\n            label {\r\n                margin-right: 1rem;\r\n            }\r\n            .replaced {\r\n                opacity: .5;\r\n                text-decoration: line-through;\r\n            }\r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <div>\r\n            <div id=\"header\" class=\"flexRow\">\r\n                <img id=\"bigImage\" src=\"\" alt=\"Album image\">\r\n                <span id=\"albumName\" class=\"selectable\"></span>\r\n            </div>\r\n            <div id=\"tableContainer\" class=\"flexColumn\">\r\n                <table>\r\n                    <tbody></tbody>                \r\n                </table>\r\n                <div style=\"border-block-start: solid 1px rgba(255,255,255,.5); margin-block-start:.5rem; padding-block-start: .5rem;\">\r\n                    <div class=\"flexRow\">\r\n                        <button id=\"btnUpdateAlbumData\" class=\"roundBorder iconButton\"><i class=\"fa fa-refresh\"></i></button>\r\n                        <button id=\"btnSearchImage\" \r\n                            class=\"roundBorder\" \r\n                            style=\"padding-inline-start: .7rem;\">\r\n                            <img src=\"images/icons/Google_Favicon_2025.svg\" \r\n                                alt=\"Search\" \r\n                                style=\"height: .9rem; width: .9rem; position: relative; top: .15rem;margin-right: .1rem;\">\r\n                            Image\r\n                        </button>\r\n                    </div>\r\n                    <label style=\"display: block; margin-block-start: .3rem; margin-block-end: .1rem;\">Upload an album image:</label>\r\n                    <div class=\"flexRow\">\r\n                        <input id=\"imageUrl\" type=\"text\" class=\"flexGrow\">\r\n                        <button id=\"btnUploadImage\" style=\"margin-inline-start: .3rem;\"><i class=\"fa fa-upload\"></i></button>\r\n                    </div>\r\n                </div>            \r\n            </div>        \r\n        </div>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboAlbumDetails.styleText, EboAlbumDetails.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        // switch (name) {\r\n        //     case \"img\":\r\n        //         this[name] = newValue;\r\n        //         break;\r\n        //     case \"pressed\":\r\n        //     case \"disabled\":\r\n        //         this.updateBoolProperty(name, newValue);\r\n        //         break;\r\n        // }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let imageTag = shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n        imageTag.addEventListener(\"click\", (ev) => {\r\n            this.dispatchEboEvent(\"detailsAlbumImgClicked.eboplayer\", {});\r\n        });\r\n        let btnUpdateAlbumData = shadow.getElementById(\"btnUpdateAlbumData\");\r\n        btnUpdateAlbumData?.addEventListener(\"click\", () => {\r\n            this.dispatchEboEvent(\"updateAlbumData.eboplayer\", {\"uri\": (this._albumInfo?.album?.ref.uri??\"--nu album uri--\") as AlbumUri});\r\n        });\r\n        let btnSearchImage = shadow.getElementById(\"btnSearchImage\");\r\n        btnSearchImage?.addEventListener(\"click\", () => {\r\n            let albumName = this.albumInfo?.album?.albumInfo?.name;\r\n            if(!albumName)\r\n                return;\r\n\r\n            searchImageOnGoogle(albumName);\r\n        });\r\n        let btnUploadImage = shadow.getElementById(\"btnUploadImage\");\r\n        btnUploadImage?.addEventListener(\"click\", () => {\r\n            this.dispatchEboEvent(\"uploadAlbumImageClicked.eboplayer\", {\"albumUri\": this.albumInfo?.album.ref.uri as AlbumUri, \"imageUrl\": (shadow.getElementById(\"imageUrl\") as HTMLInputElement).value.trim()})\r\n        });\r\n    }\r\n\r\n    override async update(shadow: ShadowRoot) {\r\n        if(this.albumInfo) {\r\n            let albumName = shadow.getElementById(\"albumName\") as HTMLElement;\r\n            albumName.innerHTML = this.albumInfo.album?.albumInfo?.name?? \"--no name--\";\r\n            let imgTag = shadow.getElementById(\"bigImage\") as HTMLImageElement;\r\n            imgTag.src = this.albumInfo.bigImageUrl;\r\n\r\n            let table = shadow.querySelector(\"#tableContainer > table\") as HTMLTableElement;\r\n            let body = table.tBodies[0];\r\n\r\n            let {artists, composers, genreDefs} = await this.albumInfo.getAllDetails();\r\n            console_yellow(`Artists: ${artists.map(artist => artist.name).join(\",\")}`);\r\n            //do the `await`s first before clearing and filling, to avoid data races! (double lines)\r\n            body.innerHTML = \"\";\r\n            this.addMetaDataRow(body, \"Year:\", this.albumInfo.album.albumInfo?.date?? \"--no date--\");\r\n            this.addMetaDataRow(body, \"Artists:\", artists.map(artist => {\r\n                console_yellow(`Adding button for artist: ${artist.name}`)\r\n                return ` \r\n                    <button class=\"linkButton\" data-uri=\"${artist.uri}\">${artist.name}</button>\r\n                `\r\n            }).join(\" \"));\r\n            this.addMetaDataRow(body, \"Composers:\", composers.map(artist => artist.name).join(\",\"));\r\n            let genresHtml = \"\";\r\n            genreDefs.forEach(def => {\r\n                let defHtml = \"\";\r\n                if(def.replacement)\r\n                    defHtml += `<span class=\"replaced\">${def.ref.name}</span> &gt; ${def.replacement}`;\r\n                genresHtml += defHtml;\r\n            });\r\n            this.addMetaDataRow(body, \"Genre\", genresHtml);\r\n            this.addMetaDataRow(body, \"Playlists\", \"todo...\");\r\n            body.querySelectorAll(\".linkButton\").forEach((link: HTMLElement) => {\r\n                link.addEventListener(\"click\", (ev) => {\r\n                    this.dispatchEboEvent(\"browseToArtist.eboplayer\", {\"name\": (ev.target as HTMLElement).textContent, \"type\": \"artist\", \"uri\": link.dataset.uri as ArtistUri});\r\n                })\r\n            })\r\n        }\r\n    }\r\n\r\n    private addMetaDataRow(body: HTMLTableSectionElement, colText1: string, colText2: string) {\r\n        let tr = body.appendChild(document.createElement(\"tr\"));\r\n        let td1 = tr.appendChild(document.createElement(\"td\"));\r\n        td1.innerHTML = colText1;\r\n        let td2 = tr.appendChild(document.createElement(\"td\"));\r\n        td2.innerHTML = colText2;\r\n        td2.classList.add(\"selectable\");\r\n    }\r\n}\r\n\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {ExpandedAlbumModel, ExpandedStreamModel} from \"../modelTypes\";\r\nimport {EboMenuButton} from \"./eboMenuButton\";\r\nimport {console_yellow} from \"../global\";\r\n\r\nexport class EboRadioDetailsComp extends EboComponent {\r\n    private _streamInfo: ExpandedStreamModel | null = null;\r\n    get streamInfo(): ExpandedStreamModel | null {\r\n        return this._streamInfo;\r\n    }\r\n    set streamInfo(value: ExpandedStreamModel | null) {\r\n        this._streamInfo = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    static override readonly tagName=  \"ebo-radio-details-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\r\n        \"img\",\r\n    ];\r\n\r\n    constructor() {\r\n        super(EboRadioDetailsComp.styleText, EboRadioDetailsComp.htmlText);\r\n        this.requestRender();\r\n    }\r\n\r\n    static styleText = `\r\n            <style>\r\n                :host { \r\n                    display: flex;\r\n                    text-align: start;\r\n                } \r\n                #wrapper {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    height: 100%;\r\n                    width: 100%;\r\n                }\r\n                .info {\r\n                    font-size: .7em;\r\n                }\r\n                #tableScroller {\r\n                    overflow: scroll;\r\n                    scrollbar-width: none;\r\n                    height: 100%;    \r\n                }\r\n                #tracksTable {\r\n                    width: 100%;\r\n                    border-collapse: collapse;\r\n                    tr.lastLine {\r\n                        border-bottom: 1px solid #ffffff80;\r\n                    }\r\n                }\r\n                tr.remembered {\r\n                    background-color: var(--highlight-background);\r\n                }\r\n            </style>\r\n        `;\r\n        static htmlText = `\r\n            <div id=\"wrapper\">\r\n                <div id=\"tableScroller\">\r\n                    <table id=\"tracksTable\">\r\n                        <colgroup>\r\n                            <col span=\"1\" style=\"width: auto;\">\r\n                            <col span=\"1\" style=\"width: 1em;\">\r\n                        </colgroup>\r\n                        <tbody>\r\n                        </tbody>                \r\n                    </table>\r\n                    <div id=\"tableFooter\">\r\n                        <button class=\"roundBorder\">Remembered items</button>                                            \r\n                    </div>\r\n                </div>          \r\n            </div>\r\n            <dialog popover id=\"albumTrackPopup\">\r\n            </dialog>        \r\n        `;\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(_name: string, _oldValue: string, _newValue: string) {\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override async render(shadow:ShadowRoot) {\r\n        let tableFooter = shadow.getElementById(\"tableFooter\") as HTMLDivElement;\r\n        tableFooter.addEventListener(\"click\", (ev) => {\r\n            this.dispatchEboEvent(\"rememberedRequested.eboplayer\", {});\r\n        })\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let tbody = (shadow.getElementById(\"tracksTable\") as HTMLTableElement).tBodies[0];\r\n        tbody.innerHTML  = \"\";\r\n        if(this.streamInfo) {\r\n            this.streamInfo.historyLines.forEach((lineGroup, index) => {\r\n                let tr: HTMLTableRowElement | null = null;\r\n                lineGroup.lines.forEach(line => {\r\n                    tr = tbody.appendChild(document.createElement(\"tr\"));\r\n                    tr.dataset.index = index.toString();\r\n                    if(lineGroup.remembered)\r\n                        tr.classList.add(\"remembered\");\r\n                    let td = tr.appendChild(document.createElement(\"td\"));\r\n                    td.innerHTML = line;\r\n                    td.classList.add(\"selectable\");\r\n                    let td2 = tr.appendChild(document.createElement(\"td\"));\r\n                    td2.innerHTML = `\r\n                        <ebo-menu-button>\r\n                            <div class=\"flexColumn\">\r\n                                <button id=\"rememberTrack\" class=\"roundBorder\">Remember track</button>\r\n                                <button id=\"excludeLine\" class=\"roundBorder\">Exclude line</button>\r\n                                <button id=\"isProgramTitle\" class=\"roundBorder\">Line is program title</button>\r\n                            </div>\r\n                        </ebo-menu-button>`;\r\n                    td2.querySelector(\"#rememberTrack\")?.addEventListener(\"click\", (ev) => {\r\n                        this.saveRemember(ev.target as HTMLElement);\r\n                    });\r\n                    td2.querySelector(\"#excludeLine\")?.addEventListener(\"click\", (ev) => {\r\n                        console_yellow(\"Exclude line clicked\");\r\n                    });\r\n                    td2.querySelector(\"#isProgramTitle\")?.addEventListener(\"click\", (ev) => {\r\n                        console_yellow(\"Line is program title clicked\");\r\n                    });\r\n                });\r\n                if(tr != null)\r\n                    (tr as HTMLTableRowElement).classList.add(\"lastLine\");\r\n            });\r\n            let lastRow = tbody.lastElementChild as HTMLTableRowElement;\r\n            if(lastRow)\r\n                lastRow.scrollIntoView({block: \"end\"});\r\n        }\r\n    }\r\n\r\n    private saveRemember(target: HTMLElement) {\r\n        let lines = this.getLinesForBlock(target);\r\n        if(!lines) {\r\n            console.error(\"No text found\");\r\n            return;\r\n        }\r\n        this.dispatchEboEvent(\"rememberStreamLines.eboplayer\", {lines});\r\n    }\r\n\r\n    private getLinesForBlock(target: HTMLElement) {\r\n        let tr = target.closest(\"tr\");\r\n        if(!tr) {\r\n            console.error(\"No tr found\");\r\n            return;\r\n        }\r\n        let index = parseInt(tr.dataset.index ?? \"-1\");\r\n        if(index == -1) {\r\n            console.error(\"No index found\");\r\n            return;\r\n        }\r\n        let trsWithIndex = tr.closest(\"tbody\")?.querySelectorAll<HTMLTableRowElement>(`tr[data-index=\"${index}\"]`);\r\n        if(!trsWithIndex) {\r\n            console.error(\"No trs with index found\");\r\n            return;\r\n        }\r\n        return [...trsWithIndex].map(tr => tr.cells[0].textContent ?? \"--no text--\");\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {EboButton} from \"./eboButton\";\r\nimport {BrowseFilter, BrowseFilterFlags} from \"../modelTypes\";\r\nimport {RefType} from \"../refs\";\r\nimport {EboplayerEvent, GuiSource, PressedArgs} from \"../events\";\r\n\r\nexport class EboBrowseFilterComp extends EboComponent {\r\n    get availableRefTypes(): Set<RefType> {\r\n        return this._availableRefTypes;\r\n    }\r\n\r\n    set availableRefTypes(value: Set<RefType>) {\r\n        this._availableRefTypes = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    static override readonly tagName = \"ebo-browse-filter\";\r\n    private static listSource: GuiSource = \"browseView\";\r\n\r\n    get browseFilter(): BrowseFilter {\r\n        return this._browseFilter;\r\n    }\r\n\r\n    set browseFilter(value: BrowseFilter) {\r\n        this._browseFilter = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private _browseFilter: BrowseFilter;\r\n\r\n    private _availableRefTypes: Set<RefType>\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [];\r\n\r\n    static styleText = `\r\n        <style>\r\n            :host { \r\n                display: flex;\r\n            } \r\n            #wrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n            #filterButtons {\r\n                margin-top: .3em;\r\n                display: flex;\r\n                flex-direction: row;\r\n            }\r\n            #searchBox {\r\n                & input {\r\n                    flex-grow: 1;\r\n                    color: white;\r\n                    border: none;\r\n                    &:focus {\r\n                        outline: none;\r\n                    }\r\n                }\r\n            }\r\n            \r\n           #filterBox {\r\n                margin-block: .5rem;\r\n                padding:.3rem;\r\n                background-color: rgba(0,0,0,.5);\r\n                border-radius: .5rem;\r\n            }\r\n            .filterButton {\r\n                width: 1.5em;\r\n                height: 1.5em;\r\n                object-fit: contain;\r\n                margin-right: .5em;\r\n            }\r\n            #expandFilterBtn {\r\n                margin-left: .5rem;\r\n            }\r\n            #details {\r\n                padding: .4rem;\r\n                margin-inline-start: 2rem;\r\n            }\r\n            label {\r\n                font-size: .9rem;\r\n            }\r\n        </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n<div id=\"wrapper\">\r\n    <div id=\"filterBox\">\r\n        <div id=\"searchBox\" class=\"flexRow\">\r\n            <button id=\"headerSearchBtn\"><img src=\"images/icons/Magnifier.svg\" alt=\"\" class=\"filterButton whiteIcon\"></button>\r\n            <input id=\"searchText\" type=\"text\" autofocus>\r\n            <button id=\"expandFilterBtn\"><i class=\"fa fa-angle-down\"></i></button>\r\n        </div>\r\n        <div id=\"details\">\r\n            <label for=\"selectDate\">Added since </label>\r\n            <select id=\"selectDate\" >\r\n                <option value=\"0\"></option>\r\n                <option value=\"1\">1 day</option>\r\n                <option value=\"2\">2 days</option>\r\n                <option value=\"7\">1 week</option>\r\n                <option value=\"30\">1 month</option>\r\n                <option value=\"90\">3 months</option>\r\n                <option value=\"180\">6 months</option>\r\n                <option value=\"365\">1 year</option>\r\n            </select>                    \r\n        </div>\r\n        <div id=\"filterButtons\">\r\n            <ebo-button toggle id=\"filterAlbum\" img=\"images/icons/Album.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button toggle id=\"filterTrack\" img=\"images/icons/Track.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button toggle id=\"filterRadio\" img=\"images/icons/Radio.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button toggle id=\"filterArtist\" img=\"images/icons/Artist.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button toggle id=\"filterPlaylist\" img=\"images/icons/Playlist.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button toggle id=\"filterGenre\" img=\"images/icons/Genre.svg\" class=\"filterButton whiteIcon\"></ebo-button>\r\n            <ebo-button id=\"all\"> ALL </ebo-button>\r\n            <button> &nbsp;&nbsp;(?) </button>\r\n        </div>\r\n    </div>    \r\n</div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboBrowseFilterComp.styleText, EboBrowseFilterComp.htmlText);\r\n        this._browseFilter = new BrowseFilter();\r\n        this.availableRefTypes = new Set();\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        this.requestRender();\r\n    }\r\n\r\n    setFocusAndSelect() {\r\n        let searchText = this.getShadow().getElementById(\"searchText\") as HTMLInputElement;\r\n        searchText?.focus();\r\n        searchText?.select();\r\n    }\r\n\r\n    override render(shadow: ShadowRoot) {\r\n        // @ts-ignore\r\n        shadow.getElementById(\"headerSearchBtn\").addEventListener(\"click\", async (ev) => {\r\n            this._browseFilter.searchText = inputElement.value;\r\n            this.dispatchEboEvent(\"guiBrowseFilterChanged.eboplayer\", {});\r\n        });\r\n        let inputElement = shadow.getElementById(\"searchText\") as HTMLInputElement;\r\n        inputElement.addEventListener(\"keyup\", (ev: KeyboardEvent) => {\r\n            this._browseFilter.searchText = inputElement.value;\r\n            this.dispatchEboEvent(\"guiBrowseFilterChanged.eboplayer\", {});\r\n        });\r\n        let allButton = shadow.getElementById(\"all\") as HTMLButtonElement;\r\n        allButton.addEventListener(\"click\", (ev) => {\r\n            this.onShowAllTypesButtonPress();\r\n        });\r\n        shadow.querySelectorAll(\"ebo-button\")\r\n            .forEach((btn: EboButton) => {\r\n                btn.addEboEventListener(\"pressedChange.eboplayer\", async (ev) => {\r\n                    this.onFilterButtonPress(ev);\r\n                });\r\n                btn.addEboEventListener(\"longPress.eboplayer\", (ev) => {\r\n                    this.onFilterButtonLongPress(ev);\r\n                });\r\n                btn.addEventListener(\"dblclick\", (ev) => {\r\n                    this.onFilterButtonDoubleClick(ev);\r\n                })\r\n            });\r\n        let selectDate = shadow.getElementById(\"selectDate\") as HTMLSelectElement;\r\n        selectDate.addEventListener(\"change\", (ev: Event) => {\r\n            this.onDateFilterChanged();\r\n        });\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private onFilterButtonLongPress(ev: Event) {\r\n        this.setSingleButton(ev);\r\n    }\r\n\r\n    private onFilterButtonDoubleClick(ev: Event) {\r\n        this.setSingleButton(ev);\r\n    }\r\n\r\n    private setSingleButton(ev: Event) {\r\n        this.clearFilterButtons();\r\n        this.toggleFilterButton(ev.target as EboButton);\r\n        this.requestUpdate();\r\n    }\r\n\r\n    private clearFilterButtons() {\r\n        this.browseFilter.genre = false;\r\n        this.browseFilter.radio = false;\r\n        this.browseFilter.playlist = false;\r\n        this.browseFilter.album = false;\r\n        this.browseFilter.track = false;\r\n        this.browseFilter.artist = false;\r\n    }\r\n\r\n    private onFilterButtonPress(ev: EboplayerEvent<\"pressedChange.eboplayer\", PressedArgs>) {\r\n        let btn: EboButton = ev.target as EboButton;\r\n        this.toggleFilterButton(btn);\r\n    }\r\n\r\n    private toggleFilterButton(btn: EboButton) {\r\n        let propName = btn.id.replace(\"filter\", \"\");\r\n        propName = propName.charAt(0).toLowerCase() + propName.slice(1);\r\n        this.browseFilter[propName as keyof BrowseFilterFlags] = !this.browseFilter[propName as keyof BrowseFilterFlags];\r\n        this.dispatchEboEvent(\"guiBrowseFilterChanged.eboplayer\", {});\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let filterButtons = [...shadow.querySelectorAll(\"ebo-button\")]\r\n            .filter(el => el.id.startsWith(\"filter\")) as EboButton[];\r\n        filterButtons\r\n            .forEach(btn =>\r\n                this.updateFilterButton(btn));\r\n        let inputElement = shadow.getElementById(\"searchText\") as HTMLInputElement;\r\n        inputElement.value = this._browseFilter.searchText;\r\n        let allButton = shadow.getElementById(\"all\") as EboButton;\r\n        let nonPressed = filterButtons.every(btn => !btn.hasAttribute(\"pressed\"));\r\n        if(this.availableRefTypes.size == 1 || nonPressed) {\r\n            allButton.setAttribute(\"disabled\", \"\");\r\n        } else {\r\n            allButton.removeAttribute(\"disabled\");\r\n        }\r\n        let selectDate = shadow.getElementById(\"selectDate\") as HTMLSelectElement;\r\n        selectDate.value = this._browseFilter.addedSince.toString();\r\n    }\r\n\r\n    private updateFilterButton(btn: EboButton) {\r\n        let propName = btn.id\r\n                .replace(\"filter\", \"\").charAt(0).toLowerCase()\r\n               + btn.id.replace(\"filter\", \"\").slice(1) as RefType;\r\n        btn.toggleAttribute(\"pressed\", this._browseFilter[propName]);\r\n        btn.toggleAttribute(\"disabled\", !this.availableRefTypes.has(propName));\r\n    }\r\n\r\n    setSearchInfo(text: string) {\r\n        let searchInfo = this.getShadow().getElementById(\"searchInfo\");\r\n        if(searchInfo)\r\n            searchInfo.innerHTML = text;\r\n    }\r\n\r\n    private filterToImg(filter: string) {\r\n        let imgUrl = \"\";\r\n        switch (filter) {\r\n            case \"album\": imgUrl = \"images/icons/Album.svg\"; break;\r\n            case \"track\": imgUrl = \"images/icons/Track.svg\"; break;\r\n            case \"radio\": imgUrl = \"images/icons/Radio.svg\"; break;\r\n            case \"artist\": imgUrl = \"images/icons/Artist.svg\"; break;\r\n            case \"playlist\": imgUrl = \"images/icons/Playlist.svg\"; break;\r\n            case \"genre\": imgUrl = \"images/icons/Genre.svg\"; break;\r\n        }\r\n        return `<img class=\"filterButton\" src=\"${imgUrl}\" alt=\"\">`;\r\n    }\r\n\r\n    private onShowAllTypesButtonPress() {\r\n        this.clearFilterButtons();\r\n        this.requestUpdate();\r\n        this.dispatchEboEvent(\"guiBrowseFilterChanged.eboplayer\", {});\r\n    }\r\n\r\n    private onDateFilterChanged() {\r\n        let selectDate = this.getShadow().getElementById(\"selectDate\") as HTMLSelectElement;\r\n        this.browseFilter.addedSince = parseInt(selectDate.value);\r\n        this.dispatchEboEvent(\"guiBrowseFilterChanged.eboplayer\", {});\r\n    }\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {console_yellow} from \"../global\";\r\nimport {EboButton} from \"./eboButton\";\r\n\r\nexport class EboSettingsComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-settings-view\";\r\n    get scanStatus(): string {\r\n        return this._scanStatus;\r\n    }\r\n    set scanStatus(value: string) {\r\n        this._scanStatus = value;\r\n        this.update(this.shadow);//force!\r\n    }\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"show_whats_new\"];\r\n\r\n    private _scanStatus: string;\r\n    private show_whats_new: boolean = false;\r\n\r\n    static styleText= `\r\n        <style>\r\n            :host { \r\n                display: flex;\r\n            } \r\n            #wrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n            #scanStatus {\r\n                font-size: .7rem;\r\n            }\r\n        </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n        <div id=\"wrapper\" class=\"flexColumn\">\r\n            <ebo-button id=\"rememberedBtn\" class=\"roundBorder\">Remembered info.</ebo-button>\r\n            <ebo-button id=\"scanBtn\" class=\"roundBorder\">Rescan media folder</ebo-button>\r\n            <p id=\"scanStatus\"></p>\r\n            <ebo-button id=\"whatsNewBtn\" class=\"roundBorder hidden\">Show what's new!</ebo-button>\r\n        </div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboSettingsComp.styleText, EboSettingsComp.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"show_whats_new\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let scanBtn = shadow.getElementById(\"scanBtn\") as EboButton;\r\n        scanBtn.addEventListener(\"click\", async (ev) => {\r\n            this.dispatchEboEvent(\"scanRequested.eboplayer\", {});\r\n        });\r\n        let whatsNewBtn = shadow.getElementById(\"whatsNewBtn\") as EboButton;\r\n        whatsNewBtn.addEventListener(\"click\", async (ev) => {\r\n            this.dispatchEboEvent(\"whatsNewRequested.eboplayer\", {});\r\n        });\r\n        let rememberedBtn = shadow.getElementById(\"rememberedBtn\") as EboButton;\r\n        rememberedBtn.addEventListener(\"click\", async (ev) => {\r\n            this.dispatchEboEvent(\"rememberedRequested.eboplayer\", {});\r\n        });\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let scanStatus = shadow.getElementById(\"scanStatus\") as HTMLElement;\r\n        scanStatus.innerText = this.scanStatus;\r\n        let whatsNewBtn = shadow.getElementById(\"whatsNewBtn\") as EboButton;\r\n        whatsNewBtn.classList.toggle(\"hidden\", !this.show_whats_new);\r\n    }\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {MouseTimer} from \"../MouseTimer\";\r\n\r\nexport type DisplayMode = \"line\" | \"icon\";\r\n\r\nexport class EboListItemComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-list-item\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes = [\"selected\", \"img\", \"selection_mode\", \"display\", \"text\", 'image_class'];\r\n    private selected: boolean = false;\r\n    private img: string;\r\n    private selection_mode: boolean;\r\n    private display: DisplayMode = \"icon\";\r\n    private text: string = \"\";\r\n    private image_class: string = \"\";\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            img {\r\n                width: 2rem;\r\n                height: 2rem;\r\n                margin-right: 0.5rem;\r\n            }\r\n            :host {\r\n                opacity: 1;\r\n            }\r\n            :host([selected]) { \r\n                background-color: var(--playing-background); \r\n            }\r\n            #text {\r\n                flex-grow: 1;\r\n                overflow: hidden;\r\n                text-overflow: ellipsis;\r\n                white-space: wrap;\r\n            }\r\n            #button {\r\n                flex-shrink: 1;\r\n                flex-grow: 0;\r\n                padding: 0;\r\n            }\r\n            #wrapper {\r\n                display: flex;\r\n                &.line {\r\n                    flex-direction: row;\r\n                    img {\r\n                        display: none;\r\n                    }\r\n                }\r\n                &.icon {\r\n                    flex-direction: column;\r\n                    align-items: center;\r\n                    img {\r\n                        margin-right: 0;\r\n                        width: 5rem;\r\n                        height: 5rem;\r\n                        &.svgImage {\r\n                            padding: .8rem;\r\n                            box-sizing: border-box;                     \r\n                        }\r\n                    }\r\n                    font-size: .5rem;\r\n                    #text {\r\n                    width: 5rem;\r\n                    text-align: center;\r\n                    overflow: auto;\r\n                    text-overflow: ellipsis;\r\n                    }\r\n                    #button {\r\n                        display: none;\r\n                    }           \r\n                }\r\n                &.selected {\r\n                    background-color: var(--playing-background); \r\n                }           \r\n            }\r\n        </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <div id=\"wrapper\">\r\n            <img id=\"img\" src=\"\" alt=\"track image\">\r\n            <div id=\"text\"></div>\r\n            <button id=\"button\">...</button>\r\n        </div>       \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboListItemComp.styleText, EboListItemComp.htmlText);\r\n        this.img = \"\";\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"img\":\r\n            case \"text\":\r\n            case \"image_class\":\r\n                this[name] = newValue;\r\n                break;\r\n            case \"display\":\r\n                this.display = newValue as DisplayMode;\r\n                break;\r\n            case \"selection_mode\":\r\n            case \"selected\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override update(shadow: ShadowRoot) {\r\n        let wrapper = shadow.getElementById(\"wrapper\") as HTMLElement;\r\n        this.setClassFromBoolAttribute(wrapper, \"selected\");\r\n        wrapper.classList.remove(\"line\", \"icon\");\r\n        wrapper.classList.add(this.display);\r\n        this.setImage(\"img\", this.img);\r\n        let img = shadow.getElementById(\"img\") as HTMLImageElement;\r\n        if(this.image_class)\r\n            img.classList.add(...this.image_class.split(\" \"));\r\n        this.setTextFromAttribute(\"text\");\r\n    }\r\n\r\n    setImage(id: string, uri: string | undefined) {\r\n        let imgTag = this.getShadow().getElementById(\"img\") as HTMLImageElement;\r\n        if(uri) {\r\n            imgTag.src = uri;\r\n            imgTag.style.visibility = \"visible\";\r\n        } else {\r\n            imgTag.style.visibility = \"hidden\";\r\n        }\r\n    }\r\n}\r\n","import {ComponentView} from \"./view\";\r\nimport {AllUris} from \"../modelTypes\";\r\nimport {EboBrowseComp} from \"../components/eboBrowseComp\";\r\nimport {GuiSourceArgs} from \"../events\";\r\nimport {ListButtonState, ListButtonState_AllHidden, ListButtonStates} from \"../components/eboListButtonBar\";\r\nimport {DisplayMode} from \"../components/eboListItemComp\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class BrowseView extends ComponentView<EboBrowseComp> {\r\n    constructor(state: State, component: EboBrowseComp) {\r\n        super(state, component);\r\n    }\r\n\r\n    bind() {\r\n        this.on(\"guiBrowseFilterChanged.eboplayer\", async () => {\r\n            await this.onGuiBrowseFilterChanged();\r\n        });\r\n        this.on(\"breadCrumbClick.eboplayer\", async (ev) => {\r\n            await this.onBreadcrumbClick(ev.detail.breadcrumbId);\r\n        });\r\n        this.on(\"browseResultClick.eboplayer\", async (ev) => {\r\n            await this.onBrowseResultClick(ev.detail.label, ev.detail.uri, ev.detail.type);\r\n        });\r\n        this.on(\"browseResultDblClick.eboplayer\", async (ev) => {\r\n            await this.onBrowseResultDblClick(ev.detail.uri as AllUris);\r\n        });\r\n        this.state.getModel().addEboEventListener(\"genreReplacementsChanged.eboplayer\", async () => {\r\n            await this.onGenreReplacementChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"refsFiltered.eboplayer\", () => {\r\n            this.onRefsFiltered();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"breadCrumbsChanged.eboplayer\", () => {\r\n            this.onBreadCrumbsChanged();\r\n        });\r\n        this.state.getModel().addEboEventListener(\"modelBrowseFilterChanged.eboplayer\", () => {\r\n            this.onModelBrowseFilterChanged();\r\n        });\r\n        this.on(\"playItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onPlayItemListClick(ev.detail);\r\n        });\r\n        this.on(\"addItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onAddItemListClick(ev.detail);\r\n        });\r\n        this.on(\"replaceItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onReplaceItemListClick(ev.detail);\r\n        });\r\n        this.on(\"displayModeChanged.eboplayer\", async (ev) => {\r\n            this.component.setAttribute(\"display_mode\", ev.detail.mode);\r\n        });\r\n    }\r\n\r\n    private async onGuiBrowseFilterChanged() {\r\n        await this.state.getController().setAndSaveBrowseFilter(this.component.browseFilter);\r\n    }\r\n\r\n    private onRefsFiltered() {\r\n        this.component.results = this.state.getModel().getCurrentSearchResults();\r\n        this.component.action_btn_states = this.getListButtonStates();\r\n    }\r\n\r\n    private getListButtonStates() {\r\n        let states: ListButtonStates = ListButtonState_AllHidden();\r\n        let searchResults = this.state.getModel().getCurrentSearchResults();\r\n        let browseFilter = this.state.getModel().getCurrentBrowseFilter();\r\n\r\n        states.line_or_icon = \"show\";\r\n\r\n        //list ref types state 1\r\n        if (searchResults.refs.length == 0) {\r\n            this.showHideTrackAndAlbumButtons(states, \"hide\");\r\n            states.new_playlist = \"hide\";\r\n            return states;\r\n        }\r\n\r\n        //list ref types state 2\r\n        if(browseFilter.searchText == \"\") {\r\n            this.showHideTrackAndAlbumButtons(states, \"show\");\r\n            states.new_playlist = \"hide\";\r\n            return states;\r\n        }\r\n\r\n        //list ref types state 3\r\n        let onlyTracksAndAlbums = [...searchResults.availableRefTypes].filter(t => t == \"track\" || t == \"album\").length == searchResults.availableRefTypes.size;\r\n        if (onlyTracksAndAlbums) {\r\n            this.showHideTrackAndAlbumButtons(states, \"show\");\r\n            states.new_playlist = \"show\";\r\n            return states;\r\n        }\r\n\r\n        //list ref types state 4\r\n        let onlyPlaylists = [...searchResults.availableRefTypes].filter(t => t == \"playlist\").length == searchResults.availableRefTypes.size;\r\n        if (onlyPlaylists) {\r\n            states.new_playlist = \"show\";\r\n            this.showHideTrackAndAlbumButtons(states, \"hide\");\r\n            return states;\r\n        }\r\n\r\n        //list ref types state 5\r\n        this.showHideTrackAndAlbumButtons(states, \"hide\");\r\n        states.new_playlist = \"show\";\r\n        return states;\r\n    }\r\n\r\n    updateCompFromState(displayMode: DisplayMode) {\r\n        this.component.browseFilter = this.state.getModel().getCurrentBrowseFilter(); //todo: already set in controller?\r\n        this.component.results = this.state.getModel()?.getCurrentSearchResults() ?? {refs: [], availableRefTypes: new Set()}; //todo: the default should be provided by getCurrentSearchResults()\r\n        this.component.breadCrumbs = this.state.getModel()?.getBreadCrumbs() ?? [];\r\n        this.component.setFocusAndSelect();\r\n        this.component.action_btn_states = this.getListButtonStates();\r\n        this.component.setAttribute(\"display_mode\", displayMode);\r\n    }\r\n\r\n    private showHideTrackAndAlbumButtons(states: ListButtonStates, state: ListButtonState): ListButtonStates {\r\n        states.add = state;\r\n        states.replace = state;\r\n        states.play = state;\r\n        states.save = state;\r\n        states.edit = state;\r\n        return states;\r\n    }\r\n\r\n    private onBreadCrumbsChanged() {\r\n        this.component.breadCrumbs = this.state.getModel()?.getBreadCrumbs() ?? [];\r\n    }\r\n\r\n    private onModelBrowseFilterChanged() {\r\n        this.component.browseFilter = this.state.getModel().getCurrentBrowseFilter();\r\n    }\r\n\r\n    private async onPlayItemListClick(detail: GuiSourceArgs) {\r\n        await this.state.getPlayer().clear();\r\n        await this.state.getController().addCurrentSearchResultsToPlayer();\r\n        await this.state.getPlayer().play();\r\n    }\r\n\r\n    private async onAddItemListClick(detail: GuiSourceArgs) {\r\n        await this.state.getController().addCurrentSearchResultsToPlayer();\r\n    }\r\n\r\n    private async onReplaceItemListClick(detail: GuiSourceArgs) {\r\n        await this.state.getPlayer().clear();\r\n        await this.onAddItemListClick(detail);\r\n    }\r\n\r\n    private async onBrowseResultDblClick(uri: AllUris) {\r\n        await this.state.getPlayer().clearAndPlay([uri]);\r\n    }\r\n\r\n    private async onBrowseResultClick(label: string, uri: AllUris, type: string) {\r\n        await this.state.getController().diveIntoBrowseResult(label, uri, type, true);\r\n    }\r\n\r\n    private async onBreadcrumbClick(breadcrumbId: number) {\r\n        await this.state.getController().resetToBreadCrumb(breadcrumbId);\r\n    }\r\n\r\n    private async onGenreReplacementChanged() {\r\n        this.component.genreReplacements = await this.state.getController().cache.getGenreReplacementsCached();\r\n    }\r\n\r\n}\r\n","import {ComponentView} from \"./view\";\r\nimport {AlbumUri, ExpandedAlbumModel, PlaylistUri, TrackUri} from \"../modelTypes\";\r\nimport {EboBigAlbumComp} from \"../components/eboBigAlbumComp\";\r\nimport {EboBrowseComp} from \"../components/eboBrowseComp\";\r\nimport {arrayToggle, console_yellow} from \"../global\";\r\nimport {GuiSourceArgs, SaveUriArgs} from \"../events\";\r\nimport {EboDialog} from \"../components/eboDialog\";\r\nimport {AlbumToView} from \"../model\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class AlbumView extends ComponentView<EboBigAlbumComp> {\r\n    private onDialogOkClickedCallback: (dialog: EboDialog) => boolean | Promise<boolean> = () => true;\r\n    private dialog: EboDialog;\r\n\r\n    constructor(state: State, dialog: EboDialog, component: EboBigAlbumComp) {\r\n        super(state, component);\r\n        this.dialog = dialog;\r\n        this.dialog.addEboEventListener(\"dialogOkClicked.eboplayer\", (ev) => {\r\n            console_yellow(\"dialogOkClicked.eboplayer\");\r\n            let innnerDialog = ev.detail.dialog;\r\n            if(this.onDialogOkClickedCallback(innnerDialog))\r\n                innnerDialog.close();\r\n        });\r\n    }\r\n\r\n    bind() {\r\n        let currentTrackBigViewComp = document.getElementById(\"currentTrackBigView\") as EboBrowseComp;\r\n        currentTrackBigViewComp.addEboEventListener(\"bigTrackAlbumSmallImgClicked.eboplayer\", async () => {\r\n            currentTrackBigViewComp.setAttribute(\"show_back\", \"false\");\r\n        });\r\n        this.component.addEboEventListener(\"playTrackClicked.eboplayer\", async (ev) => {\r\n            await this.onPlayTrackClicked(ev.detail.uri);\r\n        });\r\n        this.component.addEboEventListener(\"addTrackClicked.eboplayer\", async (ev) => {\r\n            await this.onAddTrackClicked(ev.detail.uri);\r\n        });\r\n        this.component.addEboEventListener(\"saveClicked.eboplayer\", async (ev) => {\r\n            await this.onSaveClicked(ev.detail);\r\n        });\r\n        this.component.addEboEventListener(\"trackClicked.eboplayer\", (ev) => {\r\n            this.component.selected_track_uris = arrayToggle<TrackUri>(this.component.selected_track_uris, ev.detail.uri as TrackUri);\r\n        });\r\n        this.component.addEboEventListener(\"playItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onPlayItemListClick(ev.detail);\r\n        });\r\n        this.component.addEboEventListener(\"addItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onAddItemListClick(ev.detail);\r\n        });\r\n        this.component.addEboEventListener(\"replaceItemListClicked.eboplayer\", async (ev) => {\r\n            await this.onReplaceItemListClick(ev.detail);\r\n        });\r\n        this.component.addEboEventListener(\"updateAlbumData.eboplayer\", async (ev) => {\r\n            await this.state.getController().webProxy.updateAlbumData(ev.detail.uri as AlbumUri);\r\n        });\r\n        this.component.addEboEventListener(\"uploadAlbumImageClicked.eboplayer\", async (ev) => {\r\n            await this.state.getController().webProxy.uploadAlbumImages(ev.detail.albumUri, ev.detail.imageUrl);\r\n        });\r\n        this.component.addEboEventListener(\"browseToArtist.eboplayer\", async (ev) => {\r\n            await this.state.getController().browseToArtist(ev.detail);\r\n        });\r\n\r\n    }\r\n\r\n    setAlbumComponentData(albumModel: ExpandedAlbumModel, selectedTrackUri: TrackUri | null) {\r\n        let albumComp = document.getElementById(\"bigAlbumView\") as EboBigAlbumComp;\r\n        this.component.albumInfo = albumModel;\r\n        this.component.selected_track_uris = selectedTrackUri ? [selectedTrackUri] : [];\r\n        this.component.setAttribute(\"img\", albumModel.bigImageUrl);\r\n        if(albumModel.album.albumInfo) {\r\n            this.component.setAttribute(\"name\", albumModel.meta?.albumTitle ?? albumModel.album.albumInfo.name);\r\n            this.component.dataset.albumUri = albumModel.album.albumInfo.uri;\r\n        }\r\n    }\r\n\r\n    private async onPlayItemListClick(_detail: GuiSourceArgs) {\r\n        await this.state.getPlayer().clearAndPlay(await this.getSelectedUriForAlbum());\r\n    }\r\n\r\n    private async onAddItemListClick(_detail: GuiSourceArgs) {\r\n        await this.state.getPlayer().add(await this.getSelectedUriForAlbum());\r\n    }\r\n\r\n    private async onReplaceItemListClick(detail: GuiSourceArgs) {\r\n        await this.state.getPlayer().clear();\r\n        await this.onAddItemListClick(detail);\r\n    }\r\n\r\n    private async onPlayTrackClicked(uri: TrackUri) {\r\n        await this.state.getPlayer().clearAndPlay([uri]);\r\n    }\r\n\r\n    private async onAddTrackClicked(uri: TrackUri) {\r\n    }\r\n\r\n    private async getSelectedUriForAlbum() {\r\n        let albumComp = document.getElementById(\"bigAlbumView\") as EboBigAlbumComp;\r\n        let trackUris = this.component.selected_track_uris;\r\n\r\n        if (trackUris.length != 0) {\r\n            return trackUris;\r\n        }\r\n\r\n        //No selection? Take the whole album.\r\n        let albumToView = this.state.getModel().getAlbumToView() as AlbumToView; //Shouldn't be null.'\r\n        return [albumToView.albumUri];\r\n    }\r\n\r\n    private async onSaveClicked(detail: SaveUriArgs) {\r\n        if (detail.source == \"albumView\") {\r\n            let dialogContent = `\r\n                <label for=\"playListName\">Name</label>\r\n                <input type=\"text\" id=\"playListName\">\r\n            `;\r\n            this.showDialog(dialogContent, \"Save\", (dialog) => {\r\n                let playlistName = dialog.querySelector(\"#playListName\") as HTMLInputElement;\r\n                let name = playlistName.value;\r\n                return this.saveAlbumAsPlaylist(name, detail);\r\n            });\r\n        }\r\n    }\r\n\r\n    showDialog(contentHtml: string, okButtonText: string, onOkClicked: (dialog: EboDialog) => boolean | Promise<boolean>) {\r\n        this.onDialogOkClickedCallback = onOkClicked;\r\n        this.dialog.innerHTML = contentHtml;\r\n        this.dialog.showModal();\r\n        this.dialog.setAttribute(\"ok_text\", okButtonText);\r\n    }\r\n\r\n    async saveAlbumAsPlaylist(name: string, detail: SaveUriArgs) {\r\n        console_yellow(`Saving album to playlist ${name} as ${detail.uri}`);\r\n        let playlist = await this.state.getController().createPlaylist(name);\r\n        await this.state.getController().addRefToPlaylist(playlist.uri as PlaylistUri, detail.uri, \"album\", -1);\r\n        return true;\r\n    }\r\n}\r\n","import {Mopidy} from \"../js/mopidy\";\r\nimport {ReadOnlyModel} from \"./model\";\r\nimport {Controller} from \"./controllers/controller\";\r\nimport {DeepReadonly} from \"./modelTypes\";\r\nimport {PlayController} from \"./controllers/playController\";\r\nimport {CacheHandler} from \"./controllers/cacheHandler\";\r\n\r\nexport class State {\r\n    mopidy: Mopidy;\r\n\r\n    // values for controls\r\n    play: boolean = false;\r\n    random: boolean = false;\r\n    repeat: boolean = false;\r\n\r\n    // array of cached playlists (not only user-playlists, also search, artist, album-playlists)\r\n\r\n    private readonly model: ReadOnlyModel;\r\n    private readonly controller: Controller;\r\n    private readonly player: PlayController;\r\n    private readonly cache: CacheHandler;\r\n\r\n    constructor(mopidy: Mopidy, model: ReadOnlyModel, controller: Controller, player: PlayController, cache: CacheHandler) {\r\n        this.mopidy = mopidy;\r\n        this.model = model;\r\n        this.controller = controller;\r\n        this.player = player;\r\n        this.cache = cache;\r\n    }\r\n    getModel = (): DeepReadonly<ReadOnlyModel> => this.model;\r\n    getController = () => this.controller;\r\n    getPlayer = () => this.player;\r\n    getCache = () => this.cache;\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\nimport {console_yellow, searchImageOnGoogle, searchOnGoogle} from \"../global\";\r\nimport {EboButton} from \"./eboButton\";\r\nimport {RemeberIdArgs} from \"../events\";\r\nimport {RememberDef} from \"../modelTypes\";\r\n\r\nexport class EboRememberedComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-remembered-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"\"];\r\n    static styleText= `\r\n        <style>\r\n        #rememberedTable tr {\r\n            background-color: #ffffff25;\r\n        }\r\n        </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n        <div id=\"wrapper\" class=\"flexColumn selectable\">\r\n            <p>Remembered</p>\r\n            <table id=\"rememberedTable\">\r\n                <colgroup>\r\n                    <col span=\"1\" style=\"width: auto;\">\r\n                    <col span=\"1\" style=\"width: 1em;\">\r\n                </colgroup>\r\n                <tbody></tbody>\r\n            </table>       \r\n        </div>        \r\n        `;\r\n\r\n    get rememberedList(): RememberDef[] {\r\n        return this._rememberedList;\r\n    }\r\n\r\n    set rememberedList(value: RememberDef[]) {\r\n        this._rememberedList = value;\r\n        this.update(this.shadow);\r\n    }\r\n    private _rememberedList: RememberDef[];\r\n\r\n    constructor() {\r\n        super(EboRememberedComp.styleText, EboRememberedComp.htmlText);\r\n        this._rememberedList = [];\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"nada\":\r\n                this.updateBoolProperty(name, newValue);\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let tbody = shadow.querySelector(\"tbody\") as HTMLTableSectionElement;\r\n        tbody.innerHTML = \"\";\r\n        for (let remembered of this.rememberedList) {\r\n            let tr = document.createElement(\"tr\");\r\n            tbody.appendChild(tr);\r\n            let td = document.createElement(\"td\");\r\n            tr.appendChild(td);\r\n            td.innerText = remembered.text;\r\n            td.dataset.id = remembered.id;\r\n            let td2 = document.createElement(\"td\");\r\n            tr.appendChild(td2);\r\n            td2.innerHTML = `\r\n                <ebo-menu-button>\r\n                    <div class=\"flexColumn\">\r\n                        <button id=\"deleteRememberedBtn\" class=\"roundBorder\">Delete</button>\r\n                        <button id=\"deleteAllRememberedBtn\" class=\"roundBorder\">Delete all</button>\r\n                        <button id=\"googleRememberedBtn\" class=\"roundBorder\">Google</button>\r\n                    </div>\r\n                </ebo-menu-button>`;\r\n            td2.querySelector(\"#deleteRememberedBtn\")?.addEventListener(\"click\", (ev) => {\r\n                this.dispatchEboEvent(\"deleteRemember.eboplayer\", {\"id\": remembered.id})\r\n            });\r\n            td2.querySelector(\"#deleteAllRememberedBtn\")?.addEventListener(\"click\", (ev) => {\r\n                console_yellow(\"deleteAllRememberedBtn\");\r\n            });\r\n            td2.querySelector(\"#googleRememberedBtn\")?.addEventListener(\"click\", (ev) => {\r\n                searchOnGoogle(td.innerText);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {ComponentView} from \"./view\";\r\nimport {EboRememberedComp} from \"../components/eboRememberedComp\";\r\nimport {State} from \"../playerState\";\r\n\r\nexport class RememberedView extends ComponentView<EboRememberedComp>{\r\n    constructor(state: State, component: EboRememberedComp) {\r\n        super(state, component);\r\n    }\r\n\r\n    bind(): void {\r\n        this.state.getModel().addEboEventListener(\"remembersChanged.eboplayer\", async () => {\r\n            this.component.rememberedList = await this.state.getController().cache.getRemembersCached();\r\n        });\r\n        this.component.addEboEventListener(\"deleteRemember.eboplayer\", async (ev) => {\r\n            await this.state.getController().deleteRemember(ev.detail.id);\r\n        });\r\n\r\n    }\r\n}","import {Model} from \"../model\";\r\nimport {Commands} from \"../commands\";\r\nimport models, {core, Mopidy} from \"../../js/mopidy\";\r\nimport {MopidyProxy} from \"../proxies/mopidyProxy\";\r\nimport {LocalStorageProxy} from \"../proxies/localStorageProxy\";\r\nimport {getHostAndPort, getHostAndPortDefs, isStream} from \"../global\";\r\nimport {createAllRefs, ExpandedRef} from \"../refs\";\r\nimport {AlbumModel, AlbumUri, AllUris, FileTrackModel, GenreDef, GenreReplacement, RememberDef, StreamTrackModel, StreamUri, TrackUri} from \"../modelTypes\";\r\nimport {WebProxy} from \"../proxies/webProxy\";\r\nimport {PlayController} from \"./playController\";\r\nimport Ref = models.Ref;\r\n\r\nexport class CacheHandler extends Commands{\r\n    protected model: Model;\r\n    public mopidyProxy: MopidyProxy;\r\n    public webProxy: WebProxy;\r\n    public localStorageProxy: LocalStorageProxy;\r\n    readonly baseUrl: string;\r\n    protected player: PlayController;\r\n\r\n    constructor(model: Model, mopidy: Mopidy, mopdyProxy: MopidyProxy, player: PlayController) {\r\n        super(mopidy);\r\n        this.model  = model;\r\n        this.player = player;\r\n        this.mopidyProxy = mopdyProxy;\r\n        this.webProxy = new WebProxy(getHostAndPort());\r\n        this.localStorageProxy = new LocalStorageProxy(model);\r\n        let portDefs = getHostAndPortDefs();\r\n        this.baseUrl = \"\";\r\n        if(portDefs.altHost && portDefs.altHost != portDefs.host)\r\n            this.baseUrl = \"http://\"+portDefs.altHost;\r\n    }\r\n\r\n    async lookupTrackCached(trackUri: TrackUri | StreamUri | null) {\r\n        if(!trackUri)\r\n            return null;\r\n        let item = this.model.getFromLibraryCache(trackUri);\r\n        if(item)\r\n            return item as FileTrackModel | StreamTrackModel;\r\n\r\n        let libraryList = await this.fetchAndConvertTracks(trackUri);\r\n        this.model.addItemsToLibraryCache(libraryList);\r\n        return this.model.getFromLibraryCache(trackUri) as FileTrackModel | StreamTrackModel | null; //assuming the trackUri points to a file or a stream.\r\n    }\r\n\r\n    private async fetchAndConvertTracks(uri: TrackUri | StreamUri) {\r\n        let dict = await this.mopidyProxy.lookup(uri);\r\n        let trackList = dict[uri] as models.Track[];\r\n        let newListPromises = trackList.map(async track => this.transformTrackDataToModel(track));\r\n        return await Promise.all(newListPromises);\r\n    }\r\n\r\n    private async transformTrackDataToModel(track: models.Track): Promise<FileTrackModel | StreamTrackModel> {\r\n        let allRefsMap = await this.getAllRefsMapCached();\r\n        if (isStream(track)) {\r\n            return {\r\n                type: \"stream\",\r\n                track,\r\n                name: track.name?? \"--no name--\",\r\n                ref: allRefsMap.get(track.uri) as ExpandedRef\r\n            } satisfies StreamTrackModel;\r\n        }\r\n        //for now, assume it's a file track\r\n        let model: FileTrackModel = {\r\n            type: \"file\",\r\n            composer: \"\",\r\n            track,\r\n            title: track.name?? \"--no name--\",\r\n            performer: \"\",\r\n            songlenght: 0,\r\n            ref: allRefsMap.get(track.uri) as ExpandedRef\r\n        };\r\n        //just in case...\r\n        if (!track.name || track.name === '') {\r\n            let parts = track.uri.split('/');\r\n            model.title = decodeURI(parts[parts.length - 1])\r\n        }\r\n        return model;\r\n    }\r\n\r\n    async lookupAlbumsCached(albumUris: AlbumUri[]) {\r\n        let albums: AlbumModel[] = [];\r\n        let albumUrisToFetch: AlbumUri[] = [];\r\n        for(let albumUri of albumUris) {\r\n            let album = this.model.getFromLibraryCache(albumUri);\r\n            if(album) {\r\n                albums.push(album as AlbumModel);\r\n            } else {\r\n                albumUrisToFetch.push(albumUri);\r\n            }\r\n        }\r\n\r\n        //fetch remaining albums\r\n        if(albumUrisToFetch.length > 0) {\r\n            let fetchedAlbums = await this.fetchAlbums(albumUrisToFetch);\r\n            this.model.addItemsToLibraryCache(fetchedAlbums);\r\n            albums = albums.concat(fetchedAlbums);\r\n        }\r\n        return albums;\r\n    }\r\n\r\n    private async fetchAlbums(albumUris: AlbumUri[]): Promise<AlbumModel[]> {\r\n        let dict = await this.mopidyProxy.lookup(albumUris);\r\n        let allRefs = await this.getAllRefsMapCached();\r\n        let albumModelsPending = Object.keys(dict).map(async (albumUri: AlbumUri) => {\r\n            let trackList = dict[albumUri] as models.Track[];\r\n            let albumModel: AlbumModel = {\r\n                type: \"album\",\r\n                albumInfo: trackList[0].album?? null,\r\n                tracks: trackList.map(track => track.uri as TrackUri),\r\n                ref: allRefs.get(albumUri) as ExpandedRef //removing undefined type. Let it crash.\r\n            }\r\n            return albumModel;\r\n        });\r\n        let albumModels = await Promise.all(albumModelsPending);\r\n\r\n        this.model.addItemsToLibraryCache(albumModels);\r\n        return albumModels;\r\n    }\r\n\r\n    async lookupRemembersCached() {\r\n        let remembers = this.model.getRemembers();\r\n        if (remembers)\r\n            return remembers;\r\n        remembers = await this.webProxy.fetchRemembers();\r\n        this.model.setRemembers(remembers);\r\n        return remembers;\r\n    }\r\n\r\n    async getMetaDataCached(albumUri: string) {\r\n        let cachedMeta = this.model.getFromMetaCache(albumUri);\r\n        if(cachedMeta)\r\n            return cachedMeta.meta;\r\n        let meta = await this.webProxy.fetchMetaData(albumUri);\r\n        this.model.addToMetaCache(albumUri, meta);\r\n        return meta;\r\n    }\r\n\r\n    async getAllRefsCached() {\r\n        let allRefs = this.model.getAllRefs();\r\n        if(!allRefs) {\r\n            let allExpandedRefs = await this.webProxy.fetchAllRefs();\r\n            allRefs = await createAllRefs(this, allExpandedRefs);\r\n            this.model.setAllRefs(allRefs);\r\n        }\r\n        return allRefs;\r\n    }\r\n\r\n    async getAllRefsMapCached() {\r\n        await this.getAllRefsCached();\r\n        return this.model.getAllRefsMap() as Map<AllUris, ExpandedRef>; //removing NULL from type - assuming a map has been loaded.\r\n    }\r\n\r\n    async getGenreReplacementsCached() {\r\n        if(this.model.getGenreReplacements().size > 0)\r\n            return this.model.getGenreReplacements() as Map<string, GenreReplacement>;\r\n        let genreDefs = await this.webProxy.fetchGenreReplacements();\r\n        this.model.setGenreReplacements(genreDefs);\r\n        return this.model.getGenreReplacements() as Map<string, GenreReplacement>;\r\n    }\r\n\r\n    async getGenreReplacementCached(name: string) {\r\n        let defs = await this.getGenreReplacementsCached();\r\n        return defs.get(name)?? null;\r\n    }\r\n\r\n    async getRemembersCached() {\r\n        if(this.model.getRemembers())\r\n            return this.model.getRemembers() as RememberDef[];\r\n        let remembers = await this.webProxy.fetchRemembers();\r\n        this.model.setRemembers(remembers);\r\n        return this.model.getRemembers() as RememberDef[]; //todo: this triggers the rememberedChanged event, which may already be a reason for this chached function call. Maybe this is ok...\r\n    }\r\n\r\n    async getGenreDefs() {\r\n        if(this.model.getGenreDefs().length > 0)\r\n            return this.model.getGenreDefs() as GenreDef[];\r\n        let genreDefs = await this.webProxy.fetchGenreDefs();\r\n        this.model.setGenreDefs(genreDefs);\r\n        return this.model.getGenreDefs() as GenreDef[];\r\n    }\r\n}\r\n","import {EboComponent} from \"./EboComponent\";\r\n\r\nexport class EboOption extends EboComponent {\r\n    static override readonly tagName=  \"ebo-option\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"value\", \"selected\"];\r\n    private value: string;\r\n    private selected: boolean = false;\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n      </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n            <div id=\"wrapper\">\r\n                <slot></slot>\r\n            </div>       \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboOption.styleText, EboOption.htmlText);\r\n    }\r\n\r\n    override onConnected() {\r\n        super.onConnected();\r\n        this.requestRender();\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        this.requestUpdate();\r\n        }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {PlaybackUserOptions} from \"../modelTypes\";\r\n\r\nexport class EboIconDropdown extends EboComponent {\r\n    static override readonly tagName=  \"ebo-dropdown\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [\"value\"];\r\n    private value: PlaybackUserOptions = \"justPlay\";\r\n\r\n    // noinspection CssUnresolvedCustomProperty\r\n    static styleText = `\r\n        <style>\r\n            .menuButton {\r\n                padding: 0;\r\n                border-radius: 100vw;\r\n                aspect-ratio: 1;\r\n                \r\n                anchor-name: --popup-button;\r\n            }\r\n            \r\n            .popupMenu {\r\n                border: none;\r\n                border-radius: .3rem;\r\n                position-anchor: --popup-button;\r\n                inset: auto;\r\n                top: anchor(bottom);\r\n                left: anchor(left);\r\n                margin: 0;\r\n                padding: .5rem;\r\n                opacity: 0;\r\n                background-color: #444;\r\n                \r\n                &:popover-open {\r\n                    opacity: 1;\r\n                }\r\n            }\r\n            \r\n            .trackButton {\r\n                border-color: gray;\r\n                text-align: left;\r\n                & i {\r\n                    position: relative;\r\n                    top: 2px;\r\n                }\r\n            }\r\n      </style>\r\n    `;\r\n\r\n    static htmlText = `\r\n        <button id=\"menuButton\" class=\"menuButton\" popovertarget=\"menu\">\r\n           ??\r\n        </button>\r\n        <div popover id=\"menu\" class=\"popupMenu\">\r\n            <slot></slot>\r\n        </div>\r\n        `;\r\n\r\n    constructor() {\r\n        super(EboIconDropdown.styleText, EboIconDropdown.htmlText);\r\n    }\r\n\r\n    override onConnected() {\r\n        super.onConnected();\r\n        this.requestRender();\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        switch (name) {\r\n            case \"value\":\r\n                this[name] = newValue as PlaybackUserOptions;\r\n                break;\r\n        }\r\n        this.requestUpdate();\r\n        }\r\n\r\n    closeMenu() {\r\n        (this.getShadow().getElementById(\"menu\") as HTMLElement).hidePopover();\r\n    }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let options = this.querySelectorAll(\"ebo-option\");\r\n        options.forEach(option => option.addEventListener(\"click\", (ev) => {\r\n            this.closeMenu();\r\n            let options = this.querySelectorAll(\"ebo-option\");\r\n            options.forEach(option => option.removeAttribute(\"selected\"));\r\n            (ev.currentTarget as HTMLElement).setAttribute(\"selected\", \"true\");\r\n            let value = (ev.currentTarget as HTMLElement).getAttribute(\"value\");\r\n            this.requestUpdate();\r\n            this.dispatchEboEvent(\"optionSelected.eboplayer\", { selected: value as PlaybackUserOptions});\r\n        }));\r\n        this.requestUpdate();\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        //set selected item based on value attribute.\r\n        let options = this.querySelectorAll(\"ebo-option\");\r\n        options.forEach(option => {\r\n            option.toggleAttribute(\"selected\", option.getAttribute(\"value\") === this.value);\r\n        });\r\n\r\n        //get selected item and duplicate it in the button.\r\n        let button = shadow.getElementById(\"menuButton\") as HTMLButtonElement;\r\n        let selectedItem = this.querySelector(\"ebo-option[selected]\") as HTMLElement;\r\n        if(!selectedItem) {\r\n            selectedItem = this.querySelector(\"ebo-option\") as HTMLElement;\r\n        }\r\n        if(!selectedItem)\r\n            return;\r\n\r\n        let clone = selectedItem.cloneNode(true) as HTMLElement;\r\n        button.innerText = \"\";\r\n        button.appendChild(clone);\r\n    }\r\n}","import {EboComponent} from \"./EboComponent\";\r\nimport {EboButton} from \"./eboButton\";\r\nimport {GenreDef} from \"../modelTypes\";\r\n\r\nexport type ExpandedGenreDef = {\r\n    genreDef: GenreDef,\r\n    active: boolean,\r\n}\r\n\r\nexport class EboGenresComp extends EboComponent {\r\n    static override readonly tagName=  \"ebo-genres-view\";\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static observedAttributes: string[] = [];\r\n\r\n    private _genreDefs: ExpandedGenreDef[] = [];\r\n    get genreDefs(): ExpandedGenreDef[] {\r\n        return this._genreDefs;\r\n    }\r\n\r\n    set genreDefs(value: ExpandedGenreDef[]) {\r\n        this._genreDefs = value;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    static styleText= `\r\n        <style>\r\n            :host { \r\n                display: flex;\r\n                color: #666;\r\n            } \r\n            #wrapper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n            #scrollContainer {\r\n                overflow-y: auto;\r\n                flex-grow: 1;\r\n                & details {\r\n                    color: #aaa;\r\n                }\r\n                & summary {\r\n                    color: inherit;\r\n                }\r\n                .active > summary {\r\n                    color: #ffa; /*todo: variable*/\r\n                }\r\n                .containsActive > summary {\r\n                    color: #dada91; /*todo: variable*/\r\n                }\r\n            }\r\n            .lvl1, .lvl2, .lvl3, .lvl4, .lvl5, .lvl6 {\r\n                margin: 0;\r\n                padding: 0;\r\n                font-size: 1rem;\r\n                font-weight: normal;\r\n                text-align: left;\r\n                margin-inline-start: 1rem;\r\n            }\r\n            .hasChildren::before {\r\n                content: \"\\\\25B6\";\r\n                position: relative;\r\n                left: -1rem;\r\n                float: left;\r\n                width: 0;\r\n                height: 1rem;\r\n                cursor: pointer;\r\n                font-size: .8rem;\r\n            }\r\n        </style>\r\n        `;\r\n\r\n    // noinspection HtmlUnknownTarget\r\n    static htmlText = `\r\n        <div id=\"wrapper\" class=\"flexColumn\">\r\n            <div class=\"flexRow\">\r\n                <ebo-button data-level=\"1\" toggle><div id=\"lvl1\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">1</div></ebo-button>            \r\n                <ebo-button data-level=\"2\" toggle><div id=\"lvl2\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">2</div></ebo-button>            \r\n                <ebo-button data-level=\"3\" toggle><div id=\"lvl3\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">3</div></ebo-button>            \r\n                <ebo-button data-level=\"4\" toggle><div id=\"lvl4\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">4</div></ebo-button>            \r\n                <ebo-button data-level=\"5\" toggle><div id=\"lvl5\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">5</div></ebo-button>            \r\n                <ebo-button data-level=\"6\" toggle><div id=\"lvl6\" class=\"squircleButton\" style=\"margin-inline-end: .2rem;\">6</div></ebo-button>           \r\n                <ebo-button id=\"btnShowActive\" toggle class=\"roundBorder\" style=\"padding-block: 0; margin-block-start: 0;\"><div style=\"font-size: .7rem;\">Active</div></ebo-button> \r\n            </div>\r\n            <div id=\"scrollContainer\"></div>\r\n        </div>        \r\n        `;\r\n\r\n    constructor() {\r\n        super(EboGenresComp.styleText, EboGenresComp.htmlText);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    attributeReallyChangedCallback(name: string, _oldValue: string, newValue: string) {\r\n        this.requestUpdate();\r\n        }\r\n\r\n    override render(shadow:ShadowRoot) {\r\n        let levelButtons = shadow.querySelectorAll(`ebo-button[data-level]`) as NodeListOf<EboButton>;\r\n        levelButtons.forEach(eboButton => {\r\n            eboButton.addEventListener(\"click\", (ev) => {\r\n                let level = parseInt(eboButton.dataset.level!);\r\n                let eboButtons = shadow.querySelectorAll(\"ebo-button\") as NodeListOf<EboButton>;\r\n                eboButtons.forEach(eboButton => {\r\n                    eboButton.toggleAttribute(\"pressed\", eboButton.dataset.level! <= level.toString());\r\n                });\r\n                this.showLevel(level);\r\n            });\r\n        });\r\n        let btnShowActive = shadow.getElementById(\"btnShowActive\") as EboButton;\r\n        btnShowActive.addEventListener(\"click\", (ev) => {\r\n            this.getActiveAncestors(shadow).forEach(ancestor => {\r\n                ancestor.toggleAttribute(\"open\", true);\r\n            });\r\n        });\r\n    }\r\n\r\n    override update(shadow:ShadowRoot) {\r\n        let container = shadow.getElementById(\"scrollContainer\") as HTMLElement;\r\n        let nextIndex = this.renderGenreDef(container, 0, -1);\r\n        while (nextIndex < this.genreDefs.length && this.genreDefs[nextIndex].genreDef.level == 0) {\r\n            nextIndex = this.renderGenreDef(container, nextIndex, -1);\r\n        }\r\n        this.getActiveAncestors(shadow).forEach(ancestor => {\r\n            ancestor.classList.toggle(\"containsActive\", true);\r\n        })\r\n    }\r\n\r\n    private getActiveAncestors(shadow:ShadowRoot) {\r\n        let activeAncestors: HTMLDetailsElement[] = [];\r\n        let allDetails = shadow.querySelectorAll(\"details\");\r\n        allDetails.forEach(detail => detail.open = false);\r\n        let activeElements = shadow.querySelectorAll(\".active\") as NodeListOf<HTMLElement>;\r\n        console.log(activeElements);\r\n        activeElements.forEach(activeElement => {\r\n            let ancestor: HTMLElement | null;\r\n            ancestor = activeElement;\r\n            while(true) {\r\n                let newAncestor = ancestor.parentElement!.closest(\"details\") as HTMLDetailsElement | null ;\r\n                if(newAncestor == ancestor)\r\n                    break;\r\n                ancestor = newAncestor;\r\n                if(!ancestor)\r\n                    break;\r\n                activeAncestors.push(ancestor as HTMLDetailsElement);\r\n            }\r\n        });\r\n        return activeAncestors;\r\n    }\r\n\r\n    private renderGenreDef(container: HTMLElement, index: number, parentLevel: number): number {\r\n        //prepare data\r\n        let genreDef = this.genreDefs[index];\r\n\r\n        if(genreDef.genreDef.level < parentLevel+1) {\r\n            return index; //we need to jump a parent up.\r\n        }\r\n\r\n        let nextGenreDef = this.genreDefs.length > index+1 ? this.genreDefs[index+1]: null;\r\n        let hasChildren = (nextGenreDef?.genreDef.level??-1) > genreDef.genreDef.level;\r\n        let name = genreDef.genreDef.name;\r\n        if(genreDef.genreDef.child) {\r\n            name = genreDef.genreDef.child;\r\n        }\r\n\r\n        //start building\r\n        if(hasChildren) {\r\n            let newContainer = document.createElement(\"details\");\r\n            newContainer.open = false;\r\n            newContainer.classList.add(\"lvl\"+(genreDef.genreDef.level+1));\r\n            newContainer.classList.toggle(\"active\", genreDef.active);\r\n            newContainer.dataset.level = (genreDef.genreDef.level+1).toString();\r\n            container.appendChild(newContainer);\r\n            let summary = document.createElement(\"summary\");\r\n            summary.textContent = name;\r\n            newContainer.appendChild(summary);\r\n            let nextIndex = this.renderGenreDef(newContainer, index+1, genreDef.genreDef.level);\r\n            while (nextIndex < this.genreDefs.length && this.genreDefs[nextIndex].genreDef.level == genreDef.genreDef.level+1) {\r\n                nextIndex = this.renderGenreDef(newContainer, nextIndex, genreDef.genreDef.level);\r\n            }\r\n            return nextIndex;\r\n        }\r\n        //no children, just a line\r\n        let newLine = document.createElement(\"div\");\r\n        newLine.classList.add(\"lvl\"+(genreDef.genreDef.level+1));\r\n        newLine.classList.toggle(\"active\", genreDef.active);\r\n        newLine.dataset.level = (genreDef.genreDef.level+1).toString();\r\n        container.appendChild(newLine);\r\n        newLine.textContent = name;\r\n        return index + 1;\r\n    }\r\n\r\n    private showLevel(level: number) {\r\n        let detailElements = this.shadow.querySelectorAll(\"details\");\r\n        detailElements.forEach(detailElement => {\r\n            detailElement.open = parseInt(detailElement.dataset.level!) < level;\r\n        });\r\n    }\r\n}\r\n","import {ComponentView} from \"./view\";\r\nimport {State} from \"../playerState\";\r\nimport {EboGenresComp, ExpandedGenreDef} from \"../components/eboGenresComp\";\r\n\r\nexport class GenresView extends ComponentView<EboGenresComp>{\r\n    constructor(state: State, component: EboGenresComp) {\r\n        super(state, component);\r\n    }\r\n\r\n    bind(): void {\r\n        this.state.getModel().addEboEventListener(\"genreDefsChanged.eboplayer\", async () => {\r\n            let genreDefs = await this.state.getCache().getGenreDefs();\r\n            let genreReplacements = await this.state.getCache().getGenreReplacementsCached();\r\n            this.component.genreDefs = genreDefs.map(genreDef => {\r\n                return {genreDef, active: genreReplacements.has(genreDef.child ?? genreDef.name)};\r\n            });\r\n        });\r\n    }\r\n}","import {Mopidy, Options} from \"../js/mopidy\";\r\nimport {Model} from \"./model\";\r\nimport {HeaderView} from \"./views/headerView\";\r\nimport {Controller} from \"./controllers/controller\";\r\nimport {PlayerBarView} from \"./views/playerBarView\";\r\nimport {EboProgressBar} from \"./components/eboProgressBar\";\r\nimport {TimelineView} from \"./views/timelineView\";\r\nimport EboBigTrackComp from \"./components/eboBigTrackComp\";\r\nimport {BigTrackViewCurrentOrSelectedAdapter} from \"./views/bigTrackViewCurrentOrSelectedAdapter\";\r\nimport {EboAlbumTracksComp} from \"./components/eboAlbumTracksComp\";\r\nimport {EboComponent} from \"./components/EboComponent\";\r\nimport {MainView} from \"./views/mainView\";\r\nimport {EboBrowseComp} from \"./components/eboBrowseComp\";\r\nimport {EboButton} from \"./components/eboButton\";\r\nimport {getHostAndPort} from \"./global\";\r\nimport {JsonRpcController} from \"./jsonRpcController\";\r\nimport {EboBigAlbumComp} from \"./components/eboBigAlbumComp\";\r\nimport {EboPlayerBar} from \"./components/eboPlayerBar\";\r\nimport {Views} from \"./modelTypes\";\r\nimport {EboMenuButton} from \"./components/eboMenuButton\";\r\nimport {EboListButtonBar} from \"./components/eboListButtonBar\";\r\nimport {PlayController} from \"./controllers/playController\";\r\nimport {Commands} from \"./commands\";\r\nimport {MopidyProxy} from \"./proxies/mopidyProxy\";\r\nimport {EboDialog} from \"./components/eboDialog\";\r\nimport {EboAlbumDetails} from \"./components/eboAlbumDetails\";\r\nimport {EboRadioDetailsComp} from \"./components/eboRadioDetailsComp\";\r\nimport {EboBrowseFilterComp} from \"./components/eboBrowseFilterComp\";\r\nimport {EboSettingsComp} from \"./components/eboSettingsComp\";\r\nimport {EboListItemComp} from \"./components/eboListItemComp\";\r\nimport {BrowseView} from \"./views/browseView\";\r\nimport {AlbumView} from \"./views/albumView\";\r\nimport {State} from \"./playerState\";\r\nimport {EboRememberedComp} from \"./components/eboRememberedComp\";\r\nimport {RememberedView} from \"./views/rememberedView\";\r\nimport {CacheHandler} from \"./controllers/cacheHandler\";\r\nimport {EboOption} from \"./components/eboOption\";\r\nimport {EboIconDropdown} from \"./components/eboIconDropdown\";\r\nimport {EboGenresComp} from \"./components/eboGenresComp\";\r\nimport {GenresView} from \"./views/genresView\";\r\n\r\nexport function getWebSocketUrl() {\r\n    let webSocketUrl = document.body.dataset.websocketUrl ?? null;\r\n    if (webSocketUrl?.startsWith(\"{{\"))\r\n        webSocketUrl = `ws://${getHostAndPort()}/mopidy/ws`;\r\n\r\n    if(webSocketUrl == \"\")\r\n        return null;\r\n    return webSocketUrl;\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function () {\r\n    Promise.all([\r\n        fetch(`${rootDir}css/global.css`).then(res => res.text()),\r\n        fetch(`${rootDir}vendors/font_awesome/css/font-awesome.css`).then(res => res.text()),\r\n    ])\r\n        .then(texts => {\r\n            EboComponent.setGlobalCss(texts);\r\n\r\n            EboComponent.define(EboProgressBar);\r\n            EboComponent.define(EboBigTrackComp);\r\n            EboComponent.define(EboAlbumTracksComp);\r\n            EboComponent.define(EboBrowseComp);\r\n            EboComponent.define(EboButton);\r\n            EboComponent.define(EboBigAlbumComp);\r\n            EboComponent.define(EboPlayerBar);\r\n            EboComponent.define(EboMenuButton);\r\n            EboComponent.define(EboListButtonBar);\r\n            EboComponent.define(EboDialog);\r\n            EboComponent.define(EboAlbumDetails);\r\n            EboComponent.define(EboRadioDetailsComp);\r\n            EboComponent.define(EboBrowseFilterComp);\r\n            EboComponent.define(EboSettingsComp);\r\n            EboComponent.define(EboListItemComp);\r\n            EboComponent.define(EboRememberedComp);\r\n            EboComponent.define(EboOption);\r\n            EboComponent.define(EboIconDropdown);\r\n            EboComponent.define(EboGenresComp);\r\n\r\n            setupStuff();\r\n        });\r\n});\r\n\r\nfunction updateDocumentTitle (headline: string) {\r\n    // @ts-ignore\r\n    headline = headline || document.getElementById('contentHeadline').textContent;\r\n    document.title = headline + ' | ' + document.body.dataset.title;\r\n}\r\n\r\nfunction setupStuff() {\r\n    let webSocketUrl = getWebSocketUrl();\r\n    let connectOptions: Options = {\r\n        webSocketUrl,\r\n        autoConnect: false //important: delay connection until all bindings, listeners and dependencies are setup.\r\n    };\r\n    let mopidy = new Mopidy(connectOptions);\r\n    let wsFrontEndUrl = \"ws://192.168.1.111:6680/eboplayer2/ws/\";\r\n    let eboWsFrontCtrl = new JsonRpcController(wsFrontEndUrl, 1000, 64000);\r\n\r\n    let wsBackEndUrl = \"ws://192.168.1.111:6680/eboback/ws2/\";\r\n    let eboWsBackCtrl = new JsonRpcController(wsBackEndUrl, 1000, 64000);\r\n\r\n    let model = new Model();\r\n    let mopidyProxy = new MopidyProxy(new Commands(mopidy));\r\n    let player = new PlayController(model, mopidyProxy);\r\n    let cacheHandler = new CacheHandler(model, mopidy, mopidyProxy, player);\r\n    let controller = new Controller(model, mopidy, eboWsFrontCtrl, eboWsBackCtrl, mopidyProxy, player, cacheHandler);\r\n\r\n    let state = new State(mopidy, model, controller, player, cacheHandler);\r\n\r\n    let browseView = new BrowseView(state, document.getElementById(\"browseView\") as EboBrowseComp);\r\n    let albumView = new AlbumView(state, document.getElementById(\"dialog\") as EboDialog, document.getElementById(\"bigAlbumView\") as EboBigAlbumComp);\r\n    let mainView = new MainView(state, browseView, albumView);\r\n    let headerView = new HeaderView(state);\r\n    let currentTrackView = new BigTrackViewCurrentOrSelectedAdapter(state,\"currentTrackBigView\");\r\n    let buttonBarView = new PlayerBarView(state, document.getElementById(\"buttonBar\") as EboPlayerBar);\r\n    let historyView = new TimelineView(state);\r\n    let rememberedView = new RememberedView(state, document.getElementById(\"rememberedView\") as EboRememberedComp);\r\n    let genresView = new GenresView(state, document.getElementById(\"genresView\") as EboGenresComp);\r\n\r\n    let views = [mainView, headerView, currentTrackView, buttonBarView, historyView, rememberedView, genresView];\r\n    views.forEach(v => v.bindRecursive());\r\n    controller.initialize(views);\r\n\r\n    if(location.hash == Views.Album)\r\n        controller.setView(Views.NowPlaying);\r\n    else\r\n        controller.setView((location.hash!=\"\" ? location.hash : Views.NowPlaying) as Views);\r\n\r\n    mopidy.connect();\r\n    eboWsFrontCtrl.connect();\r\n    eboWsBackCtrl.connect();\r\n}\r\n\r\n//intellij live preview hack because they don't allow to set a root folder for the built-in server:\r\nlet rootDir = document.location.pathname.replace(\"index.html\", \"\");\r\n\r\n"],"mappings":"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"}